*/**** START OF SPECIFICATIONS **************************************** 00000100
*                                                                     * 00000200
*                                                                     * 00000300
*01* MACRO NAME:  IEATXDC                               -05/30/18-<0> * 00000400
*                                                                     * 00000500
*                                                                     * 00000600
*01* DESCRIPTIVE NAME:  Transactional eXecution Diagnostic Controls   * 00000700
*                                                                     * 00000800
*01* PROPRIETARY STATEMENT:                                           * 00000900
*                                                                     * 00001000
*     LICENSED MATERIALS - PROPERTY OF IBM                            * 00001100
*     5650-ZOS COPYRIGHT IBM CORP. 2013                               * 00001200
*                                                                     * 00001300
* STATUS= HBB7790                                                     * 00001400
*                                                                     * 00001500
*                                                                     * 00001600
*                                                                     * 00001700
*01* FUNCTION:                                                        * 00001800
*                                                                     * 00001900
*                                                                     * 00002000
*      In support of the diagnostic controls of transactional         * 00002100
*      execution, as defined in the z/Architecture Principles of      * 00002200
*      Operation, the following services are provided:                * 00002300
*                                                                     * 00002400
*      For the current task,                                          * 00002500
*                                                                     * 00002600
*                                                                     * 00002700
*      o   Indicate the scope of the diagnostic controls              * 00002800
*                                                                     * 00002900
*      o   Set the diagnostic controls for "no abort"                 * 00003000
*                                                                     * 00003100
*      o   Set the diagnostic controls for "abort every"              * 00003200
*                                                                     * 00003300
*      o   Set the diagnostic controls for "abort random"             * 00003400
*                                                                     * 00003500
*                                                                     * 00003600
*                                                                     * 00003700
*01* EXTERNAL CLASSIFICATION:  GUPI                                   * 00003800
*                                                                     * 00003900
*01* END OF EXTERNAL CLASSIFICATION:                                  * 00004000
*                                                                     * 00004100
*01* ENVIRONMENT:                                                     * 00004200
*                                                                     * 00004300
*                                                                     * 00004400
*      Minimum authorization: Problem state with PSW key 8-15.        * 00004500
*                        SCOPE=ALL requires supervisor state; if a    * 00004600
*                        problem state caller indicates SCOPE=ALL, it * 00004700
*                        is treated as SCOPE=PROBLEM.                 * 00004800
*                                                                     * 00004900
*      Dispatchable unit mode: Task mode.                             * 00005000
*                                                                     * 00005100
*      Cross Memory Mode: Any PASN, any HASN, any SASN.               * 00005200
*                                                                     * 00005300
*      AMODE:            31- or 64-bit.                               * 00005400
*                                                                     * 00005500
*      ASC mode:         Primary or Access Register.                  * 00005600
*                                                                     * 00005700
*      Interrupt status: Enabled or disabled for I/O and external     * 00005800
*                        interrupts.                                  * 00005900
*                                                                     * 00006000
*      Locks:                                                         * 00006100
*                                                                     * 00006200
*                        The caller may hold any lock(s).  No locks   * 00006300
*                        are required.                                * 00006400
*                                                                     * 00006500
*      Control parameters: None.                                      * 00006600
*                                                                     * 00006700
*                                                                     * 00006800
*                                                                     * 00006900
*01* PROGRAMMING REQUIREMENTS:                                        * 00007000
*                                                                     * 00007100
*    None.                                                            * 00007200
*                                                                     * 00007300
*01* RESTRICTIONS:                                                    * 00007400
*                                                                     * 00007500
*    None.                                                            * 00007600
*                                                                     * 00007700
*01* INPUT REGISTER INFORMATION:                                      * 00007800
*                                                                     * 00007900
*    Before issuing the IEATXDC macro, the caller does not have to    * 00008000
*    place any information into any general purpose register (GPR).   * 00008100
*                                                                     * 00008200
*    Before issuing the IEATXDC macro, the caller does not have to    * 00008300
*    place any information into any access register (AR).             * 00008400
*                                                                     * 00008500
*01* OUTPUT REGISTER INFORMATION:                                     * 00008600
*                                                                     * 00008700
*    When control returns to the caller, the GPRs contain:            * 00008800
*                                                                     * 00008900
*                                                                     * 00009000
*    REGISTER  CONTENTS                                               * 00009100
*                                                                     * 00009200
*    0-1       Used as work registers by the system                   * 00009300
*                                                                     * 00009400
*    2-13      Unchanged                                              * 00009500
*                                                                     * 00009600
*    14        Used as a work register by the system                  * 00009700
*                                                                     * 00009800
*    15        Return code                                            * 00009900
*                                                                     * 00010000
*                                                                     * 00010100
*                                                                     * 00010200
*    When control returns to the caller, the ARs contain:             * 00010300
*                                                                     * 00010400
*                                                                     * 00010500
*    REGISTER  CONTENTS                                               * 00010600
*                                                                     * 00010700
*    0-1       Used as work registers by the system                   * 00010800
*                                                                     * 00010900
*    2-13      Unchanged                                              * 00011000
*                                                                     * 00011100
*    14-15     Used as work registers by the system                   * 00011200
*                                                                     * 00011300
*                                                                     * 00011400
*                                                                     * 00011500
*01* PERFORMANCE IMPLICATIONS:                                        * 00011600
*                                                                     * 00011700
*    None.                                                            * 00011800
*                                                                     * 00011900
*01* SYNTAX:                                                          * 00012000
*                                                                     * 00012100
*Ýxlabel¨  IEATXDC  Ð  SCOPE=PROBLEM                                  * 00012200
*                   ¿ ,SCOPE=ALL                                      * 00012300
*                   Ð ,OPERATION=NO_ABORT                             * 00012400
*                   Ô ,OPERATION=SET_EVERY                            * 00012500
*                   ¿ ,OPERATION=SET_RANDOM                           * 00012600
*                    Ý,RETCODE=xretcode¨                              * 00012700
*                                                                     * 00012800
*                                                                     * 00012900
*      Where:                                                         * 00013000
*                                                                     * 00013100
*                                                                     * 00013200
*      Ýxlabel¨                                                       * 00013300
*          is an optional symbol, starting in column 1, that is the   * 00013400
*          name on the IEATXDC macro invocation.  The name must       * 00013500
*          conform to the rules for an ordinary assembler language    * 00013600
*          symbol.                                                    * 00013700
*          DEFAULT: No name.                                          * 00013800
*                                                                     * 00013900
*                                                                     * 00014000
*                                                                     * 00014100
*                                                                     * 00014200
*      SCOPE=»PROBLEM!ALLº                                            * 00014300
*          is a required keyword input that identifies the scope of   * 00014400
*          the diagnostic controls.                                   * 00014500
*                                                                     * 00014600
*                                                                     * 00014700
*          SCOPE=PROBLEM                                              * 00014800
*              indicates that the diagnostic controls apply only for  * 00014900
*              problem state transactional execution.                 * 00015000
*                                                                     * 00015100
*          SCOPE=ALL                                                  * 00015200
*              indicates that the diagnostic controls apply both to   * 00015300
*              problem state and supervisor state transactional       * 00015400
*              execution.  If a problem state caller requests         * 00015500
*              SCOPE=ALL, however, it is treated as SCOPE=PROBLEM.    * 00015600
*                                                                     * 00015700
*                                                                     * 00015800
*                                                                     * 00015900
*                                                                     * 00016000
*                                                                     * 00016100
*                                                                     * 00016200
*      OPERATION=»NO_ABORT!SET_EVERY!SET_RANDOMº                      * 00016300
*          is a required keyword input that identifies the type of    * 00016400
*          operation to perform.                                      * 00016500
*                                                                     * 00016600
*                                                                     * 00016700
*          OPERATION=NO_ABORT                                         * 00016800
*              indicates to set the transactional diagnostic controls * 00016900
*              for this task so that the system will not apply its    * 00017000
*              SET_EVERY or SET_RANDOM rules. Transactions themselves * 00017100
*              may still abort for all the defined architectural      * 00017200
*              reasons.                                               * 00017300
*                                                                     * 00017400
*          OPERATION=SET_EVERY                                        * 00017500
*              indicates to set the transactional diagnostic controls * 00017600
*              for this task to request abort of every nonconstrained * 00017700
*              transaction.                                           * 00017800
*                                                                     * 00017900
*          OPERATION=SET_RANDOM                                       * 00018000
*              indicates to set the transactional diagnostic controls * 00018100
*              for this task to request abort of random               * 00018200
*              nonconstrained transactions.                           * 00018300
*                                                                     * 00018400
*                                                                     * 00018500
*                                                                     * 00018600
*                                                                     * 00018700
*                                                                     * 00018800
*                                                                     * 00018900
*      ÝRETCODE=xretcode¨                                             * 00019000
*          is the name (RS-type) of an optional fullword output       * 00019100
*          variable, or register (2)-(12) or (15), into which the     * 00019200
*          return code is to be copied from GPR 15.  If you specify   * 00019300
*          15, GPR15, REG15, or R15 (within or without parentheses),  * 00019400
*          the value will be left in GPR 15.                          * 00019500
*                                                                     * 00019600
*                                                                     * 00019700
*                                                                     * 00019800
*01* ABEND CODES:  None.                                              * 00019900
*                                                                     * 00020000
*       None                                                          * 00020100
*                                                                     * 00020200
*01* RETURN CODES:                                                    * 00020300
*                                                                     * 00020400
*                                                                     * 00020500
*       0         Meaning: Successful completion. Diagnostic Controls * 00020600
*                 are set to the requested value                      * 00020700
*                                                                     * 00020800
*                 Action: None required.                              * 00020900
*                                                                     * 00021000
*       4         Meaning: Warning. The machine does not support      * 00021100
*                 transactional execution. Diagnostic Controls are    * 00021200
*                 not set.                                            * 00021300
*                                                                     * 00021400
*                 Action: Avoid calling IEATXDC when the machine does * 00021500
*                 not support transactional execution.                * 00021600
*                                                                     * 00021700
*       8         Meaning: Unexpected input                           * 00021800
*                                                                     * 00021900
*                 Action: Check for possible storage overlay.         * 00022000
*                                                                     * 00022100
*       12        Meaning: Service called in SRB mode.                * 00022200
*                                                                     * 00022300
*                 Action: Avoid using IEATXDC in SRB mode.            * 00022400
*                                                                     * 00022500
*                                                                     * 00022600
*                                                                     * 00022700
*01* REASON CODES:  None.                                             * 00022800
*                                                                     * 00022900
*01* MODULE TYPE:  ASSEM MACRO                                        * 00023000
*                                                                     * 00023100
*02*   PROCESSOR:  ASSEM                                              * 00023200
*                                                                     * 00023300
*01* COMPONENT:  SC1C5                                                * 00023400
*                                                                     * 00023500
*01* DISTRIBUTION LIBRARY: AMACLIB                                    * 00023600
*                                                                     * 00023700
*01* EXAMPLES:                                                        * 00023800
*                                                                     * 00023900
*    None.                                                            * 00024000
*                                                                     * 00024100
*01* MACRO USAGE NOTES:                                               * 00024200
*                                                                     * 00024300
*                                                                     * 00024400
*    1.  Printing of the macro expansion is controlled by the ZPRINT  * 00024500
*        global macro variable.  Any value other than 'NO' will       * 00024600
*        result in the macro expansion being printed.  The default is * 00024700
*        'YES'.  The following examples illustrate how the ZPRINT     * 00024800
*        variable should be set.                                      * 00024900
*                                                                     * 00025000
*                    GBLC &ZPRINT                                     * 00025100
*            &ZPRINT SETC 'YES'          &ZPRINT SETC 'NO'            * 00025200
*                                                                     * 00025300
*                                                                     * 00025400
*                                                                     * 00025500
*01* CHANGE ACTIVITY:                                                 * 00025600
*                                                                     * 00025700
*   Flag LineItem  FMID    Date   ID    Comment                       * 00025800
*                                                                     * 00025900
*    $H0=TX       HBB7790 110101 PD00XB:  TX                          * 00026000
*    $H1=TX       HBB7790 110101 PD00XB:  TX                          * 00026100
****** END OF SPECIFICATIONS *****************************************/ 00026200
*/********************************************************************* 00026300
         MACRO                                                          00026400
&XLABEL  IEATXDC &SCOPE=,&OPERATION=,&RETCODE=                          00026500
.*                                                                      00026600
*                MACDATE -05/30/18-<0>                                  00026700
.*                                                                      00026800
.*******************************************************************    00026900
.***AB.02  GLOBAL VARIABLES TO CONTROL PRINT AND CODE GENERATION        00027000
.*******************************************************************    00027100
                GBLC  &ZPRINT     YES=PRINT NO=NO PRINT                 00027200
                GBLC  &ZTEST      YES=TEST NO=NO TEST                   00027300
                GBLC  &ZSYSTEM    PCCODE10, MVS, SAK, VM, XAX           00027400
.*                                                                      00027500
                GBLC  &ZIEATXDC   YES=MACRO USED AT LEAST ONCE          00027600
.*******************************************************************    00027700
.***AB.03  COMMONLY USED LOCAL MACRO VARIABLES                          00027800
.*******************************************************************    00027900
                LCLC  &ZMS        ERROR MESSAGE WORK AREA               00028000
                LCLC  &ZCNDX      SYSNDX CHARACTERS                     00028100
                LCLC  &ZCLNG      USED WHEN LENGTH IS NEEDED            00028200
                LCLC  &ZCGPR      USED WHEN VALUE IS IN A GPR           00028300
                LCLC  &ZCVAL      USED TO CONTAIN FIXED VALUE           00028400
                LCLA  &ZAWRK      USED AS A WORK AREA                   00028500
                LCLA  &ZASIZ      USED FOR SIZE OF VALUE                00028600
                LCLA  &ZN         NUMERIC WORK VARIABLE                 00028700
                LCLC  &ZC         CHARACTER WORK VARIABLE               00028800
                LCLC  &ZTLC       CHARACTER TOO LONG VARIABLE           00028900
                LCLA  &ZTLA       VALUE TOO LONG VARIABLE               00029000
                LCLC  &ZMAC_G     "G" or null                           00029100
&ZMAC_G         SETC  ''                                                00029200
                LCLC  &ZMAC_LR                                          00029300
&ZMAC_LR        SETC  'LR'                                              00029400
                LCLC  &ZMAC_L                                           00029500
&ZMAC_L         SETC  'L'                                               00029600
                LCLC  &ZMAC_ST                                          00029700
&ZMAC_ST        SETC  'ST'                                              00029800
                LCLC  &ZMAC_LLGT                                        00029900
&ZMAC_LLGT      SETC  'L'                                               00030000
                LCLC  &ZMAC_LGR                                         00030100
&ZMAC_LGR       SETC  'LR'                                              00030200
                LCLC  &ZMAC_LG                                          00030300
&ZMAC_LG        SETC  'L'                                               00030400
                LCLC  &ZMAC_STG                                         00030500
&ZMAC_STG       SETC  'ST'                                              00030600
                LCLA  &ZMACRET    MACRO RETURN CODE                     00030700
&ZMACRET        SETA  0           ASSUME NO ERRORS                      00030800
.*                                                                      00030900
                LCLC  &ZCSYSLIST(255)           NONXKEY, POS ARRAY      00031000
                LCLA  &ZASYSLNDX  WORK INDEX FOR ZCSYSLIST()            00031100
                LCLA  &ZPLLEN     PARAMETER LIST LENGTH                 00031200
                LCLC  &ZENDBASEPL               End of base PL          00031300
.********************************************************************   00031400
.***AB.05  INVOKE MVS MACROS TO CONTROL CODE GENERATION                 00031500
.********************************************************************   00031600
                GBLC  &SYSSPLV    SP LEVEL 1,2,3 -SPLEVEL               00031700
                GBLC  &SYSASCE    SYSTEM STATE P ANY AR-SYSSTATE        00031800
                GBLA  &SYSALVL    SYSSTATE ARCHLVL                      00031900
                GBLC  &SYSAM64    SYSSTATE AMODE64                      00032000
.*                                                                      00032100
                AIF   (K'&SYSASCE GT 0).ZSYS4   SYS STATE DEFINED       00032200
                AIF   (K'&SYSSPLV GT 0).ZSYS2   SP LEVEL DEFINED        00032300
                SPLEVEL  TEST                                           00032400
.ZSYS2          ANOP  ,                                                 00032500
                AIF   ('&SYSSPLV' EQ '1').ZSYS3  PRE SP 3.1             00032600
                AIF   ('&SYSSPLV' EQ '2').ZSYS3  PRE SP 3.1             00032700
                SYSSTATE TEST                                           00032800
                AGO   .ZSYS4                                            00032900
.ZSYS3          ANOP  ,                                                 00033000
&SYSASCE        SETC  'P'         ASSUME SYSSTATE PRIMARY               00033100
.ZSYS4          ANOP  ,                                                 00033200
                AIF   ('&SYSAM64' NE 'YES').ZSYSN64                     00033300
&ZMAC_LLGT      SETC 'LLGT'                                             00033400
&ZMAC_LGR       SETC 'LGR'                                              00033500
&ZMAC_LG        SETC 'LG'                                               00033600
&ZMAC_STG       SETC 'STG'                                              00033700
.ZSYSN64        ANOP  ,                                                 00033800
&ZMAC_G         SETC 'G'                                                00033900
&ZMAC_LR        SETC 'LGR'                                              00034000
&ZMAC_L         SETC 'LG'                                               00034100
&ZMAC_ST        SETC 'STG'                                              00034200
.*******************************************************************    00034300
.***AB.07  DEFINE ALL MACRO VARIABLES                                   00034400
.*******************************************************************    00034500
                LCLC  &XSCOPE     ++ VALUE                              00034600
                LCLC  &XOPERATION               ++ VALUE                00034700
                LCLC  &XRETCODE   ++ NAME                               00034800
.*******************************************************************    00034900
.***AB.13  DEFINE MACRO VARIABLES FOR INPUT/OUTPUT PROCESSING           00035000
.*******************************************************************    00035100
                LCLC  &ZXSCOPE    ++ INPUT VALUE                        00035200
                LCLC  &ZXOPERATION              ++ INPUT VALUE          00035300
                LCLC  &ZXRETCODE  ++ OUTPUT NAME                        00035400
.********************************************************************   00035500
.***AG.MF02  FULL MACRO SYNTAX CHECKING                                 00035600
.********************************************************************   00035700
                ACTR  10000                                             00035800
.*------------------------------------------------------------------    00035900
.***AG.KKCTL01 VALUE, RQD INPUT, ME KYWRDCTL -KEYWORD CONTROL           00036000
&XSCOPE         SETC  ''          INITIALIZE XVARIABLE                  00036100
.*-------------------------------------------------------------------   00036200
.***AG.KKCTL02 VALUE, RQD INPUT, ME KYWRDCTL -KEYWORD CONTROL           00036300
.ZG3            ANOP  ,                                                 00036400
                AIF   (K'&SCOPE(1) LE 0).ZG3A                           00036500
&ZTLC           SETC 'PROBLEM'                                          00036600
                AIF   ('&SCOPE(1)' NE '&ZTLC').ZG4                      00036700
&XSCOPE         SETC  'PROBLEM'   SET KEYWORD                           00036800
                AIF   (N'&SCOPE LE 1).ZG3A      CK NUM                  00036900
&ZMS            SETC  '"SCOPE='                                         00037000
&ZMS            SETC  '&ZMS.&SCOPE"'                                    00037100
&ZMS            SETC  '&ZMS "SCOPE"'                                    00037200
                MNOTE 8,' &ZMS CAN HAVE ONLY 1 ARGUMENT.'               00037300
&ZMACRET        SETA  8           SET MACRO ERROR RETURN CODE           00037400
.ZG3A           ANOP  ,                                                 00037500
.*-------------------------------------------------------------------   00037600
.***AG.KKCTL02 VALUE, RQD INPUT, ME KYWRDCTL -KEYWORD CONTROL           00037700
.ZG4            ANOP  ,                                                 00037800
&ZTLC           SETC 'ALL'                                              00037900
                AIF   ('&SCOPE(1)' NE '&ZTLC').ZG5                      00038000
&XSCOPE         SETC  'ALL'       SET KEYWORD                           00038100
                AIF   (N'&SCOPE LE 1).ZG4A      CK NUM                  00038200
&ZMS            SETC  '"SCOPE='                                         00038300
&ZMS            SETC  '&ZMS.&SCOPE"'                                    00038400
&ZMS            SETC  '&ZMS "SCOPE"'                                    00038500
                MNOTE 8,' &ZMS CAN HAVE ONLY 1 ARGUMENT.'               00038600
&ZMACRET        SETA  8           SET MACRO ERROR RETURN CODE           00038700
.ZG4A           ANOP  ,                                                 00038800
.*------------------------------------------------------------------    00038900
.***AG.KKCTL04 VALUE, RQD INPUT, ME KYWRDCTL -KEYWORD CONTROL           00039000
.ZG5            ANOP  ,                                                 00039100
&ZXSCOPE        SETC  'INPUT'     SET IN/OUTPUT                         00039200
                AIF   (K'&XSCOPE GT 0).ZG5E     VALID ARG               00039300
                AIF   (T'&SCOPE EQ 'O').ZG5D    OMITTED                 00039400
&ZASYSLNDX      SETA  0                                                 00039500
.ZG5A           ANOP  ,           POSITIONAL MACRO KEY                  00039600
&ZASYSLNDX      SETA  &ZASYSLNDX+1                                      00039700
                AIF   (&ZASYSLNDX GT N'&SYSLIST).ZG5C                   00039800
&ZTLC           SETC 'SCOPE'                                            00039900
                AIF   ('&SYSLIST(&ZASYSLNDX)' NE '&ZTLC').ZG5A          00040000
.ZG5B           ANOP  ,                                                 00040100
&ZXSCOPE        SETC  ''          RESET IN/OUTPUT                       00040200
&ZMS            SETC  'THE "SCOPE" KEY'                                 00040300
&ZMS            SETC  '&ZMS MUST CONTAIN ONE'                           00040400
                MNOTE 8,' &ZMS (OR MORE) ARGUMENT(S).'                  00040500
&ZMACRET        SETA  8           SET MACRO ERROR RETURN CODE           00040600
                AGO   .ZG5E                                             00040700
.ZG5C           ANOP  ,                                                 00040800
&ZXSCOPE        SETC  ''          RESET IN/OUTPUT                       00040900
&ZMS            SETC  '"SCOPE='                                         00041000
&ZMS            SETC  '&ZMS.&SCOPE"'                                    00041100
&ZMS            SETC  '&ZMS ARGUMENT 1 IS AN UNKNOWN KEYWORD. '         00041200
&ZMS            SETC  '&ZMS VALID KEYWORD CHOICE(S) ARE:'               00041300
&ZMS            SETC  '&ZMS "PROBLEM"'                                  00041400
&ZMS            SETC  '&ZMS OR "ALL".'                                  00041500
                MNOTE 8,' &ZMS '                                        00041600
&ZMACRET        SETA  8           SET MACRO ERROR RETURN CODE           00041700
                AGO   .ZG5E                                             00041800
.ZG5D           ANOP  ,                                                 00041900
&XSCOPE         SETC  'PROBLEM'   SET DEFAULT KEYWORD                   00042000
.ZG5E           ANOP  ,                                                 00042100
.*------------------------------------------------------------------    00042200
.***AG.KKCTL05 VALUE, RQD INPUT, ME KYWRDCTL -KEYWORD CONTROL           00042300
                AIF   (K'&SCOPE(1) GT 0).ZG5F   PARM                    00042400
&XSCOPE         SETC  ''          ENSURE NULL KEYWORD                   00042500
&ZXSCOPE        SETC  ''          RESET IN/OUTPUT                       00042600
&ZMS            SETC  'THE'                                             00042700
&ZMS            SETC  '&ZMS "SCOPE" KEY AND ITS'                        00042800
&ZMS            SETC  '&ZMS ARGUMENT ARE REQUIRED.'                     00042900
&ZMS            SETC  '&ZMS VALID KEYWORD CHOICE(S) ARE:'               00043000
&ZMS            SETC  '&ZMS "PROBLEM"'                                  00043100
&ZMS            SETC  '&ZMS OR "ALL".'                                  00043200
                MNOTE 8,' &ZMS '                                        00043300
&ZMACRET        SETA  8           SET MACRO ERROR RETURN CODE           00043400
.ZG5F           ANOP  ,                                                 00043500
.*------------------------------------------------------------------    00043600
.***AG.KKCTL01 VALUE, RQD INPUT, ME KYWRDCTL -KEYWORD CONTROL           00043700
&XOPERATION     SETC  ''          INITIALIZE XVARIABLE                  00043800
.*-------------------------------------------------------------------   00043900
.***AG.KKCTL02 VALUE, RQD INPUT, ME KYWRDCTL -KEYWORD CONTROL           00044000
.ZG8            ANOP  ,                                                 00044100
                AIF   (K'&OPERATION(1) LE 0).ZG8A                       00044200
&ZTLC           SETC 'NO_ABORT'                                         00044300
                AIF   ('&OPERATION(1)' NE '&ZTLC').ZG9                  00044400
&XOPERATION     SETC  'NO_ABORT'  SET KEYWORD                           00044500
                AIF   (N'&OPERATION LE 1).ZG8A  CK NUM                  00044600
&ZMS            SETC  '"OPERATION='                                     00044700
&ZMS            SETC  '&ZMS.&OPERATION"'                                00044800
&ZMS            SETC  '&ZMS "OPERATION"'                                00044900
                MNOTE 8,' &ZMS CAN HAVE ONLY 1 ARGUMENT.'               00045000
&ZMACRET        SETA  8           SET MACRO ERROR RETURN CODE           00045100
.ZG8A           ANOP  ,                                                 00045200
.*-------------------------------------------------------------------   00045300
.***AG.KKCTL02 VALUE, RQD INPUT, ME KYWRDCTL -KEYWORD CONTROL           00045400
.ZG9            ANOP  ,                                                 00045500
&ZTLC           SETC 'SET_EVERY'                                        00045600
                AIF   ('&OPERATION(1)' NE '&ZTLC').ZG10                 00045700
&XOPERATION     SETC  'SET_EVERY'               SET KEYWORD             00045800
                AIF   (N'&OPERATION LE 1).ZG9A  CK NUM                  00045900
&ZMS            SETC  '"OPERATION='                                     00046000
&ZMS            SETC  '&ZMS.&OPERATION"'                                00046100
&ZMS            SETC  '&ZMS "OPERATION"'                                00046200
                MNOTE 8,' &ZMS CAN HAVE ONLY 1 ARGUMENT.'               00046300
&ZMACRET        SETA  8           SET MACRO ERROR RETURN CODE           00046400
.ZG9A           ANOP  ,                                                 00046500
.*-------------------------------------------------------------------   00046600
.***AG.KKCTL02 VALUE, RQD INPUT, ME KYWRDCTL -KEYWORD CONTROL           00046700
.ZG10           ANOP  ,                                                 00046800
&ZTLC           SETC 'SET_RANDOM'                                       00046900
                AIF   ('&OPERATION(1)' NE '&ZTLC').ZG11                 00047000
&XOPERATION     SETC  'SET_RANDOM'              SET KEYWORD             00047100
                AIF   (N'&OPERATION LE 1).ZG10A  CK NUM                 00047200
&ZMS            SETC  '"OPERATION='                                     00047300
&ZMS            SETC  '&ZMS.&OPERATION"'                                00047400
&ZMS            SETC  '&ZMS "OPERATION"'                                00047500
                MNOTE 8,' &ZMS CAN HAVE ONLY 1 ARGUMENT.'               00047600
&ZMACRET        SETA  8           SET MACRO ERROR RETURN CODE           00047700
.ZG10A          ANOP  ,                                                 00047800
.*------------------------------------------------------------------    00047900
.***AG.KKCTL04 VALUE, RQD INPUT, ME KYWRDCTL -KEYWORD CONTROL           00048000
.ZG11           ANOP  ,                                                 00048100
&ZXOPERATION    SETC  'INPUT'     SET IN/OUTPUT                         00048200
                AIF   (K'&XOPERATION GT 0).ZG11E  VALID ARG             00048300
                AIF   (T'&OPERATION EQ 'O').ZG11D  OMITTED              00048400
&ZASYSLNDX      SETA  0                                                 00048500
.ZG11A          ANOP  ,           POSITIONAL MACRO KEY                  00048600
&ZASYSLNDX      SETA  &ZASYSLNDX+1                                      00048700
                AIF   (&ZASYSLNDX GT N'&SYSLIST).ZG11C                  00048800
&ZTLC           SETC 'OPERATION'                                        00048900
                AIF   ('&SYSLIST(&ZASYSLNDX)' NE '&ZTLC').ZG11A         00049000
.ZG11B          ANOP  ,                                                 00049100
&ZXOPERATION    SETC  ''          RESET IN/OUTPUT                       00049200
&ZMS            SETC  'THE "OPERATION" KEY'                             00049300
&ZMS            SETC  '&ZMS MUST CONTAIN ONE'                           00049400
                MNOTE 8,' &ZMS (OR MORE) ARGUMENT(S).'                  00049500
&ZMACRET        SETA  8           SET MACRO ERROR RETURN CODE           00049600
                AGO   .ZG11E                                            00049700
.ZG11C          ANOP  ,                                                 00049800
&ZXOPERATION    SETC  ''          RESET IN/OUTPUT                       00049900
&ZMS            SETC  '"OPERATION='                                     00050000
&ZMS            SETC  '&ZMS.&OPERATION"'                                00050100
&ZMS            SETC  '&ZMS ARGUMENT 1 IS AN UNKNOWN KEYWORD. '         00050200
&ZMS            SETC  '&ZMS VALID KEYWORD CHOICE(S) ARE:'               00050300
&ZMS            SETC  '&ZMS "NO_ABORT",'                                00050400
&ZMS            SETC  '&ZMS "SET_EVERY",'                               00050500
&ZMS            SETC  '&ZMS OR "SET_RANDOM".'                           00050600
                MNOTE 8,' &ZMS '                                        00050700
&ZMACRET        SETA  8           SET MACRO ERROR RETURN CODE           00050800
                AGO   .ZG11E                                            00050900
.ZG11D          ANOP  ,                                                 00051000
&XOPERATION     SETC  'NO_ABORT'  SET DEFAULT KEYWORD                   00051100
.ZG11E          ANOP  ,                                                 00051200
.*------------------------------------------------------------------    00051300
.***AG.KKCTL05 VALUE, RQD INPUT, ME KYWRDCTL -KEYWORD CONTROL           00051400
                AIF   (K'&OPERATION(1) GT 0).ZG11F  PARM                00051500
&XOPERATION     SETC  ''          ENSURE NULL KEYWORD                   00051600
&ZXOPERATION    SETC  ''          RESET IN/OUTPUT                       00051700
&ZMS            SETC  'THE'                                             00051800
&ZMS            SETC  '&ZMS "OPERATION" KEY AND ITS'                    00051900
&ZMS            SETC  '&ZMS ARGUMENT ARE REQUIRED.'                     00052000
&ZMS            SETC  '&ZMS VALID KEYWORD CHOICE(S) ARE:'               00052100
&ZMS            SETC  '&ZMS "NO_ABORT",'                                00052200
&ZMS            SETC  '&ZMS "SET_EVERY",'                               00052300
&ZMS            SETC  '&ZMS OR "SET_RANDOM".'                           00052400
                MNOTE 8,' &ZMS '                                        00052500
&ZMACRET        SETA  8           SET MACRO ERROR RETURN CODE           00052600
.ZG11F          ANOP  ,                                                 00052700
.*----------------------------------------------------------------***   00052800
.***AG.KXVAR05 NAME, OPT OUTPUT, KEYS -XVARIABLE KEY                    00052900
                AIF   (N'&RETCODE LE 1).ZG13A   CK NUM                  00053000
&ZMS            SETC  '"RETCODE='                                       00053100
&ZMS            SETC  '&ZMS.&RETCODE"'                                  00053200
&ZMS            SETC  '&ZMS "RETCODE"'                                  00053300
                MNOTE 8,' &ZMS CAN HAVE ONLY 1 ARGUMENT.'               00053400
&ZMACRET        SETA  8           SET MACRO ERROR RETURN CODE           00053500
.ZG13A          ANOP  ,                                                 00053600
.*-------------------------------------------------------------------   00053700
.***AG.KXVAR14 NAME, OPT OUTPUT, KEYS -XVARIABLE                        00053800
                AIF   (K'&RETCODE(1) LE 0).ZG13C  NO PARM               00053900
&ZXRETCODE      SETC  'OUTPUT'    SET OUTPUT                            00054000
&XRETCODE       SETC  '&RETCODE(1)'             SET XVARIABLE           00054100
                AIF   (N'&RETCODE GT 1).ZG13C                           00054200
&XRETCODE       SETC  '&RETCODE'  SET XVARIABLE                         00054300
.ZG13C          ANOP  ,                                                 00054400
.*-------------------------------------------------------------------   00054500
.***AG.KCK02 NAME, OPT OUTPUT, KEYS -GPR OUT OF RANGE                   00054600
                AIF   (K'&ZXRETCODE LE 0).ZG13R  NOT I/O                00054700
                AIF   ('&XRETCODE'(1,1) NE '(').ZG13R                   00054800
&ZCGPR          SETC  '&XRETCODE'(2,K'&XRETCODE-2)                      00054900
                AIF   ('&ZCGPR'(1,1) NE '0').ZG13P                      00055000
                AIF   (K'&ZCGPR GT 2).ZG13Q                             00055100
                AIF   ('&ZCGPR' EQ '0').ZG13Q                           00055200
&ZCGPR          SETC  '&ZCGPR'(2,1)                                     00055300
                AIF   (T'&ZCGPR NE 'N').ZG13Q   INVALID REG NAME        00055400
.ZG13P          ANOP  ,                                                 00055500
                AIF   (T'&ZCGPR NE 'N').ZG13R   NON NUMERIC             00055600
                AIF   ('&ZCGPR' EQ '15').ZG13R                          00055700
                AIF   ('&ZCGPR' LT '2').ZG13Q                           00055800
                AIF   ('&ZCGPR' LE '12').ZG13R                          00055900
.ZG13Q          ANOP  ,                                                 00056000
&ZMS            SETC  '"RETCODE='                                       00056100
&ZMS            SETC  '&ZMS.&RETCODE"'                                  00056200
&ZMS            SETC  '&ZMS ARGUMENT 1 MUST SPECIFY A REGISTER'         00056300
                MNOTE 8,' &ZMS IN THE RANGE (2)-(12) OR (15).'          00056400
&ZMACRET        SETA  8           SET MACRO ERROR RETURN CODE           00056500
.ZG13R          ANOP  ,                                                 00056600
.******************************************************************     00056700
.***AH.P00 CHECK STANDALONE POSITIONAL VARIABLES                        00056800
.******************************************************************     00056900
                ACTR  10000                                             00057000
.*----------------------------------------------------------------***   00057100
.***AH.P02 EXTRA POSITIONALS                                            00057200
                AIF   (N'&SYSLIST LE 0).ZGLISTX  NO EXTRAS              00057300
                AIF   (N'&SYSLIST NE 2).ZGLISTX1  NOT NULL              00057400
                AIF   ('&SYSLIST(1)' NE '').ZGLISTX1  NOT NULL          00057500
                AIF   ('&SYSLIST(2)' EQ '').ZGLISTX  NOT NULL           00057600
.ZGLISTX1       ANOP  ,                                                 00057700
&ZCVAL          SETC  ''          ERROR FIELD                           00057800
&ZAWRK          SETA  0           POSITIONAL NUMBER                     00057900
.ZGLIST2        ANOP  ,                                                 00058000
&ZAWRK          SETA  &ZAWRK+1    NEXT POSITIONAL                       00058100
                AIF   (&ZAWRK GT N'&SYSLIST).ZGLIST3  DONE              00058200
&ZCVAL          SETC '&ZCVAL,&SYSLIST(&ZAWRK)'  EXTRA                   00058300
                AGO   .ZGLIST2                                          00058400
.*                                                                      00058500
.ZGLIST3        ANOP  ,                                                 00058600
&ZCVAL          SETC '&ZCVAL'(2,K'&ZCVAL-1)     STRIP COMMA             00058700
&ZMS            SETC  'POSITIONAL ARGUMENT(S),'                         00058800
&ZMS            SETC  '&ZMS "&ZCVAL"'                                   00058900
&ZMS            SETC  '&ZMS CANNOT BE USED.'                            00059000
&ZMS            SETC  '&ZMS NO POSITIONAL ARGUMENTS'                    00059100
                MNOTE 8,' &ZMS ARE ALLOWED.'                            00059200
&ZMACRET        SETA  8           SET MACRO ERROR RETURN CODE           00059300
.ZGLISTX        ANOP  ,                                                 00059400
&ZASYSLNDX      SETA  0                                                 00059500
.*******************************************************************    00059600
.***AE.ZMR01 NO CODE GENERATED IF ERRORS DETECTED                       00059700
.*******************************************************************    00059800
                AIF   (&ZMACRET NE 0).ZLX2      ERROR DETECTED          00059900
.*******************************************************************    00060000
.***AE.01  START OF IEATXDC MACRO CODE                                  00060100
.*******************************************************************    00060200
                LCLC  &M0M0001                 NAME                     00060300
&M0M0001        SETC  '&XLABEL'                SET NAME                 00060400
                AIF   (K'&XLABEL NE 0).XLAB2                            00060500
&M0M0001        SETC  'M00M&SYSNDX'            DEFAULT NAME             00060600
.*                                                                      00060700
.XLAB2          ANOP  ,                                                 00060800
&M0M0001 DS    0H                             IEATXDC-0                 00060900
.*******************************************************************    00061000
.***AE.PR01 PRINT CONTROLS, DEFAULT IS YES                              00061100
.*******************************************************************    00061200
              PUSH  PRINT                                               00061300
                AIF   ('&ZPRINT' NE 'NO').ZPRINTX  TURN PRINT ON        00061400
                PRINT OFF         ++ PR01                               00061500
                AGO   .ZPRNTXX                                          00061600
.ZPRINTX        PRINT ON                                                00061700
.ZPRNTXX        ANOP  ,                                                 00061800
.*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*  00061900
.*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*  00062000
.********************************************************************   00062100
.***AL.A01  INTERNAL ARRAY TO PRODUCE FORMATTED CODE                    00062200
.********************************************************************   00062300
                      LCLA  &ZOPN          LIST INSTRUCTION INDEX       00062400
                      LCLA  &ZOPN1         INVOCATION INDEX             00062500
                      LCLC  &ZOPL(4095)    LABEL                        00062600
                      LCLC  &ZOPO(4095)    OPERATION                    00062700
                      LCLC  &ZOPV(4095)    VALUE                        00062800
                      LCLC  &ZOPD(4095)    DESCRIPTION                  00062900
.*                                                                      00063000
&ZOPN                 SETA  0              INITIAL INST INDEX VALUE     00063100
.*-------------------------------------------------------------------   00063200
&ZOPN1                SETA &ZOPN                                        00063300
.*******************************************************************    00063400
.***AO.X02  RETURN CODE PROCESSING                                      00063500
.*******************************************************************    00063600
                      AIF   (N'&RETCODE LE 0).ZMRETX                    00063700
                      AIF   ('&XRETCODE'(1,1) EQ '(').ZMRET2            00063800
                      AIF   ('&XRETCODE' EQ 'GPR15').ZMRETX             00063900
                      AIF   ('&XRETCODE' EQ 'REG15').ZMRETX             00064000
                      AIF   ('&XRETCODE' EQ 'R15').ZMRETX               00064100
                      AIF   ('&XRETCODE' EQ '15').ZMRETX                00064200
&ZOPN                 SETA  &ZOPN+1                                     00064300
&ZOPL(&ZOPN)          SETC  ' '                                         00064400
&ZOPO(&ZOPN)          SETC  'ST'                                        00064500
&ZOPV(&ZOPN)          SETC  '15,&XRETCODE'                              00064600
&ZOPD(&ZOPN)          SETC  '++ SET RETURN CODE'                        00064700
                      AGO   .ZMRETX                                     00064800
.*                                                                      00064900
.ZMRET2               ANOP  ,                                           00065000
&ZCGPR                SETC  '&XRETCODE'(2,K'&XRETCODE-2)                00065100
                      AIF   ('&ZCGPR' EQ 'GPR15').ZMRETX                00065200
                      AIF   ('&ZCGPR' EQ 'REG15').ZMRETX                00065300
                      AIF   ('&ZCGPR' EQ 'R15').ZMRETX                  00065400
                      AIF   ('&ZCGPR' EQ '15').ZMRETX                   00065500
&ZOPN                 SETA  &ZOPN+1                                     00065600
&ZOPL(&ZOPN)          SETC  ' '                                         00065700
&ZOPO(&ZOPN)          SETC  '&ZMAC_LR'                                  00065800
&ZOPV(&ZOPN)          SETC  '&ZCGPR,15'                                 00065900
&ZOPD(&ZOPN)          SETC  '++ SET RETURN CODE'                        00066000
.ZMRETX               ANOP  ,                                           00066100
.*******************************************************************    00066200
.***AO.X05  FORMAT GENERATED INSTRUCTIONS                               00066300
.*******************************************************************    00066400
                      ACTR  10000                                       00066500
.*                                                                      00066600
                      LCLA  &ZLC           COLUMN POSITION              00066700
                      LCLA  &ZOPX          LIST TABLE INDEX             00066800
                      LCLC  &ZLL           LABEL                        00066900
                      LCLC  &ZLOP          OPERATION                    00067000
                      LCLC  &ZLV           VALUE                        00067100
                      LCLC  &ZLD           DESCRIPTION                  00067200
.*                                                                      00067300
&ZOPX                 SETA  1                                           00067400
.ZL2                  AIF   (&ZOPX GT &ZOPN1).ZLX  B IF DONE            00067500
&ZLL                  SETC  '&ZOPL(&ZOPX)'                              00067600
&ZLOP                 SETC  '&ZOPO(&ZOPX)'                              00067700
&ZLV                  SETC  '&ZOPV(&ZOPX)'                              00067800
&ZLD                  SETC  '&ZOPD(&ZOPX)'                              00067900
                      AIF   (K'&ZLD LE 0).ZL5                           00068000
&ZLC                  SETA  35             COMMENT COLUMN               00068100
                      AIF   ('&ZLD'(1,1) NE '*').ZL3                    00068200
&ZLC                  SETA  33             COMMMENT COLUMN              00068300
.ZL3                  AIF   (K'&ZLV GE &ZLC-16-1).ZL4                   00068400
&ZLV                  SETC  '&ZLV'.' '                                  00068500
                      AGO   .ZL3                                        00068600
.*                                                                      00068700
.ZL4                  ANOP  ,                                           00068800
&ZLV                  SETC  '&ZLV'.' '                                  00068900
.ZL5                  ANOP  ,                                           00069000
&ZLV                  SETC  '&ZLV'.'&ZLD'                               00069100
.*                                                                      00069200
&ZLL     &ZLOP &ZLV                                                     00069300
.*                                                                      00069400
&ZOPX                 SETA  &ZOPX+1        NEXT STRUCTURE               00069500
                      AGO   .ZL2           CONTINUE LOOPING             00069600
.*                                                                      00069700
.ZLX                  ANOP  ,                                           00069800
.*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*  00069900
&ZAWRK     SETA  256                                               @H1A 00070000
           AIF   ('&SCOPE(1)' NE 'PROBLEM').Not_Problem            @H1A 00070100
&ZAWRK     SETA  0                                                 @H1A 00070200
.Not_Problem ANOP                                                  @H1A 00070300
           AIF   ('&OPERATION(1)' NE 'NO_ABORT').Not_NO_ABORT      @H1A 00070400
           AGO   .Issue_PC                                         @H1A 00070500
.Not_NO_ABORT ANOP                                                 @H1A 00070600
           AIF   ('&OPERATION(1)' NE 'SET_EVERY').Not_SET_EVERY    @H1A 00070700
&ZAWRK     SETA  &ZAWRK+1           Indicate SET_EVERY             @H1A 00070800
           AGO   .Issue_PC                                         @H1A 00070900
.Not_SET_EVERY ANOP                                                @H1A 00071000
           AIF   ('&OPERATION(1)' NE 'SET_RANDOM').Not_SET_RANDOM  @H1A 00071100
&ZAWRK     SETA  &ZAWRK+2           Indicate SET_RANDOM            @H1A 00071200
           AGO   .Issue_PC                                         @H1A 00071300
.Not_SET_RANDOM ANOP                                               @H1A 00071400
.Issue_PC  ANOP                                                    @H1A 00071500
           LHI   1,&ZAWRK           Indicate function              @H1A 00071600
           LG    15,72(0,0)         Get CVT address                @H1A 00071700
           L     15,772(15,0)       Get SFT address                @H1A 00071800
           L     15,616(15,0)       Get PC number from slot 155    @H1A 00071900
           PC    0(R15)             Call service                   @H1A 00072000
.*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*  00072100
.*******************************************************************    00072200
.***AP.X01  FORMAT GENERATED CODE                                       00072300
.ZL21                 AIF   (&ZOPX GT &ZOPN).ZLX1  B IF DONE            00072400
&ZLL                  SETC  '&ZOPL(&ZOPX)'                              00072500
&ZLOP                 SETC  '&ZOPO(&ZOPX)'                              00072600
&ZLV                  SETC  '&ZOPV(&ZOPX)'                              00072700
&ZLD                  SETC  '&ZOPD(&ZOPX)'                              00072800
                      AIF   (K'&ZLD LE 0).ZL51                          00072900
&ZLC                  SETA  35             COMMENT COLUMN               00073000
                      AIF   ('&ZLD'(1,1) NE '*').ZL31                   00073100
&ZLC                  SETA  33             COMMENT COLUMN               00073200
.ZL31                 AIF   (K'&ZLV GE &ZLC-16-1).ZL41                  00073300
&ZLV                  SETC  '&ZLV'.' '                                  00073400
                      AGO   .ZL31                                       00073500
.*                                                                      00073600
.ZL41                 ANOP  ,                                           00073700
&ZLV                  SETC  '&ZLV'.' '                                  00073800
.ZL51                 ANOP  ,                                           00073900
&ZLV                  SETC  '&ZLV'.'&ZLD'                               00074000
.*                                                                      00074100
&ZLL     &ZLOP &ZLV                                                     00074200
.*                                                                      00074300
&ZOPX                 SETA  &ZOPX+1        NEXT STRUCTURE               00074400
                      AGO   .ZL21          CONTINUE LOOPING             00074500
.*                                                                      00074600
.ZLX1                 ANOP  ,                                           00074700
.*******************************************************************    00074800
.***AP.X02  END OF IEATXDC MACRO                                        00074900
&ZIEATXDC             SETC  'YES'          SET IEATXDC USED             00075000
         POP   PRINT                                                    00075100
*                                            IEATXDC-0                  00075200
         SPACE 1                                                        00075300
.ZLX2                 ANOP  ,                                           00075400
         MEND                                                           00075500
**********************************************************************/ 00075600
*/*PB.OC01 INVOKE MACRO---------------------------------------------*/  00075700
*%IEATXDC: MACRO KEYS(SCOPE,OPERATION,RETCODE);                         00075800
*  ANS('?'!!MACLABEL!!' '!!'IEATXDCP '!!MACLIST!!                       00075900
*         ' '!!MACKEYS!!';') COL(MACLMAR);                              00076000
*%END IEATXDC;                                                          00076100
