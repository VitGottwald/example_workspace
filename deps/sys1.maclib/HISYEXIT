*                                                                       00001000
* %DCL HISYEXIT_INCLUDED CHAR EXT;                                      00002000
* %DEACTIVATE HISYEXIT_INCLUDED;                                        00003000
* %IF HISYEXIT_INCLUDED = '' %THEN                                      00004000
* %DO;                                                                  00005000
*/* Macro made bi-lingual on 15289. CBGEN compile date 12258         */ 00006000
*% /*                                                                   00007000
         MACRO                                                          00008000
         HISYEXIT &DSECT=YES,&LIST=YES,&TITLE=YES,&HisExitParm=YES,    *00009000
               &HisServParm=COND,&HisStatParm=COND                      00010000
                      GBLC  &HISYEXIT_INCLUDED                          00011000
                      GBLC  &ZCBPRINT                                   00012000
&HISYEXIT_INCLUDED    SETC  'YES'                                       00013000
                      AIF   ('&LIST' EQ 'NONE').P0                      00014000
                      AIF   ('&TITLE' EQ 'NO').P5                       00015000
 TITLE                'HISYEXIT  - HISSERV Exit Routine Interface      *00016000
                           '                                            00017000
.P5                   ANOP                                              00018000
**/ HISYEXIT_1:;                                                        00019000
*/****START OF SPECIFICATIONS****************************************** 00020000
*                                                                       00021000
*01* MACRO NAME: HISYEXIT                                               00022000
*                                                                       00023000
*01* DESCRIPTIVE NAME: HISSERV Exit Routine Interface                   00024000
*02*  ACRONYM: N/A                                                      00025000
*                                                                       00026000
*01* PROPRIETARY STATEMENT=                                           * 00027000
***PROPRIETARY_STATEMENT*********************************************** 00028000
*                                                                     * 00029000
*   LICENSED MATERIALS - PROPERTY OF IBM                              * 00030000
*   5650-ZOS COPYRIGHT IBM CORP. 2013                                 * 00031000
*                                                                     * 00032000
*   STATUS= HBB7790                                                   * 00033000
*                                                                     * 00034000
***END_OF_PROPRIETARY_STATEMENT**************************************** 00035000
*                                                                       00036000
*01* EXTERNAL CLASSIFICATION:  PI                                       00037000
*01* END OF EXTERNAL CLASSIFICATION:                                    00038000
*                                                                       00039000
*01* DSECT NAME:                                                        00040000
*        HisExitParm                                                    00041000
*        HisServParm                                                    00042000
*        HisStatParm                                                    00043000
*                                                                       00044000
*01* COMPONENT: Hardware Instrumentation Services (SCHIS)               00045000
*                                                                       00046000
*01* EYE-CATCHER:                                                       00047000
*        HisExitParm -- NONE                                            00048000
*        HisServParm -- NONE                                            00049000
*        HisStatParm -- NONE                                            00050000
*02*  OFFSET:  NONE                                                     00051000
*02*  LENGTH:  NONE                                                     00052000
*                                                                       00053000
*01* FUNCTION: Maps the parameter area passed to the exit routine       00054000
*              specified either by the EXITRTN parameter of a           00055000
*              HISSERV REQUEST=PROFILE,TYPE=START request, or           00056000
*              registered for the HIS.SERVSTAT dynamic exit.            00057000
*                                                                       00058000
*01* METHOD OF ACCESS:                                                  00059000
*                                                                       00060000
*02*   PL/X:                                                            00061000
*        %INCLUDE SYSLIB(HISYEXIT)                                      00062000
*                                                                       00063000
*02*   ASM:                                                             00064000
*        HISYEXIT                                                       00065000
*            DSECT=YES!NO            -- Request DSECT definition        00066000
*            HISEXITPARM=YES!NO!COND -- Request HisExitParm mapping     00067000
*            HISSERVPARM=YES!NO!COND -- Request HisServParm mapping     00068000
*            HISSTATPARM=YES!NO!COND -- Request HisStatParm mapping     00069000
*                                                                       00070000
*     Default: DSECT=YES,HISEXITPARM=YES,HISSERVPARM=COND,              00071000
*              HISSTATPARM=COND                                         00072000
*     Notes: name=YES  => expand                                        00073000
*            name=NO   => do not expand                                 00074000
*            name=COND => expand only if DSECT=YES                      00075000
*                                                                       00076000
*01* SIZE:                                                              00077000
*        HisExitParm -- X'0004' bytes                                   00078000
*        HisServParm -- X'0008' bytes                                   00079000
*        HisStatParm -- X'0010' bytes                                   00080000
*                                                                       00081000
*01* POINTED TO BY:                                                     00082000
*        Register 1 on entry to the exit routine                        00083000
*                                                                       00084000
*01* CREATED BY: Caller                                                 00085000
*                                                                       00086000
*01* DELETED BY: Caller                                                 00087000
*                                                                       00088000
*01* STORAGE ATTRIBUTES:                                                00089000
*02*   SUBPOOL:    230 (HIS Private)                                    00090000
*02*   KEY:        0                                                    00091000
*02*   RESIDENCY:  Above 16M line                                       00092000
*                                                                       00093000
*01* FREQUENCY:  Created for call to exit routine                       00094000
*                                                                       00095000
*01* SERIALIZATION:  None                                               00096000
*                                                                       00097000
*01* DEPENDENCIES:   None                                               00098000
*                                                                       00099000
*01* NOTES:          None                                               00100000
*                                                                       00101000
*01* DISTRIBUTION LIBRARY:  AMACLIB                                     00102000
*                                                                       00103000
*01* EYE-CATCHER:    N/A                                                00104000
*                                                                       00105000
*01* CHANGE-ACTIVITY:                                                   00106000
*                                                                       00107000
* $L0=HISSERV HBB7790 110110 PDBS: HIS Extendability                    00108000
* $01=OA43366 HBB7790 140811 PD0AAA: ZZSIM2 rollup                      00109000
* $02=OA48127 HBB77A0 150611 PD0AAA: HIS sampling interval fix for      00110000
*                                    MT Mode change                     00111000
*                                                                       00112000
****END OF SPECIFICATIONS*********************************************/ 00113000
*% /*                                                                   00114000
.P0                   ANOP                                              00115000
                      AIF   ('&ZCBPRINT' EQ 'NO').P1                    00116000
                      AIF   ('&LIST' EQ 'YES').P2                       00117000
.P1                   ANOP                                              00118000
                      PUSH  PRINT                                       00119000
                      PRINT OFF                                         00120000
.P2                   ANOP                                              00121000
                      AIF   ('&HisExitParm' EQ 'NO').L0002              00122000
                      AIF   ('&DSECT' EQ 'YES').L0003                   00123000
                      AIF   ('&HisExitParm' NE 'YES').L0002             00124000
.L0003                ANOP                                              00125000
*                                                                       00126000
* ********************************************************************  00127000
* *                                                                  *  00128000
* *  The exit routine gets control with no locks in TCB mode,        *  00129000
* *  supervisor state, key zero, in the HIS address space as         *  00130000
* *  H=P=S. The exit routine takes control in the AMODE that was     *  00131000
* *  defined for the exit routine's load module at the time of the   *  00132000
* *  linkedit (for example, by a LOAD action).                       *  00133000
* *                                                                  *  00134000
* *  If the exit routine abends, the exit routine will no longer be  *  00135000
* *  called and the associated profiler will be marked as 'failed'.  *  00136000
* *  To determine whether a profiler is in the 'failed' state use    *  00137000
* *  HISSERV REQUEST=QUERY,TYPE=PROFILERS and examine the            *  00138000
* *  HisProfEntryFlgs_Failed bit.                                    *  00139000
* *                                                                  *  00140000
* *  The register contents at entry to the exit routine              *  00141000
* *  are:                                                            *  00142000
* *                                                                  *  00143000
* *  REGISTER CONTENTS                                               *  00144000
* *  0     Does not contain relevant data                            *  00145000
* *  1     The address to the parameter area mapped by               *  00146000
* *        HisExitParm in macro HISYEXIT                             *  00147000
* *  2-12  Does not contain relevant data                            *  00148000
* *  13    Address to a 216 byte save area                           *  00149000
* *  14    Return Address                                            *  00150000
* *  15    Exit routine entry point address                          *  00151000
* *                                                                  *  00152000
* *  On return, the exit routine must return control in              *  00153000
* *  supervisor state, PSW key zero, with no locks held.             *  00154000
* *  The register contents on return should be as follows:           *  00155000
* *                                                                  *  00156000
* *  REGISTER CONTENTS                                               *  00157000
* *  0-1   Do not need to be preserved                               *  00158000
* *  2-13  Unchanged                                                 *  00159000
* *  14-15 Do not need to be preserved                               *  00160000
* *                                                                  *  00161000
* *  The exit routine is allowed to obtain and release any locks it  *  00162000
* *  desires in order to handle the exit, however performance is a   *  00163000
* *  concern is some cases. For example when the function code is    *  00164000
* *  HisExitParmFunc_kSmp the exit routine is called to process      *  00165000
* *  Sampling Data Blocks (SDBs). These SDBs are also used by the    *  00166000
* *  hardware, meaning if processing takes too long the              *  00167000
* *  hardware will run out of SDBs and sampling data will            *  00168000
* *  be lost.                                                        *  00169000
* *                                                                  *  00170000
* *  The exit is not allowed to issue a HISSERV REQUEST=PROFILE      *  00171000
* *  request, or wait on a resource held by another work unit        *  00172000
* *  which might issue a HISSERV REQUEST=PROFILE request.            *  00173000
* *                                                                  *  00174000
* *  The exit routine must not write into the parameter area.        *  00175000
* *                                                                  *  00176000
* ********************************************************************  00177000
* ********************************************************************  00178000
* * Generic Exit Routine Parameter Area                              *  00179000
* *   Use this mapping to determine why the exit routine was called, *  00180000
* *   and what mapping to use. The parameter area will always start  *  00181000
* *   with this mapping.                                             *  00182000
* ********************************************************************  00183000
*                                                                       00184000
*                                                                       00185000
                      AIF   ('&DSECT' EQ 'YES').L0004                   00186000
HisExitParm           DS    0D                                          00187000
                      AGO   .L0005                                      00188000
.L0004                ANOP                                              00189000
HisExitParm           DSECT                                             00190000
.L0005                ANOP                                              00191000
HisExitParm_Version   DS    H      The version of this parameter area. *00192000
                                   Version and Func identify the       *00193000
                                   complete mapping                     00194000
HisExitParm_Func      DS    H      The function code that describes    *00195000
                                   why the exit routine is being       *00196000
                                   called. Version and Func identify   *00197000
                                   the complete mapping                 00198000
*                                                                       00199000
* ********************************************************************  00200000
* * Exit Routine Function Codes                                      *  00201000
* *   One of the following equates will be set as the                *  00202000
* *   HisExitParm_Func in the parameter area. The mapping to use     *  00203000
* *   on the entire parameter area depends on the function code.     *  00204000
* ********************************************************************  00205000
*                                                                       00206000
*                                                                       00207000
HisExitParmFunc_kServ EQU   1      The exit routine was called because *00208000
                                   the status of the service has       *00209000
                                   changed. The parameter area is      *00210000
                                   mapped by HisServParm in macro      *00211000
                                   HISYEXIT. This function code will   *00212000
                                   only be received by exit routines   *00213000
                                   added to the HIS.SERVSTAT dynamic   *00214000
                                   exit.                                00215000
HisExitParmFunc_kStat EQU   2      The exit routine was called because *00216000
                                   a profiler might need to take some  *00217000
                                   action based on service actions.    *00218000
                                   The parameter area is mapped by     *00219000
                                   HisStatParm in macro HISYEXIT. This *00220000
                                   function code will only be received *00221000
                                   by exit routines added through      *00222000
                                   HISSERV REQUEST=PROFILE,            *00223000
                                   ACTION=START requests.               00224000
HisExitParmFunc_kSmp  EQU   3      The exit routine was called because *00225000
                                   of a sampling exit callback. The    *00226000
                                   parameter area is mapped by         *00227000
                                   HisSmpExit in macro HISYSMPX. This  *00228000
                                   function code will only be received *00229000
                                   by exit routines added through      *00230000
                                   HISSERV REQUEST=PROFILE,            *00231000
                                   ACTION=START requests with          *00232000
                                   SAMPLE=YES                           00233000
HisExitParm_Len       EQU   *-HisExitParm                               00234000
.L0002                ANOP                                              00235000
                      AIF   ('&HisServParm' EQ 'NO').L0006              00236000
                      AIF   ('&DSECT' EQ 'YES').L0007                   00237000
                      AIF   ('&HisServParm' NE 'YES').L0006             00238000
.L0007                ANOP                                              00239000
*                                                                       00240000
* ********************************************************************  00241000
* * The Service Status Changed Exit Function Code Parameter Area     *  00242000
* *   When HisExitParm_Func is HisExitParmFunc_kServ, this mapping   *  00243000
* *   should be used to map the entire parameter area.               *  00244000
* ********************************************************************  00245000
*                                                                       00246000
*                                                                       00247000
                      AIF   ('&DSECT' EQ 'YES').L0008                   00248000
HisServParm           DS    0D                                          00249000
                      AGO   .L0009                                      00250000
.L0008                ANOP                                              00251000
HisServParm           DSECT                                             00252000
.L0009                ANOP                                              00253000
HisServParm_Info      DS    CL4    The common portion of the exit      *00254000
                                   routine parameter area               00255000
HisServParm_Rsn       DS    F      The reason code describing how the  *00256000
                                   HISSERV service has changed          00257000
HisServParm_End       DS    0C                                          00258000
HisServParm_kVersionMax EQU 1                                           00259000
HisServParm_kVersion1 EQU   1                                           00260000
HisServParm_kVersionMin EQU 1                                           00261000
*                                                                       00262000
* ********************************************************************  00263000
* * Service Status Changed Reason Codes                              *  00264000
* *   One of the following equates will be set as the                *  00265000
* *   HisServParm_Rsn in the parameter area.                         *  00266000
* ********************************************************************  00267000
*                                                                       00268000
*                                                                       00269000
HisServParmRsn_kEnabled EQU 1      The service has been enabled. At    *00270000
                                   this point all PROFILE and QUERY    *00271000
                                   requests can be processed.           00272000
HisServParmRsn_kDisabled EQU 2     The service is disabling. Once      *00273000
                                   control is returned from the exit   *00274000
                                   routine, no more PROFILE or QUERY   *00275000
                                   requests will be processed.          00276000
HisServParmRsn_kStarted EQU 3      The service has started profiling   *00277000
                                   the system. This occurs either when *00278000
                                   the first                           *00279000
                                   REQUEST=PROFILE,ACTION=START        *00280000
                                   request for either events or        *00281000
                                   sampling, or after the service has  *00282000
                                   finished updating.                   00283000
HisServParmRsn_kStopped EQU 4      The service has stopped profiling   *00284000
                                   the system. This occurs either when *00285000
                                   the last                            *00286000
                                   REQUEST=PROFILE,ACTION=STOP request *00287000
                                   has been processed, or after the    *00288000
                                   service has stopped because it      *00289000
                                   needs to be updated.                 00290000
HisServParm_Len       EQU   *-HisServParm                               00291000
.L0006                ANOP                                              00292000
                      AIF   ('&HisStatParm' EQ 'NO').L000A              00293000
                      AIF   ('&DSECT' EQ 'YES').L000B                   00294000
                      AIF   ('&HisStatParm' NE 'YES').L000A             00295000
.L000B                ANOP                                              00296000
*                                                                       00297000
* ********************************************************************  00298000
* * The Profiler Status Exit Function Code Parameter Area            *  00299000
* *   When HisExitParm_Func is HisExitParmFunc_kStat, this mapping   *  00300000
* *   should be used to map the entire parameter area.               *  00301000
* ********************************************************************  00302000
*                                                                       00303000
*                                                                       00304000
                      AIF   ('&DSECT' EQ 'YES').L000C                   00305000
HisStatParm           DS    0D                                          00306000
                      AGO   .L000D                                      00307000
.L000C                ANOP                                              00308000
HisStatParm           DSECT                                             00309000
.L000D                ANOP                                              00310000
HisStatParm_Info      DS    CL4    The common portion of the exit      *00311000
                                   routine parameter area               00312000
HisStatParm_Action    DS    F      The action that is being taken,     *00313000
                                   will be one of the                  *00314000
                                   HisStatParmAction_k* equates         00315000
HisStatParm_Rsn       DS    BL4    The reason(s) describing why the    *00316000
                                   profiler was notified. It is        *00317000
                                   possible no bits are on.             00318000
                      ORG   HisStatParm_Rsn                             00319000
HisStatParm_Rsn1      DS    B                                           00320000
*  Bit definitions:                                                     00321000
HisStatParmRsn_HdwrCtrSetDeAuth EQU X'80' The service has detected the *00322000
                                   hardware authorized state of one or *00323000
                                   more enabled hardware counter sets  *00324000
                                   are now deauthorized.                00325000
HisStatParmRsn_HdwrSmpTypDeAuth EQU X'40' The service has detected the *00326000
                                   hardware authorized state of one or *00327000
                                   more enabled sample types are now   *00328000
                                   deauthorized.                        00329000
HisStatParmRsn_HdwrCtrDataLoss EQU X'20' The service has detected that *00330000
                                   counter data has been lost on at    *00331000
                                   least one CPU due to internal       *00332000
                                   hardware reasons.                    00333000
HisStatParmRsn_HdwrSmpDataLoss EQU X'10' The service has detected that *00334000
                                   sampling data has been lost on at   *00335000
                                   least one CPU due to internal       *00336000
                                   hardware reasons.                    00337000
HisStatParmRsn_HdwrCpuSpeedChg EQU X'08' The service has detected that *00338000
                                   the speed of one or more processor  *00339000
                                   types has changed.                   00340000
HisStatParmRsn_ServiceParmsChg EQU X'04' The service parameters have   *00341000
                                   been changed.                        00342000
HisStatParmRsn_HdwrMTCtrDataLoss EQU X'02' The service has detected    *00343000
                                   that MT counter data has been lost  *00344000
                                   on at least one CPU due to internal *00345000
                                   hardware reasons.                    00346000
HisStatParmRsn_HdwrMTModeChg EQU X'01' The service has detected that   *00347000
                                   MT Mode has changed.                 00348000
HisStatParm_Rsn2      DS    B                                           00349000
HisStatParm_Rsn3      DS    B                                           00350000
HisStatParm_Rsn4      DS    B                                           00351000
                      DS    CL4                                         00352000
HisStatParm_End       DS    0C                                          00353000
HisStatParm_kVersionMax EQU 1                                           00354000
HisStatParm_kVersion1 EQU   1                                           00355000
HisStatParm_kVersionMin EQU 1                                           00356000
*                                                                       00357000
* ********************************************************************  00358000
* * Profiler Status Action Codes                                     *  00359000
* *   One of the following equates will be set as the                *  00360000
* *   HisStatParm_Action in the parameter area.                      *  00361000
* ********************************************************************  00362000
*                                                                       00363000
*                                                                       00364000
HisStatParmAction_kNone EQU 1      Profilers are notified of an event  *00365000
                                   the service needs to take no        *00366000
                                   specific action for                  00367000
HisStatParmAction_kUpdateStart EQU 2 The service needs to update       *00368000
                                   itself. Any queries before          *00369000
                                   returning control from the exit     *00370000
                                   routine will reflect the previous   *00371000
                                   state. Once control is returned     *00372000
                                   from the exit routine, if the exit  *00373000
                                   routine normally gets called for    *00374000
                                   sample exit callbacks, it will get  *00375000
                                   control one last time before the    *00376000
                                   update begins for each CPU           00377000
*                                  collecting samples. Until the exit  *00378000
                                   routine gets control again with an  *00379000
                                   action of                           *00380000
                                   HisStatParmAction_kUpdateDone, any  *00381000
                                   QUERY request results may reflect   *00382000
                                   the old or new state of the         *00383000
                                   service. One of the reasons         *00384000
                                   indicated in the HisStatParm_Rsn    *00385000
                                   bitmask is the reason for the       *00386000
                                   required update.                     00387000
HisStatParmAction_kUpdateDone EQU 3 The service has finished updating  *00388000
                                   itself. Note a profiler cannot rely *00389000
                                   on data received prior to this exit *00390000
                                   callback (for example event data    *00391000
                                   values, event info, etc). For this  *00392000
                                   action there is no specific reason  *00393000
                                   indicated in HisStatParm_Rsn, it is *00394000
                                   the consequence of a previous       *00395000
                                   action of                           *00396000
                                   HisStatParmAction_kUpdateStart       00397000
HisStatParm_Len       EQU   *-HisStatParm                               00398000
.L000A                ANOP                                              00399000
                      AIF   ('&ZCBPRINT' EQ 'NO').P3                    00400000
                      AIF   ('&LIST' EQ 'YES').P4                       00401000
.P3                   ANOP                                              00402000
                      POP   PRINT                                       00403000
.P4                   ANOP                                              00404000
.P_EXIT               ANOP                                              00405000
                      MEND                                              00406000
**/ HISYEXIT_2:;                                                        00407000
* %HISYEXIT_INCLUDED = 'YES';                                           00408000
* %DCL ZCBPRINT CHAR EXT;                                               00409000
* %DEACTIVATE ZCBPRINT;                                                 00410000
* %DCL HISYEXIT_LIST CHAR EXT;                                          00411000
* %DEACTIVATE HISYEXIT_LIST;                                            00412000
* %IF HISYEXIT_LIST ^= 'NO' &                                           00413000
*    ZCBPRINT ^= 'NO' %THEN                                             00414000
*   %GOTO HISYEXIT_3;                                                   00415000
*   @LIST PUSH NOECHO;                                                  00416000
*   @LIST NOASSEMBLE NOECHO;                                            00417000
*   @LIST OFF C NOECHO;                                                 00418000
* %HISYEXIT_3:;                                                         00419000
*/* Start of PL/X Source                                             */ 00420000
*                                                                       00421000
*/********************************************************************/ 00422000
*/*                                                                  */ 00423000
*/*  The exit routine gets control with no locks in TCB mode,        */ 00424000
*/*  supervisor state, key zero, in the HIS address space as         */ 00425000
*/*  H=P=S. The exit routine takes control in the AMODE that was     */ 00426000
*/*  defined for the exit routine's load module at the time of the   */ 00427000
*/*  linkedit (for example, by a LOAD action).                       */ 00428000
*/*                                                                  */ 00429000
*/*  If the exit routine abends, the exit routine will no longer be  */ 00430000
*/*  called and the associated profiler will be marked as 'failed'.  */ 00431000
*/*  To determine whether a profiler is in the 'failed' state use    */ 00432000
*/*  HISSERV REQUEST=QUERY,TYPE=PROFILERS and examine the            */ 00433000
*/*  HisProfEntryFlgs_Failed bit.                                    */ 00434000
*/*                                                                  */ 00435000
*/*  The register contents at entry to the exit routine              */ 00436000
*/*  are:                                                            */ 00437000
*/*                                                                  */ 00438000
*/*  REGISTER CONTENTS                                               */ 00439000
*/*  0     Does not contain relevant data                            */ 00440000
*/*  1     The address to the parameter area mapped by               */ 00441000
*/*        HisExitParm in macro HISYEXIT                             */ 00442000
*/*  2-12  Does not contain relevant data                            */ 00443000
*/*  13    Address to a 216 byte save area                           */ 00444000
*/*  14    Return Address                                            */ 00445000
*/*  15    Exit routine entry point address                          */ 00446000
*/*                                                                  */ 00447000
*/*  On return, the exit routine must return control in              */ 00448000
*/*  supervisor state, PSW key zero, with no locks held.             */ 00449000
*/*  The register contents on return should be as follows:           */ 00450000
*/*                                                                  */ 00451000
*/*  REGISTER CONTENTS                                               */ 00452000
*/*  0-1   Do not need to be preserved                               */ 00453000
*/*  2-13  Unchanged                                                 */ 00454000
*/*  14-15 Do not need to be preserved                               */ 00455000
*/*                                                                  */ 00456000
*/*  The exit routine is allowed to obtain and release any locks it  */ 00457000
*/*  desires in order to handle the exit, however performance is a   */ 00458000
*/*  concern is some cases. For example when the function code is    */ 00459000
*/*  HisExitParmFunc_kSmp the exit routine is called to process      */ 00460000
*/*  Sampling Data Blocks (SDBs). These SDBs are also used by the    */ 00461000
*/*  hardware, meaning if processing takes too long the              */ 00462000
*/*  hardware will run out of SDBs and sampling data will            */ 00463000
*/*  be lost.                                                        */ 00464000
*/*                                                                  */ 00465000
*/*  The exit is not allowed to issue a HISSERV REQUEST=PROFILE      */ 00466000
*/*  request, or wait on a resource held by another work unit        */ 00467000
*/*  which might issue a HISSERV REQUEST=PROFILE request.            */ 00468000
*/*                                                                  */ 00469000
*/*  The exit routine must not write into the parameter area.        */ 00470000
*/*                                                                  */ 00471000
*/********************************************************************/ 00472000
*                                                                       00473000
*/********************************************************************/ 00474000
*/* Generic Exit Routine Parameter Area                              */ 00475000
*/*   Use this mapping to determine why the exit routine was called, */ 00476000
*/*   and what mapping to use. The parameter area will always start  */ 00477000
*/*   with this mapping.                                             */ 00478000
*/********************************************************************/ 00479000
*Dcl                                                                    00480000
* 1 HisExitParm Bdy(Dword) Type                                         00481000
*  ,3 HisExitParm_Version Fixed(16) /* The version of this parameter    00482000
*                                     area. Version and Func identify   00483000
*                                     the complete mapping           */ 00484000
*  ,3 HisExitParm_Func    Fixed(16) /* The function code that describes 00485000
*                                     why the exit routine is being     00486000
*                                     called. Version and Func identify 00487000
*                                     the complete mapping           */ 00488000
*  ;                                                                    00489000
*                                                                       00490000
*/********************************************************************/ 00491000
*/* Exit Routine Function Codes                                      */ 00492000
*/*   One of the following equates will be set as the                */ 00493000
*/*   HisExitParm_Func in the parameter area. The mapping to use     */ 00494000
*/*   on the entire parameter area depends on the function code.     */ 00495000
*/********************************************************************/ 00496000
*Dcl HisExitParmFunc_kServ  Fixed(16) Constant(1); /* The exit          00497000
*                                     routine was called because the    00498000
*                                     status of the service has         00499000
*                                     changed. The parameter area is    00500000
*                                     mapped by HisServParm in macro    00501000
*                                     HISYEXIT. This function code will 00502000
*                                     only be received by exit routines 00503000
*                                     added to the HIS.SERVSTAT dynamic 00504000
*                                     exit.                          */ 00505000
*Dcl HisExitParmFunc_kStat  Fixed(16) Constant(2); /* The exit          00506000
*                                     routine was called because a      00507000
*                                     profiler might need to take some  00508000
*                                     action based on service actions.  00509000
*                                     The parameter area is mapped by   00510000
*                                     HisStatParm in macro HISYEXIT.    00511000
*                                     This function code will only be   00512000
*                                     received by exit routines added   00513000
*                                     through HISSERV REQUEST=PROFILE,  00514000
*                                     ACTION=START requests.         */ 00515000
*Dcl HisExitParmFunc_kSmp   Fixed(16) Constant(3); /* The exit          00516000
*                                     routine was called because of     00517000
*                                     a sampling exit callback. The     00518000
*                                     parameter area is mapped by       00519000
*                                     HisSmpExit in macro HISYSMPX.     00520000
*                                     This function code will only be   00521000
*                                     received by exit routines added   00522000
*                                     through HISSERV REQUEST=PROFILE,  00523000
*                                     ACTION=START requests with        00524000
*                                     SAMPLE=YES                     */ 00525000
*                                                                       00526000
*/********************************************************************/ 00527000
*/* The Service Status Changed Exit Function Code Parameter Area     */ 00528000
*/*   When HisExitParm_Func is HisExitParmFunc_kServ, this mapping   */ 00529000
*/*   should be used to map the entire parameter area.               */ 00530000
*/********************************************************************/ 00531000
*Dcl                                                                    00532000
* 1 HisServParm Bdy(Dword) Type                                         00533000
*  ,3 HisServParm_Info Char(Size(HisExitParm)) Bdy(Dword) /* The common 00534000
*                                     portion of the exit routine       00535000
*                                     parameter area                 */ 00536000
*    ,5 HisServParm_Info_IsA IsA(HisExitParm)                           00537000
*  ,3 HisServParm_Rsn  Fixed(32)   /* The reason code describing how    00538000
*                                     the HISSERV service has changed*/ 00539000
*  ,3 HisServParm_End  Char(0) Bdy(Dword)                               00540000
*  ;                                                                    00541000
*Dcl HisServParm_kVersionMax Fixed(16) Constant(HisStatParm_kVersion1); 00542000
*Dcl HisServParm_kVersion1   Fixed(16) Constant(1);                     00543000
*Dcl HisServParm_kVersionMin Fixed(16) Constant(HisStatParm_kVersion1); 00544000
*                                                                       00545000
*/********************************************************************/ 00546000
*/* Service Status Changed Reason Codes                              */ 00547000
*/*   One of the following equates will be set as the                */ 00548000
*/*   HisServParm_Rsn in the parameter area.                         */ 00549000
*/********************************************************************/ 00550000
*Dcl HisServParmRsn_kEnabled  Fixed(32) Constant(1); /* The service has 00551000
*                                     been enabled. At this point       00552000
*                                     all PROFILE and QUERY requests    00553000
*                                     can be processed.              */ 00554000
*Dcl HisServParmRsn_kDisabled Fixed(32) Constant(2); /* The service is  00555000
*                                     disabling. Once control is        00556000
*                                     returned from the exit routine,   00557000
*                                     no more PROFILE or QUERY requests 00558000
*                                     will be processed.             */ 00559000
*Dcl HisServParmRsn_kStarted  Fixed(32) Constant(3); /* The service     00560000
*                                     has started profiling the system. 00561000
*                                     This occurs either when the first 00562000
*                                     REQUEST=PROFILE,ACTION=START      00563000
*                                     request for either events or      00564000
*                                     sampling, or after the service    00565000
*                                     has finished updating.         */ 00566000
*Dcl HisServParmRsn_kStopped  Fixed(32) Constant(4); /* The service     00567000
*                                     has stopped profiling the system. 00568000
*                                     This occurs either when the last  00569000
*                                     REQUEST=PROFILE,ACTION=STOP       00570000
*                                     request has been processed, or    00571000
*                                     after the service has stopped     00572000
*                                     because it needs to be updated.*/ 00573000
*                                                                       00574000
*/********************************************************************/ 00575000
*/* The Profiler Status Exit Function Code Parameter Area            */ 00576000
*/*   When HisExitParm_Func is HisExitParmFunc_kStat, this mapping   */ 00577000
*/*   should be used to map the entire parameter area.               */ 00578000
*/********************************************************************/ 00579000
*Dcl                                                                    00580000
* 1 HisStatParm Bdy(Dword) Type                                         00581000
*  ,3 HisStatParm_Info Char(Size(HisExitParm)) Bdy(Dword) /* The common 00582000
*                                     portion of the exit routine       00583000
*                                     parameter area                 */ 00584000
*    ,5 HisStatParm_Info_IsA IsA(HisExitParm)                           00585000
*  ,3 HisStatParm_Action Fixed(32) /* The action that is being taken,   00586000
*                                     will be one of the                00587000
*                                     HisStatParmAction_k* equates   */ 00588000
*  ,3 HisStatParm_Rsn  Bit(32)     /* The reason(s) describing why the  00589000
*                                     profiler was notified. It is      00590000
*                                     possible no bits are on.       */ 00591000
*    ,5 HisStatParm_Rsn1 Bit(8)                                         00592000
*      ,7 HisStatParmRsn_HdwrCtrSetDeAuth Bit(1) /* The service has     00593000
*                                     detected the hardware authorized  00594000
*                                     state of one or more enabled      00595000
*                                     hardware counter sets are now     00596000
*                                     deauthorized.                  */ 00597000
*      ,7 HisStatParmRsn_HdwrSmpTypDeAuth Bit(1) /* The service has     00598000
*                                     detected the hardware authorized  00599000
*                                     state of one or more enabled      00600000
*                                     sample types are now              00601000
*                                     deauthorized.                  */ 00602000
*      ,7 HisStatParmRsn_HdwrCtrDataLoss  Bit(1) /* The service has     00603000
*                                     detected that counter data has    00604000
*                                     been lost on at least one CPU due 00605000
*                                     to internal hardware reasons.  */ 00606000
*      ,7 HisStatParmRsn_HdwrSmpDataLoss  Bit(1) /* The service has     00607000
*                                     detected that sampling data has   00608000
*                                     been lost on at least one CPU due 00609000
*                                     to internal hardware reasons.  */ 00610000
*      ,7 HisStatParmRsn_HdwrCpuSpeedChg  Bit(1) /* The service has     00611000
*                                     detected that the speed of one    00612000
*                                     or more processor types has       00613000
*                                     changed.                       */ 00614000
*      ,7 HisStatParmRsn_ServiceParmsChg  Bit(1) /* The service         00615000
*                                     parameters have been changed.  */ 00616000
*      ,7 HisStatParmRsn_HdwrMTCtrDataLoss  Bit(1) /* The service has   00617000
*                                     detected that MT counter data has 00618000
*                                     been lost on at least one CPU     00619000
*                                     due to internal hardware          00620000
*                                     reasons.                   @01A*/ 00621000
*      ,7 HisStatParmRsn_HdwrMTModeChg Bit(1) /* The service has        00622000
*                                      detected that MT Mode has        00623000
*                                      changed.                  @02A*/ 00624000
*    ,5 HisStatParm_Rsn2 Bit(8)                                         00625000
*    ,5 HisStatParm_Rsn3 Bit(8)                                         00626000
*    ,5 HisStatParm_Rsn4 Bit(8)                                         00627000
*  ,3 * Char(4)                                                         00628000
*  ,3 HisStatParm_End  Char(0) Bdy(Dword)                               00629000
*  ;                                                                    00630000
*Dcl HisStatParm_kVersionMax Fixed(16) Constant(HisStatParm_kVersion1); 00631000
*Dcl HisStatParm_kVersion1   Fixed(16) Constant(1);                     00632000
*Dcl HisStatParm_kVersionMin Fixed(16) Constant(HisStatParm_kVersion1); 00633000
*                                                                       00634000
*/********************************************************************/ 00635000
*/* Profiler Status Action Codes                                     */ 00636000
*/*   One of the following equates will be set as the                */ 00637000
*/*   HisStatParm_Action in the parameter area.                      */ 00638000
*/********************************************************************/ 00639000
*Dcl HisStatParmAction_kNone        Fixed(32) Constant(1); /* Profilers 00640000
*                                     are notified of an event the      00641000
*                                     service needs to take no          00642000
*                                     specific action for            */ 00643000
*Dcl HisStatParmAction_kUpdateStart Fixed(32) Constant(2); /* The       00644000
*                                     service needs to update itself.   00645000
*                                     Any queries before returning      00646000
*                                     control from the exit routine     00647000
*                                     will reflect the previous state.  00648000
*                                     Once control is returned from the 00649000
*                                     exit routine, if the exit routine 00650000
*                                     normally gets called for sample   00651000
*                                     exit callbacks, it will get       00652000
*                                     control one last time before the  00653000
*                                     update begins for each CPU        00654000
*                                     collecting samples. Until the     00655000
*                                     exit routine gets control again   00656000
*                                     with an action of                 00657000
*                                     HisStatParmAction_kUpdateDone,    00658000
*                                     any QUERY request results may     00659000
*                                     reflect the old or new state of   00660000
*                                     the service. One of the reasons   00661000
*                                     indicated in the HisStatParm_Rsn  00662000
*                                     bitmask is the reason for the     00663000
*                                     required update.               */ 00664000
*Dcl HisStatParmAction_kUpdateDone  Fixed(32) Constant(3); /* The       00665000
*                                     service has finished updating     00666000
*                                     itself. Note a profiler cannot    00667000
*                                     rely on data received prior to    00668000
*                                     this exit callback (for example   00669000
*                                     event data values, event info,    00670000
*                                     etc). For this action             00671000
*                                     there is no specific reason       00672000
*                                     indicated in HisStatParm_Rsn, it  00673000
*                                     is the consequence of a previous  00674000
*                                     action of                         00675000
*                                     HisStatParmAction_kUpdateStart */ 00676000
*                                                                       00677000
* @LOGIC;                                                               00678000
* #PRAGMA TOOL=CBGEN.                                                   00679000
* #USEORG.                                                              00680000
* #ALIGNOP.                                                             00681000
* #NOTUPPER.                                                            00682000
* #NOMAP.                                                               00683000
* #DELETE.HisStatParm_Info_IsA                                          00684000
* #DELETE.HisServParm_Info_IsA                                          00685000
* #MAP.                                                                 00686000
* #EPRAGMA.                                                             00687000
* @ENDLOGIC;                                                            00688000
*/* End of PL/X Source                                               */ 00689000
* %IF HISYEXIT_LIST ^= 'NO' &                                           00690000
*    ZCBPRINT ^= 'NO' %THEN                                             00691000
*   %GOTO HISYEXIT_4;                                                   00692000
*   @LIST POP NOECHO;                                                   00693000
* %HISYEXIT_4:;                                                         00694000
* %END;                                                                 00695000
