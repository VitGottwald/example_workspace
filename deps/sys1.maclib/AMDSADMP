         MACRO                                                          00010008
&SADMP   AMDSADMP &IPL=DSYSDA,&OUTPUT=,&CONSOLE=,                      X00020008
               &SYSUT=SYSDA,&VOLSER=SADUMP,&ULABEL=,                   X00030008
               &TYPE=,&ADDR=,&DUMP=,&LOADPT=,&REUSEDS=CHOICE,          X00040008
               &MSG=ALL,&MINASID=,&PROMPT,&COMPACT=YES,&DEBUG=,        X00050008
               &ALIB=,&NUCLIB=,&LNKLIB=,&MODLIB=,&DDSPROMPT=NO,        X00060008
               &IPLEXIST=NO,&AMD029=YES,                               X00070008
               &ADDSUMM=,&REAL=,&LDIPL=NO                          @09C 00080008
         AGO   .NOPROA                  SKIP PROLOGUE CODE              00090008
         SPACE                                                          00100008
** START OF SPECIFICATIONS ******************************************   00110008
*                                                                       00120008
* MACRO NAME: AMDSADMP                                                  00130008
*                                                                       00140008
* DESCRIPTIVE NAME: STAND-ALONE DUMP TWO-STAGE GENERATION               00150008
*                                                                       00160008
* COMPONENT: STAND-ALONE DUMP (SC115)                                   00170008
*                                                                       00180008
* PROPRIETARY STATEMENT:                                                00190008
*                                                                       00200008
*   LICENSED MATERIALS - PROPERTY OF IBM                                00210008
*   5650-ZOS COPYRIGHT IBM CORP. 1981, 2015                             00220008
*                                                                       00230008
* STATUS: HBB77A0                                                       00240008
*                                                                       00250008
* FUNCTION:  THE AMDSADMP MACRO GENERATES THE JCL INPUT TO              00260008
*            STAGE 2 OF STAND-ALONE DUMP GENERATION (WHICH,             00270008
*            IN TURN, COMPLETES THE INITIALIZATION OF THE               00280008
*            IPL-ABLE DUMP PROGRAM RESIDENCE VOLUME).                   00290008
*            THIS MACRO PASSES PARAMETERS VIA THE STAGE 2 JCL           00300008
*            AS INPUT TO AMDSADM2 AND AMDSABLD.  (ALSO TO               00310008
*            ICKDSF IF IPL=D SPECIFIED).                                00320008
*                                                                       00330008
* METHOD OF ACCESS:                                                     00340008
*                                                                       00350008
*   THE KEYWORD SPECIFICATIONS ARE DESCRIBED IN                         00360008
*     z/OS MVS Diagnosis: Tools and Service Aids                        00370008
*                                                                       00380008
* PUBLICATIONS:                                                         00390008
*                                                                       00400008
*   z/OS MVS Diagnosis: Tools and Service Aids                          00410008
*                                                                       00420008
* EXTERNAL CLASSIFICATION: OTHER                                        00430008
* END OF EXTERNAL CLASSIFICATION:                                       00440008
*                                                                       00450008
* ===================================================================== 00460008
*                                                                       00470008
* CHANGE ACTIVITY:                                                      00480008
* A000000-999999                                               @G860P1W 00490008
* $MAC(AMDSADMP),COMP(SC115),PROD(HBB77A0): TWO-STAGE GENERATION        00500008
*                                                                       00510008
* APAR      DATE       REASON                                           00520008
* OZ66866   12/17/82   VARIABLE &ULABEL2 NOT DECLARED                   00530008
* OZ76321   02/29/84   AMDSADMP DOES NOT SUBSTITUTE IPL=DSYSDA          00540008
*                      IF IPL= PARAMETER IS CODED INCORRECTLY  @ZA76321 00550008
* OZ89464   07/03/85   MSGAMD064I RC4 RECEIVED DURING          @ZA89464 00560008
*                      ASSEMBLE WHEN OBJECT PARM DEFAULT IS    @ZA89464 00570008
*                      TAKEN.                                  @ZA89464 00580008
* OZ93271   12/09/85   CONSOLE= NOT RECOGNIZED WHEN IT IS      @ZA93271 00590008
*                      ON A CONTINUATION CARD STARTED IN       @ZA93271 00600008
*                      A COLUMN BEYOND COLUMN 16. NO MESSAGE   @ZA93271 00610008
*                      ISSUED INDICATING DEFAULT TAKEN.        @ZA93271 00620008
* OZ94080   01/06/86   MSGAMD064I RC4 RECEIVED DURING          @ZA94080 00630008
*                      ASSEMBLE WHEN RENT PARM DEFAULT IS      @ZA94080 00640008
*                      TAKEN.                                  @ZA94080 00650008
*                                                                       00660008
* FLAG REASON   RELEASE   DATE   ORIGIN   DESCRIPTION                   00670008
*                                                                       00680008
*   Hardware=                                                           00690008
* $H1= 3480     JBB2125  830608  PD1X:    3480 TAPES                    00700008
*                                                                       00710008
* --------------------------------------------------------------------- 00720008
*                                                                       00730008
*   Design changes=                                                     00740008
*    = DCRR0257 HBB3310  870525  PDBX:    28K BLOCKING                  00750008
* $D2= DCRR0174 HBB5510  930909  PDMC:    > CORRECTION ON ADDING '/'    00760008
*      FOR MIGRATION PURPOSES > ADDITION OF NUCLIB, MODLIB, LNKLIB,     00770008
*      AND ALIB KEYWORDS FOR MIGRATION SUPPORT > IPL PARAMETER          00780008
*      SHOULD ACCEPT UP TO 8 DIGITS FOR UNIT TYPE                       00790008
*    = DCRR0003 JBB6604  970116  B7VBGD   Workspace double              00800008
*    = MACLIB   JBB3313  881104  PD1X:    MACRO LIBRARY SUPPORT:        00810008
*      ACCESS SYS1.MACLIB AND SYS1.MODGEN                               00820008
*    = JUP03    HBB4410  880715  PDCV:    RESIDENCE LIBRARY CHANGE      00830008
*      FROM LINKLIB TO NUCLEUS                                          00840008
*                                                                       00850008
* --------------------------------------------------------------------- 00860008
*                                                                       00870008
*   Line items=                                                         00880008
* $L3= CIHWE    HBB4420  891211  PD1X:    DUMP RESTRUCTURE              00890008
* $L4= SDMPD    HBB4430  910601  PD1X:    DUMP TO DASD SUPPORT          00900008
* $L5= 4DGIT    HBB5510  930304  PDCU:    4-DIGIT DEVICE SUPPORT        00910008
* $L6= 64BIT    HBB7703  981012  B7BVGD:  64 bit real support           00920008
* $L7= 64BIT    HBB7703  990304  B7BVGD:  64 bit real support           00930008
* $L8= 64BIT    HBB7703  990607  B7BVGD:  64 bit real support           00940008
* $L9= MULTI    HBB7705  000327  B7VBGD:  Multi-dataset support         00950008
* $LA= SVASADMP HBB7770  090331  RSTLTS:  SADMP ASID prioritization     00960008
* $LB= SVASCM   HBB7780  100603  PDPS:    Pass DEBUG to AMDSADM2        00970008
* $LC= ME28832  HBB77A0  150211  PDH6:    REAL(ALL ! USED) option       00980008
*                                                                       00990008
* --------------------------------------------------------------------- 01000008
*                                                                       01010008
*   PTMs=                                                               01020008
*    = PAJ0375  JBB2125  831104  PD1V:    DASD DATASET SIZE             01030008
*    = PKB0202  HBB4430  911209  PDIM:    GENERATION PARAMETERS         01040008
* $P3= PKB2434  HBB4430  920430  PDIM:    CHANGE DEFAULT VALUE OF       01050008
*      REUSEDS TO CHOICE                                                01060008
* $P4= PKB2544  HBB4430  920430  PDIM:    INDICATE DEFAULT VALUE OF     01070008
*      REUSEDS IN MNOTE                                                 01080008
* $P5= PIG4240  HBB5510  930629  PDMC:    CORRECT IPL= SYNTAX           01090008
*      CHECKING.                                                        01100008
*    = PN71731  HBB5520  941020  PDNO:    Add External Classification   01110008
*      in prolog                                                        01120008
*    = PQC2167  HBB6603  960904  PDNO:    Change External Class from    01130008
*      GUPI to OTHER                                                    01140008
*    = PSY0334  JBB6604  970225  MXN:     Corrected errors in change    01150008
*      activity flags                                                   01160008
* $P9= PVT0555  HBB6606  980306  MXN:     Make ASMA90 the default       01170008
*      assembler for SADMP generation.                                  01180008
*    = ME05047  HBB7730  051108  PDE1:    Check PROMPT option           01190008
*      See FIN APAR OA14154                                             01200008
* $PA= ME09414  HBB7740  070304  PDH6:    DEBUG keyword                 01210008
* $PB= ME10834  HBB7750  070930  PD2D:    Change the REGION size for    01220008
*                                         ICKDSF step                   01230008
* $PC= ME12707  HBB7750  080220  PDH6:    IPLEXIST, AMD029 keywords     01240008
* $PD= ME16109  HBB7770  090505  PDH6:    Allow VIO for TRK0TEXT        01250008
*    = ME18561  HBB7770  100224  PDH6:    Restore JCLLDR3 label         01260008
* $PE= ME18779  HBB7770  100315  PDH6:    NUCLIB for One-stage          01270008
* $PF= ME20775  HBB7780  110115  PDH6:    Fix MNOTE text                01280008
*                                                                       01290008
* --------------------------------------------------------------------- 01300008
*                                                                       01310008
*   SPEs                                                                01320008
* $T1= OY11024  HBB3310  880120  PDBW:    REDUCED MINIMAL DUMP          01330008
*                                                                       01340008
* --------------------------------------------------------------------- 01350008
*                                                                       01360008
*   Maintenance=                                                        01370008
* $01= OY40870  HBB4420  900813  PDF7:    IDRC SUPPORT                  01380008
*    = OY47897  HBB3310  910923           ADD THE DCB FOR SYSPUNCH      01390008
* $03= OY57723  HBB4420  930301  PDLO:    ADD KEYWORD TO MSG=           01400008
*      PARAMETER TO DISPLAY ASIDS                                       01410008
* $04= OY65489  HBB4420  930828  PDNO:    FOR TWO-STEP GENERATION       01420008
*      PROCESS, PUNCH OUT JCL THAT CALLS AMDSATDS TO DETERMINE WHICH    01430008
*      ASSEMBLER TO USE AND PUNCH CONDITIONAL LOGIC TO USE EITHER       01440008
*      THE IEV90 OR THE ASMA90 ASSEMBLER                                01450008
*    = OW00370  HBB4420  931209  PDNO:    Invalid OUTPUT= parameter     01460008
*      specification should generate a return code of 4.                01470008
* $06= OW20377  HBB5510  960531  PDNO: Allow multiple dump data         01480008
*      names                                                            01490008
* $07= OW39188  HBB6606  990630  MXN:  Message AMD064I RC04 from        01500008
*      AMDSABLD when HLASM 1.3 installed with XOBJECT option.           01510008
*      Invoke HLASM with NOXOBJECT option to guarantee OBJ format.      01520008
* $08= OA14154  HBB7730  051108  PDE1:    Check PROMPT option           01530008
* $09= OA63404  HBB77D0  220824  PDH6:    Validated Boot                01540008
*                                                                       01550008
* ===================================================================== 01560008
*                                                                       01570008
* MESSAGES:                                                             01580008
*                                                                       01590008
*      THIS MACRO PRODUCES THE FOLLOWING MNOTES:                        01600008
*      (ALL MNOTES START WITH: "ASMA254I *** MNOTE ***")                01610010
*                                                                       01620008
* 0,AMDSADMP: POSITIONAL '&PROMPT.' IGNORED                             01630008
* 0,AMDSADMP: COMPACT=&COMPACT IS NOT ALLOWED. IT MUST BE YES OR NO.    01640008
*            COMPACT=YES HAS BEEN USED.                                 01650008
* 0,AMDSADMP: CONSOLE ADDRESS &CONAD IS INVALID. IT MUST BE A DEVICE    01660008
*           NUMBER. 001F IS SUBSTITUTED.                                01670008
* 0,AMDSADMP: CONSOLE PARM NOT DETECTED. DEFAULT (001F,3278) WILL BE    01680008
*           USED.                                                       01690008
* 0,AMDSADMP: CONSOLE TYPE &CONTP IS INVALID. IT MUST BE A 4            01700008
*           DIGIT NUMBER. 3278 HAS BEEN USED.                           01710008
* 0,AMDSADMP: CONSOLE TYPE &CONTP IS INVALID.  NO VALUE MAY BE          01720008
*           SPECIFIED FOR SYSC.  IT WILL BE IGNORED.                    01730008
* 0,AMDSADMP: CONSOLE ADDRESS SYSC MAY ONLY BE SPECIFIED FOR THE        01740008
*           FIRST CONSOLE.  IT WILL BE IGNORED.                         01750008
* 0,'AMDSADMP: ONLY SYSTEM CONSOLE DEFINED. DEFAULT (001F,3278)         01760008
*           WILL ALSO BE USED.                                     @PFC 01770008
* 0,AMDSADMP: DEFAULT OUTPUT DEVICE T0282 WILL BE USED.                 01780008
* 0,AMDSADMP: IPLUNIT WAS NOT SPECIFIED. UNIT WILL BE DEFAULTED         01790008
*           TO SYSDA.                                                   01800008
* 0,AMDSADMP: IPLUNIT WAS NOT SPECIFIED. UNIT WILL BE DEFAULTED         01810008
*           TO 3400.                                                    01820008
* 0,AMDSADMP: LOADPT IS AN OBSOLETE KEYWORD. IT IS IGNORED.             01830008
*           SADMP GENERATION CONTINUES.                                 01840008
* 0,AMDSADMP: MINASID=ALL OR MINASID=PHYSIN NOT SPECIFIED               01850008
*           THE DEFAULT MINASID=ALL WILL BE USED.                       01860008
* 0,AMDSADMP: REAL=ALL OR REAL=USED NOT SPECIFIED                       01870008
*           THE DEFAULT REAL=ALL WILL BE USED.                          01880008
* 0,AMDSADMP: MSG=&MSG IS INVALID. IT MUST BE ALL, ACTION OR            01890008
*           ALLASIDS.   MSG=ALL HAS BEEN USED.                          01900008
* 0,AMDSADMP: TYPE IS AN OBSOLETE KEYWORD. IT IS IGNORED.               01910008
*           SADMP GENERATION CONTINUES.                                 01920008
* 0,AMDSADMP: WARNING MINASID=&MINASID WAS SPECIFIED. REFER TO          01930008
*           MESSAGE AMD082I.                                            01940008
* 0,AMDSADMP: REUSEDS =&REUSEDS IS NOT ALLOWED. VALID SPECIFICATIONS    01950008
*           FOR REUSEDS ARE NEVER, CHOICE, OR ALWAYS.                   01960008
* 0,AMDSADMP: DDSPROMPT=&DDSPROMPT IS NOT ALLOWED. IT MUST BE YES       01970008
*           OR NO. DDSPROMPT=YES HAS BEEN USED.                         01980008
* 0,AMDSADMP: AMD029=&AMD029 IS NOT ALLOWED. IT MUST BE YES             01990008
*           OR NO. AMD029=YES HAS BEEN USED.                            02000008
* 0,AMDSADMP: AMDSADMP: LDIPL=&LDIPL IS NOT ALLOWED. IT MUST BE YES     02010010
*           OR NO. LDIPL=NO HAS BEEN USED.                              02020010
* 0,AMDSADMP: LDIPL=YES IS NOT ALLOWED FOR TAPE DEVICES.                02030010
*           LDIPL=NO HAS BEEN USED.                                     02030110
* 4,AMDSADMP: OUTPUT DUMP DATA SET NAME IS INCORRECT. THE DATASET NAME  02030208
*           NAME IS GREATER THAN 44 CHARACTERS.                         02030308
* 4,AMDSADMP: OUTPUT DUMP DATA SET NAME IS INCORRECT.  IT MUST CONTAIN  02030408
*           THE TEXT 'SADMP'.                                           02040008
* 4,AMDSADMP: OUTPUT=&OUTPUT IS INCORRECT. IT MUST BE EITHER {T!D}UNIT  02050008
*           OR (DUNIT,DATASET NAME).                                    02060008
* 4,AMDSADMP: IPL=&IPL IS INVALID. FIRST CHARACTER MUST BE              02070008
*           D OR T, AND HAS BEEN REPLACED WITH A D.                     02080008
* 4,AMDSADMP: IPLUNIT=&IPLUNIT IS TOO LONG.                             02090008
*           THE UNIT NAME WILL BE TRUNCATED.                            02100008
* 8,AMDSADMP: ULABEL=NOPURGE IS NOT POSSIBLE FOR A TAPE                 02110008
*           RESIDENCE VOLUME.                                           02120008
* 8,AMDSADMP: ALIB=&ALIB IS NOT VALID.  THE REQUIRED SYNTAX IS          02130008
*           ALIB=(VOLSER,UNIT).                                         02140008
* 8,AMDSADMP: NUCLIB=&NUCLIB IS NOT VALID.  THE REQUIRED SYNTAX IS      02150008
*           NUCLIB=(VOLSER,UNIT).                                       02160008
* 8,AMDSADMP: MODLIB=&MODLIB IS NOT VALID.  THE REQUIRED SYNTAX IS      02170008
*           MODLIB=(VOLSER,UNIT).                                       02180008
* 8,AMDSADMP: LNKLIB=&LNKLIB IS NOT VALID.  THE REQUIRED SYNTAX IS      02190008
*           LNKLIB=(VOLSER,UNIT).                                       02200008
*                                                                       02210008
** END OF SPECIFICATIONS ********************************************   02220008
.NOPROA   ANOP                                                          02230008
.*                                                                      02240008
.********************************************************************   02250008
.*                                                                      02260008
.* VARIABLES AND CONSTANTS                                              02270008
.*                                                                      02280008
.********************************************************************   02290008
         GBLB  &OSG               THIS IS 1 FOR ONE STEP GENERATION     02300008
         LCLC  &CON2                                                    02310008
         LCLC  &MSGK,&PMTK,&COMPK,&DDSPMTK,&AMD0291                @PCC 02320008
         LCLC  &CONAD,&CONTP                                            02330008
         LCLC  &KEYWORD,&SUBSTR,&Q,&QQ,&LIST,&COMMA,&CL                 02340008
         LCLC  &OUTPUT2,&JOBNAME,&ULABEL2,&OUTDDS,&OUTDEV          @06C 02350008
         LCLC  &REUSDS1                                            @L4A 02360008
         LCLC  &CONLIST,&DLM,&SL,&MINTYPE                          @T1C 02370008
         LCLC  &REALTYPE                                           @LCA 02380008
         LCLA  &SLI,&SLB,&SLE,&SLL                                      02390008
         LCLA  &UNITBEG,&UNITLEN                                        02400008
         LCLA  &BEG,&LEN,&INDEX,&REP,&LOOPEND,&I                   @L5C 02410008
         LCLA  &DM2CNT                   USED AS A LOOP CONTROL        X02420008
                                         VARIABLE TO BUILD THE         X02430008
                                         AMDSADM2 MACRO TWICE      @04A 02440008
         LCLC  &IPLUNIT,&IPLVAR,&HEXN                              @L3C 02450008
         LCLC  &SLASH                                              @D2A 02460008
         LCLC  &AVOL,&NUCVOL,&LNKVOL,&MODVOL                       @D2A 02470008
         LCLC  &AUNIT,&NUCUNIT,&LNKUNIT,&MODUNIT                   @D2A 02480008
         LCLC  &IPLEXYES                                           @PCA 02490008
         LCLC  &LDIPLYES                                           @09A 02500008
&Q       SETC  ''''                SINGLE QUOTE                         02510008
&QQ      SETC  ''''''              DOUBLE QUOTE                         02520008
.*                                                                      02530008
.********************************************************************   02540008
.*                                                                      02550008
.*       ISSUE WARNING MNOTE FOR OBSOLETE TYPE= PARAMETER.        @L3A  02560008
.*                                                                      02570008
.********************************************************************   02580008
.*                                                                      02590008
.*                                                                      02600008
         AIF   ('&TYPE' EQ '').MSGPARM  NO TYPE, SO CONTINUE       @L3A 02610008
         MNOTE 0,'AMDSADMP: TYPE IS AN OBSOLETE KEYWORD. IT IS IGNORED.X02620008
                          SADMP GENERATION CONTINUES.'             @L3A 02630008
.*                                                                      02640008
.********************************************************************   02650008
.*                                                                      02660008
.*                      MSG= PARAMETER                                  02670008
.*                                                                      02680008
.********************************************************************   02690008
.*                                                                      02700008
.MSGPARM ANOP  ,                                                   @L3A 02710008
         AIF   ('&MSG' EQ 'ALLASIDS').MSG3                         @03A 02720008
         AIF   ('&MSG' EQ 'ALL').MSG1                                   02730008
         AIF   ('&MSG' NE 'ACTION').MSG2                                02740008
&MSGK    SETC  'ACTION'                                                 02750008
         AGO   .MSG4                                               @03C 02760008
.MSG2    ANOP  ,                                                        02770008
         MNOTE 0,'AMDSADMP: MSG=&MSG IS INVALID. IT MUST BE ALL, ACTIONX02780008
               , OR        ALLASIDS.   MSG=ALL HAS BEEN USED.'     @03C 02790008
         AGO   .MSG1                                                    02800008
.MSG3    ANOP  ,                                                   @03A 02810008
&MSGK    SETC  'ALLASIDS'                                          @03A 02820008
         AGO   .MSG4                                               @03A 02830008
.MSG1    ANOP  ,                                                        02840008
&MSGK    SETC  'ALL'                                                    02850008
.MSG4    ANOP  ,                                                   @03C 02860008
.*                                                                      02870008
.********************************************************************   02880008
.*                                                                      02890008
.*                   PROMPT  PARAMETER                                  02900008
.*                                                                      02910008
.********************************************************************   02920008
.*                                                                      02930008
         AIF   ('&PROMPT' EQ '').PMT1                                   02940008
         AIF   ('&PROMPT' EQ 'PROMPT').PMTA Valid PROMPT option    @08A 02950008
         MNOTE 0,'AMDSADMP:  POSITIONAL ''&PROMPT.'' IGNORED'      @08A 02960008
         AGO   .PMT1                   No PROMPT option            @08A 02970008
.PMTA    ANOP  ,                                                   @08A 02980008
&PMTK    SETC  'PROMPT,'               ADD A COMMA TO ALLOW THIS TO BE X02990008
                                       INSERTED IN A LINE OF KWDS       03000008
.PMT1    ANOP  ,                                                        03010008
.*                                                                      03020008
.********************************************************************   03030008
.*                                                                      03040008
.*               DUMP DATA SET PROMPT PARAMETER                         03050008
.*                                                                      03060008
.* Note:  If DDSPROMPT is not specified, then DDSPROMPT=NO is used.     03070008
.*        If DDSPROMPT is specified, however, the user indicated        03080008
.*        a value other than YES or NO, then DDSPROMPT=YES is used.     03090008
.*        This is done since at SADMP run time, SADMP would be          03100008
.*        forced to try and use a default dump dataset name of          03110008
.*        SYS1.SADMP.                                              @06A 03120008
.********************************************************************   03130008
.*                                                                      03140008
         AIF   ('&DDSPROMPT' EQ 'YES').DDSPYES  Does user want dump    X03150008
                                       dataset prompting?              X03160008
                                       Yes. Set up to use it.      @06A 03170008
         AIF   ('&DDSPROMPT' NE 'NO').DDSPERR  No. Did user specify    X03180008
                                       invalid dump dataset prompt     X03190008
                                       parameter?                      X03200008
                                       Yes. Issue mnote            @06A 03210008
.DDSPNO  ANOP  ,                       No. User does not want dump     X03220008
                                       dataset prompting           @06A 03230008
&DDSPMTK SETC  'NO'                    Indicate not to prompt for a    X03240008
                                       dump dataset name           @06A 03250008
               AGO .DDSPEND            End DDSPROMPT processing    @06A 03260008
.DDSPERR ANOP  ,                       Mnote for DDSPROMPT         @06A 03270008
         MNOTE 0,'AMDSADMP: DDSPROMPT=&DDSPROMPT IS NOT ALLOWED. IT MUSX03280008
               T BE YES OR NO. DDSPROMPT=YES HAS BEEN USED.'       @06A 03290008
.DDSPYES ANOP  ,                       User wants dataset prompting@06A 03300008
&DDSPMTK SETC  'YES'                   Indicate to prompt for dump a   X03310008
                                       dump dataset name.          @06A 03320008
.DDSPEND ANOP  ,                       Exit dump dataset prompting @06A 03330008
.*                                                                      03340008
.********************************************************************   03350008
.*                                                                      03360008
.*                   COMPACT PARAMETER                             @01A 03370008
.*                                                                      03380008
.********************************************************************   03390008
.*                                                                      03400008
         AIF   ('&COMPACT' EQ 'YES').COMP020                       @01A 03410008
         AIF   ('&COMPACT' NE 'NO').COMP010                        @01A 03420008
&COMPK   SETC  'NO'               COMPACTION NOT ALLOWED           @06C 03430008
         AGO   .COMP030                                            @01A 03440008
.COMP010 ANOP  ,                                                   @01A 03450008
         MNOTE 0,'AMDSADMP: COMPACT=&COMPACT IS NOT ALLOWED. IT MUST BEX03460008
                YES OR NO.       COMPACT=YES HAS BEEN USED.'       @01A 03470008
.COMP020 ANOP  ,                                                   @01A 03480008
&COMPK   SETC   'YES'             (DEFAULT) COMPACTION ALLOWED     @06C 03490008
.COMP030 ANOP  ,                                                   @01A 03500008
.*                                                                      03510008
.********************************************************************   03520008
.*                                                                      03530008
.*                   AMD029 Parameter                              @PCA 03540008
.*                                                                      03550008
.********************************************************************   03560008
.*                                                                      03570008
         AIF   ('&AMD029' EQ 'YES').M029020                        @PCA 03580008
         AIF   ('&AMD029' NE 'NO').M029010                         @PCA 03590008
&AMD0291 SETC  'NO'               AMD029D suppressed               @PCA 03600008
         AGO   .M029030                                            @PCA 03610008
.M029010 ANOP  ,                                                   @PCA 03620008
         MNOTE 0,'AMDSADMP: AMD029=&AMD029 IS NOT ALLOWED. IT MUST BE YX03630008
               ES OR NO.  AMD029=YES HAS BEEN USED.'               @PCA 03640008
.M029020 ANOP  ,                                                   @PCA 03650008
&AMD0291 SETC   'YES'             AMD029D requested                @PCA 03660008
.M029030 ANOP  ,                                                   @PCA 03670008
.*                                                                      03680008
.********************************************************************   03690008
.*                                                                      03700008
.COMMON  ANOP  ,                  OPTIONS COMMON TO BOTH HI AND LO      03710008
.*                                                                      03720008
.********************************************************************   03730008
.*                                                                      03740008
.* CONSOLE= PARAMETER.                                                  03750008
.* NOTE: AMDSADM2 MUST BE UPDATED TO INCLUDE ANY NEW CONSOLE TYPES.     03760008
.*                                                                      03770008
.********************************************************************   03780008
.*                                                                      03790008
&CONLIST SETC  '('                  OPEN LIST OF SUBLISTS               03800008
&DLM     SETC  ''                   DELIMITER BETWEEN SUBLIST ENTRIES  X03810008
                                    OF CONLIST BECOMES COMMA AFTER     X03820008
                                    FIRST ENTRY.                        03830008
&INDEX   SETA  1                                                        03840008
         AIF   (N'&CONSOLE LT &INDEX).NOCON  IS CONSOLE TYPE AND       X03850008
                                             ADDRESS SPECIFIED @ZA93271 03860008
.CONLOOP AIF   (N'&CONSOLE LT &INDEX).CLEXIT                            03870008
         AIF   ('&CONSOLE'(1,2) EQ '((').CLIST   IS THIS A LIST OF     X03880008
                                               SUBLISTS?                03890008
         AIF   (&INDEX GT 1).CLEXIT  FOR NONSUBLISTS ONLY GO THROUGH   X03900008
                                     THE LOOP ONCE.                     03910008
&SL      SETC  '&CONSOLE'                  SCAN WHOLE LIST AS A SUBLIST 03920008
         AGO   .SL0                                                     03930008
.*                                                                      03940008
.CLIST   ANOP  ,                           EXTRACT ONE SUBLIST          03950008
&SL      SETC  '&CONSOLE(&INDEX)'                                       03960008
.*                                                                      03970008
.SL0     AIF   (K'&SL EQ 0).CLINDEX        SKIP NULL SUBLISTS           03980008
&SLB     SETA  1                           BEGIN SUBLIST SUBSTRING      03990008
&SLE     SETA  K'&SL                       END SUBLIST SUBSTRING        04000008
         AIF   ('&SL'(1,1) NE '(').SL1     IS SUBLIST IN PARENTHESIS?   04010008
&SLB     SETA  2                           SKIP OPENNING PAREN          04020008
&SLE     SETA  K'&SL-1                     SKIP CLOSING PAREN           04030008
.SL1     ANOP  ,                                                        04040008
&SLI     SETA  &SLB                        START SCAN AT BEGINNING      04050008
.SLSCAN  AIF   (&SLI GT &SLE).SL2          AT END OF SUBLIST?           04060008
         AIF   ('&SL'(&SLI,1) EQ ',').SL2  AT DELIMITER?                04070008
&SLI     SETA  &SLI+1                                                   04080008
         AGO   .SLSCAN                                                  04090008
.SL2     ANOP  ,                           END OF CONAD FOUND           04100008
&SLL     SETA  &SLI-&SLB                                                04110008
&CONAD   SETC  '&SL'(&SLB,&SLL)            EXTRACT CON ADDR             04120008
.*                                                                      04130008
&CONTP   SETC  ''                          INIT IN CASE THERE IS NONE   04140008
         AIF   (&SLI GT &SLE).SL5          AT END OF SUBLIST?           04150008
&SLB     SETA  &SLI+1                      POINT AFTER DELIMITER        04160008
&SLL     SETA  &SLE-&SLI                   CALCULATE LENGTH             04170008
&CONTP   SETC  '&SL'(&SLB,&SLL)            EXTRACT CON TYPE             04180008
.SL5     ANOP  ,                                                        04190008
.*                                                                      04200008
         AIF (K'&CONAD EQ 0).CABAD     ERROR IF NO CONSOLE ADDRESS     X04210008
                                       IS PROVIDED                 @L5A 04220008
         AIF ('&CONAD' NE 'SYSC').CACHECK  If the sytem console was    X04230008
                                       not specified, do normal        X04240008
                                       validation on the specified     X04250008
                                       device                      @L8A 04260008
         AIF   (K'&CONTP EQ 0).SYSCTOK If no device type was           X04270008
                                       specified, the SYSC type is     X04280008
                                       acceptable                  @L8A 04290008
         MNOTE 0,'AMDSADMP: CONSOLE TYPE &CONTP IS INVALID.  NO VALUE MX04300008
               AY BE SPECIFIED FOR SYSC.  IT WILL BE IGNORED.'     @L8A 04310008
.SYSCTOK ANOP  ,                                                   @L8A 04320008
         AIF   (&INDEX NE 1).SYSCFCN   If the system console is not    X04330008
                                       the first console in the list,  X04340008
                                       it is unacceptable          @L8A 04350008
&CONLIST SETC  '((FFFF,SYSC)'                                      @L8A 04360008
&DLM     SETC  ','                   CAUSE DELIMITER TO BE PUT BEFORE  X04370008
                                     ANY ADDITIONAL SUBLIST ENTRIES.   X04380008
                                                                   @L8A 04390008
         AIF   (N'&CONSOLE GT 1).CLINDEX If another console has been   X04400008
                                       specified, go process it    @L8A 04410008
         MNOTE 0,'AMDSADMP: ONLY SYSTEM CONSOLE DEFINED. DEFAULT (001F,X04420008
               3278) ALSO BE USED.'                                @PFC 04430008
         AGO   .NOCON2                 Generate a default console  @L8A 04440008
.SYSCFCN ANOP  ,                                                   @L8A 04450008
         MNOTE 0,'AMDSADMP: CONSOLE ADDRESS SYSC MAY ONLY BE SPECIFIED X04460008
               FOR THE FIRST CONSOLE.  IT WILL BE IGNORED.'        @L8A 04470008
         AGO   .CLINDEX                Continue with the next one  @L8A 04480008
.CACHECK ANOP  ,                                                   @L8A 04490008
         AIF   ('&CONAD'(1,1) NE '/').SKPSLH1    CHECK FOR '/'     @L5A 04500008
         AIF   (K'&CONAD LT 4 OR K'&CONAD GT 5).CABAD                  X04510008
                                       VALIDITY CHECK LENGTH       @L5A 04520008
&I       SETA  2                                                   @L5A 04530008
         AGO     .ADDRCHK                                               04540008
.SKPSLH1 ANOP  ,                                                        04550008
         AIF   (K'&CONAD LT 3 OR K'&CONAD GT 4).CABAD                  X04560008
                                       VALIDITY CHECK LENGTH       @L5A 04570008
&I       SETA  1                                                   @L5A 04580008
.ADDRCHK AIF   (K'&CONAD LT &I).CAOK  ALL DIGITS CHECKED?          @L5A 04590008
         AIF (NOT(('&CONAD'(&I,1) GE 'A' AND '&CONAD'(&I,1) LE 'F') OR X04600008
               ('&CONAD'(&I,1) GE '0' AND                              X04610008
                '&CONAD'(&I,1) LE '9'))).CABAD                     @L5C 04620008
&I       SETA  &I+1                                                @L5A 04630008
         AGO   .ADDRCHK             LOOP                           @L5A 04640008
.CABAD   MNOTE 0,'AMDSADMP: CONSOLE ADDRESS &CONAD IS INVALID. IT MUST X04650008
               BE A DEVICE      NUMBER. 001F IS SUBSTITUTED.'      @L5C 04660008
&CONAD   SETC  '001F'                                              @L5C 04670008
.CAOK    ANOP  ,                    CONSOLE ADDR OK                     04680008
         AIF   (K'&CONTP NE 4).TPBAD                                    04690008
         AIF (NOT('&CONTP'(1,1) GE '0' AND '&CONTP'(1,1) LE '9')).TPBAD 04700008
         AIF (NOT('&CONTP'(2,1) GE '0' AND '&CONTP'(2,1) LE '9')).TPBAD 04710008
         AIF (NOT('&CONTP'(3,1) GE '0' AND '&CONTP'(3,1) LE '9')).TPBAD 04720008
         AIF (NOT('&CONTP'(4,1) GE '0' AND '&CONTP'(3,1) LE '9')).TPBAD 04730008
         AGO   .TPOK                PASSED THE TEST                     04740008
.TPBAD   MNOTE 0,'AMDSADMP: CONSOLE TYPE &CONTP IS INVALID. IT MUST BE X04750008
               A 4              DIGIT NUMBER. 3278 HAS BEEN USED.' @L3C 04760008
&CONTP   SETC  '3278'                                                   04770008
.TPOK    ANOP  ,                    CONSOLE TYPE OK                     04780008
.*                                                                      04790008
&CONLIST SETC  '&CONLIST'.'&DLM'.'('.'&CONAD'.','.'&CONTP'.')'          04800008
&DLM     SETC  ','                   CAUSE DELIMITER TO BE PUT BEFORE  X04810008
                                     ANY ADDITIONAL SUBLIST ENTRIES.    04820008
.CLINDEX ANOP  ,                                                        04830008
&INDEX   SETA  &INDEX+1                                                 04840008
         AGO   .CONLOOP                                                 04850008
.NOCON   MNOTE 0,'AMDSADMP: CONSOLE PARM NOT DETECTED. DEFAULT (001F,32X04860008
               78) WILL BE USED.'                                  @L5C 04870008
.NOCON2  ANOP  ,                                                   @L8A 04880008
&CONAD   SETC  '001F'             SET DEFAULT CONSOLE ADDRESS      @L5C 04890008
&CONTP   SETC  '3278'             SET DEFAULT CONSOLE TYPE     @ZA93271 04900008
&CONLIST SETC  '&CONLIST'.'&DLM'.'('.'&CONAD'.','.'&CONTP'.')' @ZA93271 04910008
.CLEXIT  ANOP  ,                                                        04920008
&CONLIST SETC  '&CONLIST'.')'        CLOSE LIST OF SUBLISTS             04930008
.*                                                                      04940008
.********************************************************************   04950008
.*                                                                      04960008
.*  ISSUE WARNING MNOTE FOR OBSOLETE LOADPT= KEYWORD.             @L3A  04970008
.*                                                                      04980008
.********************************************************************   04990008
.*                                                                      05000008
         AIF   ('&LOADPT' EQ '').IPLPARM                           @L3A 05010008
         MNOTE 0,'AMDSADMP: LOADPT IS AN OBSOLETE KEYWORD. IT IS IGNOREX05020008
               D.         SADMP GENERATION CONTINUES.'             @L3A 05030008
.*                                                                      05040008
.********************************************************************   05050008
.*                                                                      05060008
.*  IPL= PARAMETER.  IF IPL= IS NOT SPECIFIED DSYSDA WILL DEFAULT ON    05070008
.*  THE PROTOTYPE STATEMENT.  TWO DEVICE TYPE PREFIXES D (DISK) AND T   05080008
.*  (TAPE) ARE ALLOWED, AND MAY BE FOLLOWED BY A UNIT NAME.  THIS IS    05090008
.*  EXPECTED TO BE IN THE FORM OF A VALID JCL UNIT= VALUE, AND IF       05100008
.*  OMITTED WILL DEFAULT TO SYSDA FOR PREFIX D AND 3400 FOR T.          05110008
.*                                                                      05120008
.********************************************************************   05130008
.*                                                                      05140008
.IPLPARM ANOP  ,                                                   @L3A 05150008
&SLASH   SETC  ''                      INITIALIZE TO NO SLASH      @D2A 05160008
&UNITLEN SETA  K'&IPL-1                ASSUME A PREFIX CHAR             05170008
&UNITBEG SETA  2                                                        05180008
         AIF   (K'&IPL EQ 0).IPL01     NO CHARACTERS               @P5A 05190008
&IPLVAR  SETC  '&IPL'(1,1)             AMDSABLD EXEC PARM               05200008
         AIF   ('&IPLVAR' NE 'D').IPL06  VALID PREFIX CHAR?             05210008
         AIF   (&UNITLEN EQ 0).IPL08      NO OTHER CHARACTERS?     @P5A 05220008
         AIF   ('&IPL'(2,1) NE '/').IPL08 SLASH?                   @L5A 05230008
&UNITLEN SETA  &UNITLEN-1                                          @L5A 05240008
&UNITBEG SETA  3                                                   @L5A 05250008
&SLASH   SETC  '/'                     PREFIX IPLUNIT WITH SLASH   @D2A 05260008
.IPL08   ANOP  ,                                                   @L5A 05270008
         AIF   (&UNITLEN GT 0).IPL05   WAS UNIT SPECIFIED?              05280008
         MNOTE 0,'AMDSADMP: IPLUNIT WAS NOT SPECIFIED. UNIT WILL BE DEFX05290008
               AULTED     TO SYSDA.'                               @L3C 05300008
&IPLUNIT SETC  'SYSDA'                 NO, USE DEFAULT                  05310008
         AGO   .IPLEND                                                  05320008
.IPL06   AIF   ('&IPLVAR' NE 'T').IPL01                                 05330008
         AIF   (&UNITLEN EQ 0).IPL09      NO OTHER CHARACTERS?     @P5A 05340008
         AIF   ('&IPL'(2,1) NE '/').IPL09 SLASH?                   @L5A 05350008
&UNITLEN SETA  &UNITLEN-1                                          @L5A 05360008
&UNITBEG SETA  3                                                   @L5A 05370008
&SLASH   SETC  '/'                     PREFIX IPLUNIT WITH SLASH   @D2A 05380008
.IPL09   ANOP  ,                                                   @L5A 05390008
         AIF   (&UNITLEN GT 0).IPL05   WAS UNIT SPECIFIED?              05400008
         MNOTE 0,'AMDSADMP: IPLUNIT WAS NOT SPECIFIED. UNIT WILL BE DEFX05410008
               AULTED     TO 3400.'                                @L3A 05420008
&IPLUNIT SETC  '3400'                  NO, USE DEFAULT                  05430008
         AGO   .IPLEND                                                  05440008
.IPL01   ANOP  ,                                                        05450008
         MNOTE 4,'AMDSADMP: IPL=&IPL IS INVALID. FIRST CHARACTER MUST BX05460008
               E          D OR T, AND HAS BEEN REPLACED WITH A D.' @L3C 05470008
&IPLVAR  SETC  'D'                                             @ZA76321 05480008
&UNITLEN SETA  K'&IPL                                              @L5A 05490008
&UNITBEG SETA  1                                                   @L5A 05500008
         AIF   (&UNITLEN LT 1).IPL08   WAS UNIT SPECIFIED?     @ZA76321 05510008
         AIF   ('&IPL'(1,1) NE '/').IPL05    SLASH?                @P5A 05520008
&UNITLEN SETA  &UNITLEN-1                                          @P5A 05530008
&UNITBEG SETA  2                                                   @P5A 05540008
&SLASH   SETC  '/'                     PREFIX IPLUNIT WITH SLASH   @D2A 05550008
         AIF   (&UNITLEN LT 1).IPL08   WAS UNIT SPECIFIED?         @P5A 05560008
.IPL05   ANOP  ,                       UNIT SPECIFIED                   05570008
         AIF   (&UNITLEN LE 8).IPL02   CHECK FOR EXCESSIVE LGTH    @D2C 05580008
&IPLUNIT SETC  '&IPL'(&UNITBEG,&UNITLEN) RESIDENC VOL UNIT VALU@ZA76321 05590008
         MNOTE 4,'AMDSADMP: IPLUNIT=&IPLUNIT IS TOO LONG.              X05600008
                          THE UNIT NAME WILL BE TRUNCATED.'        @L3C 05610008
&UNITLEN SETA  8                       TRUNCATE                    @D2C 05620008
.IPL02   ANOP  ,                                                        05630008
&IPLUNIT SETC  '&IPL'(&UNITBEG,&UNITLEN) RESIDENCE VOLUME UNIT VALUE    05640008
         AIF   (&UNITLEN GT 2).IPL10   NO PADDING IF THREE OR FOUR      05650008
.*                                     DIGITS HAVE BEEN SPECIFIED  @D2C 05660008
&IPLUNIT SETC  '0'.'&IPLUNIT'          PAD A ZERO TO DEVICE NO.    @P5A 05670008
         AIF   (&UNITLEN EQ 2).IPL10   TWO DIGITS SPECIFIED        @P5A 05680008
&IPLUNIT SETC  '0'.'&IPLUNIT'          PAD A ZERO TO DEVICE NO.    @P5A 05690008
.IPL10   ANOP  ,                                                   @P5A 05700008
&IPLUNIT SETC  '&SLASH'.'&IPLUNIT'     PAD WITH A SLASH IF ONE WAS      05710008
.*                                     PASSED IN                   @D2C 05720008
.IPLEND  ANOP  ,                                                        05730008
.*                                                                      05740008
.********************************************************************   05750008
.*                                                                      05760008
.* ULABEL=  CANNOT BE NOPURGE IF TAPE IPL                               05770008
.*                                                                      05780008
.********************************************************************   05790008
.*                                                                      05800008
&ULABEL2 SETC  '&ULABEL'           ASSUME DEFAULT NOT NEEDED   @PCC1460 05810008
         AIF   ('&ULABEL' NE '').UL01 IS DEFAULT NEEDED?       @PCC1460 05820008
&ULABEL2 SETC  'NOPURGE'             ASSUME IPLVAR = D         @PCC1460 05830008
         AIF   ('&IPLVAR' EQ 'D').UL01 IS IPLVAR D?            @PCC1460 05840008
&ULABEL2 SETC  'PURGE'             CHANGE IF IPLVAR = T        @PCC1460 05850008
.UL01    ANOP  ,                                               @PCC1460 05860008
        AIF ('&IPLVAR' NE 'T' OR '&ULABEL' NE 'NOPURGE').UL02  @PCC1460 05870008
         MNOTE 8,'AMDSADMP: ULABEL=NOPURGE IS NOT POSSIBLE FOR A TAPE  X05880008
                          RESIDENCE VOLUME.'                       @L3C 05890008
.UL02    ANOP  ,                                               @PCC1460 05900008
.*                                                                      05910008
.********************************************************************   05920008
.*                                                                      05930008
.* REUSEDS = ALLOWABLE VALUES ARE NEVER, CHOICE, ALWAYS            @L4A 05940008
.*                                                                      05950008
.********************************************************************   05960008
.*                                                                      05970008
&REUSDS1 SETC  '&REUSEDS'          ASSUME VALUE IS ALRIGHT         @L4A 05980008
         AIF   ('&REUSEDS' NE '').RDS1 WAS REUSEDS SPECIFIED?      @L4A 05990008
&REUSDS1 SETC  'CHOICE'            USE DEFAULT                     @P3C 06000008
.RDS1    ANOP  ,                                                   @L4A 06010008
         AIF   ('&REUSEDS' NE 'NEVER' AND '&REUSEDS' NE 'ALWAYS'       X06020008
               AND '&REUSEDS' NE 'CHOICE').BADRDS                  @L4A 06030008
         AGO   .OUTPUT1                                            @L4A 06040008
.BADRDS  ANOP  ,                                                   @L4A 06050008
         MNOTE 0,'AMDSADMP: REUSEDS=&REUSEDS IS NOT ALLOWED. VALID SPECX06060008
               IFICATIONS ARE NEVER, CHOICE, OR ALWAYS.                X06070008
               REUSEDS=CHOICE HAS BEEN USED.'                      @P4C 06080008
&REUSDS1 SETC  'CHOICE'            USE DEFAULT                     @P3C 06090008
.OUTPUT1 ANOP  ,                                                   @L4A 06100008
.*                                                                      06110008
.********************************************************************   06120008
.*                                                                      06130008
.* OUTPUT= {Tunit!Dunit} or OUTPUT=(Dunit,dataset name)                 06140008
.*                                                                 @06A 06150008
.********************************************************************   06160008
.*                                                                      06170008
&OUTDDS  SETC  ''                     Initialize Dataset name      @06A 06180008
&OUTDEV  SETC  '&OUTPUT'              Assume only output device    @06A 06190008
         AIF   (N'&OUTPUT EQ 0).OUTDFLT Is OUTPUT= specified?          X06200008
                                      No. Set up default               X06210008
                                      Yes.  Check which OUTPUT= form   X06220008
                                      was used.                    @06A 06230008
         AIF  ('&OUTPUT'(1,1) NE '(').CHKDEV  Is dataset name syntax   X06240008
                                      being used?                      X06250008
                                      No.  Check for device number     X06260008
                                           only syntax                 X06270008
                                      Yes. Check for legal dataset     X06280008
                                           name syntax             @06A 06290008
         AIF  (N'&OUTPUT NE 2).OUTBAD Did the user correctly provide   X06300008
                                      both a device and dataset name   X06310008
                                      on the OUTPUT= parameter?        X06320008
                                      No.  Syntax is invalid, issue    X06330008
                                           MNOTE                       X06340008
                                      Yes. Continue checking both the  X06350008
                                           device and dataset name @06A 06360008
&OUTDEV  SETC '&OUTPUT(1)'            Set the output device        @06A 06370008
&OUTDDS  SETC '&OUTPUT(2)'            Set the dataset name         @06A 06380008
.********************************************************************** 06390008
.* Process the output device                                       @06A 06400008
.********************************************************************** 06410008
.CHKDEV  ANOP  ,                                                        06420008
         AIF  ('&OUTDEV'(1,1) NE 'T' AND '&OUTDEV'(1,1) NE 'D').OUTBAD X06430008
                                                                   @06C 06440008
         AIF  (K'&OUTDEV-1 EQ 0).OUTBAD NO ADDRESS, ERROR          @06C 06450008
         AIF  ('&OUTDEV'(2,1) NE '/').SKPSLH2  CHECK FOR '/'       @06C 06460008
         AIF  (K'&OUTDEV LT 5 OR K'&OUTDEV GT 6).OUTBAD                X06470008
                                       VALIDITY CHECK LENGTH       @06C 06480008
&I      SETA  3                        SET START ADDRESS           @L5A 06490008
         AGO    .OUTCHK                                            @L5A 06500008
.SKPSLH2 ANOP  ,                                                   @L5A 06510008
         AIF  (K'&OUTDEV LT 4 OR K'&OUTDEV GT 5).OUTBAD                X06520008
                                       VALIDITY CHECK LENGTH       @06C 06530008
&I      SETA  2                        SET START ADDRESS           @L5A 06540008
.OUTCHK AIF  (K'&OUTDEV LT &I).SETOUT2                             @06C 06550008
        AIF (NOT(('&OUTDEV'(&I,1) GE 'A' AND                           X06560008
                  '&OUTDEV'(&I,1) LE 'F') OR                           X06570008
                 ('&OUTDEV'(&I,1) GE '0' AND                           X06580008
                  '&OUTDEV'(&I,1) LE '9'))).OUTBAD                 @06C 06590008
&I      SETA  &I+1                                                 @L5A 06600008
        AGO   .OUTCHK                                              @L5A 06610008
.*                                                                      06620008
.SETOUT2 ANOP  ,                       Output device is set        @06C 06630008
.********************************************************************** 06640008
.* Process the output dump dataset name                            @06A 06650008
.********************************************************************** 06660008
         AIF ('&OUTDDS' EQ '').NODDSN  Was a dataset name specified?   X06670008
                                        No.  Exit dataset processing   X06680008
                                        Yes. Continue checks       @06A 06690008
         AIF  ('&OUTDEV'(1,1) NE 'D').OUTBAD  Does the output device   X06700008
                                      indicate DASD?                   X06710008
                                      No.  Issue error messages        X06720008
                                      Yes. Check dataset name      @06A 06730008
         AIF (K'&OUTDDS GT 44).DDSERR1  Yes.  Is the name greater than X06740008
                                44 Characters?                         X06750008
                                Yes. Issue MNOTE                       X06760008
                                No.  Check to insure dataset           X06770008
                                     name contains 'SADMP' somewhere   X06780008
                                     in the name                   @06A 06790008
&INDEX   SETA 1                 Index to loop through dataset name @06A 06800008
&LEN     SETA 5                 Length of text 'SADMP'             @06A 06810008
.DDSLOOP ANOP  ,                Loop label                         @06A 06820008
         AIF (&INDEX+&LEN GT K'&OUTDDS+1).DDSERR2  Have we searched    X06830008
                                the entire dataset name without findingX06840008
                                the text 'SADMP'?                      X06850008
                                Yes.  Issue MNOTE                  @06A 06860008
         AIF ('&OUTDDS'(&INDEX,&LEN) EQ 'SADMP').DDSEXIT  No.  Does    X06870008
                                the current 5 characters in the datasetX06880008
                                name contain the text 'SADMP'          X06890008
                                Yes. A valid dataset name has been     X06900008
                                     found                             X06910008
                                No.  Continue dataset name search  @06A 06920008
&INDEX   SETA &INDEX+1          Increment index                    @06A 06930008
         AGO .DDSLOOP           Check next 5 characters            @06A 06940008
.********************************************************************** 06950008
.* Invalid dataset name.  The dataset name is greater than 44           06960008
.* charcters.                                                      @06A 06970008
.********************************************************************** 06980008
.DDSERR1 ANOP  ,                Error Label                        @06A 06990008
         MNOTE 4,'AMDSADMP: OUTPUT DUMP DATA SET NAME IS INCORRECT. THEX07000008
                DATASET     NAME IS GREATER THAN 44 CHARACTERS.'   @06A 07010008
         AGO .NODDSN            Exit dataset name processing       @06A 07020008
.********************************************************************** 07030008
.* Invalid dataset name.  The dataset name does not contain the         07040008
.* text 'SADMP'.                                                   @06A 07050008
.********************************************************************** 07060008
.DDSERR2 ANOP  ,                Error Label                        @06A 07070008
         MNOTE 4,'AMDSADMP: OUTPUT DUMP DATA SET NAME IS INCORRECT. IT X07080008
               MUST         CONTAIN THE TEXT ''SADMP''.'           @06A 07090008
         AGO .NODDSN            Exit dataset name processing       @06A 07100008
.********************************************************************** 07110008
.* Invalid OUTPUT= parameter.  The OUTPUT= parameter was not in the     07120008
.* form OUTPUT={T!D}unit OR (Dunit,Dataset name)                   @06A 07130008
.********************************************************************** 07140008
.OUTBAD  ANOP  ,                Output parameter is incorrect      @06M 07150008
         MNOTE 4,'AMDSADMP: OUTPUT=&OUTPUT IS INCORRECT. IT MUST BE EITX07160008
               HER {T!D}UNIT OR (DUNIT,DATASET NAME).'             @06C 07170008
         AIF   (&OSG).SYSUT01   Bypass default message for one step    X07180008
                                generation since assembly will fail@06M 07190008
.OUTDFLT MNOTE 0,'AMDSADMP: DEFAULT OUTPUT DEVICE T0282 WILL BE USED.' X07200008
                                                                   @06M 07210008
.SYSUT01 ANOP  ,                       Still set up default to avoid   X07220008
                                       extra assembler messages    @06M 07230008
&OUTDEV  SETC  'T0282'                 SET TAPE DEFAULT ADDRESS    @06M 07240008
.********************************************************************** 07250008
.* Dataset name is not to be used.  Reinitialize the dataset name       07260008
.* to blanks and exit.                                             @06A 07270008
.********************************************************************** 07280008
.NODDSN  ANOP  ,                Dataset name will not be used      @06A 07290008
&OUTDDS  SETC ''                Reinitialize dataset name to blank @06A 07300008
.********************************************************************** 07310008
.* Set up the AMDSADM2 OUTPUT= specification.                      @06A 07320008
.********************************************************************** 07330008
.DDSEXIT ANOP  ,                                                        07340008
&OUTPUT2 SETC '&OUTDEV'         Assume that only a device is specified X07350008
                                                                   @06A 07360008
         AIF   ('&OUTDDS' EQ '').OUTEXIT  Is a dataset name also being X07370008
                                used?                                  X07380008
                                No.  Continue with only a device       X07390008
                                Yes. Construct the output parameter    X07400008
                                     with both device and dataset      X07410008
                                     name                          @06A 07420008
&OUTPUT2 SETC '('.'&OUTDEV'.','.'&OUTDDS'.')'                      @06A 07430008
.OUTEXIT ANOP  ,                Continue                           @06A 07440008
.*                                                                      07450008
.********************************************************************   07460008
.*                                                                      07470008
.*                      MINASID= PARAMETER                              07480008
.*                                                                @L3M  07490008
.********************************************************************   07500008
.*                                                                      07510008
         AIF   ('&MINASID' EQ 'ALL').MIN2                          @L3M 07520008
         AIF   ('&MINASID' EQ 'PHYSIN').MIN3                       @L3M 07530008
.MIN1    ANOP  ,                                                   @L3M 07540008
         MNOTE 0,'AMDSADMP: MINASID=ALL OR MINASID=PHYSIN NOT SPECIFIEDX07550008
               ,          THE DEFAULT MINASID=ALL WILL BE USED.'   @L3C 07560008
.MIN2    ANOP  ,                                                   @L3M 07570008
&MINTYPE SETC  'ALL'                                               @L3M 07580008
         AGO   .MIN5                                               @L3M 07590008
.MIN3    ANOP  ,                                                   @L3M 07600008
&MINTYPE SETC  'PHYSIN'                                            @L3M 07610008
         MNOTE 0,'AMDSADMP: WARNING MINASID=&MINASID WAS SPECIFIED. REFX07620008
               ER TO        MESSAGE AMD082I.'                      @L3C 07630008
.MIN5    ANOP  ,                                                   @L3M 07640008
.*                                                                      07650008
.********************************************************************   07660008
.*                                                                      07670008
.*                      REAL= PARAMETER                                 07680008
.*                                                                @LCA  07690008
.********************************************************************   07700008
.*                                                                      07710008
         AIF   ('&REAL' EQ 'ALL').REAL2                            @LCA 07720008
         AIF   ('&REAL' EQ 'USED').REAL3                           @LCA 07730008
         MNOTE 0,'AMDSADMP: REAL=ALL OR REAL=USED NOT SPECIFIED,       X07740008
                          THE DEFAULT REAL=ALL WILL BE USED.'      @LCA 07750008
.REAL2   ANOP  ,                                                   @LCA 07760008
&REALTYPE SETC 'ALL'                                               @LCA 07770008
         AGO   .REAL5                                              @LCA 07780008
.REAL3   ANOP  ,                                                   @LCA 07790008
&REALTYPE SETC 'USED'                                              @LCA 07800008
.REAL5   ANOP  ,                                                   @LCA 07810008
.*                                                                      07820008
.********************************************************************   07830008
.*                                                                      07840008
.* IPLEXIST=(YES ! NO)                                                  07850008
.*                                                                      07860008
.* If IPLEXIST=YES is specified, specify IPLEXIST in the input          07870008
.* to ICKDSF, in order to avoid prompting the operator to respond       07880008
.* to message ICK21836D.                                                07890008
.*                                                                 @PCA 07900008
.********************************************************************   07910008
.*                                                                      07920008
&IPLEXYES SETC  '        '                                         @PCA 07930008
         AIF   ('&IPLEXIST' EQ 'YES').IPLEXY                       @PCA 07940008
         AIF   ('&IPLEXIST' EQ 'NO').IPLEXOK                       @PCA 07950008
         MNOTE 0,'AMDSADMP: IPLEXIST=&IPLEXIST IS NOT ALLOWED. IT MUST X07960008
                BE YES OR NO.   IPLEXIST=NO HAS BEEN USED.'        @PCA 07970008
         AGO   .IPLEXOK                                            @PCA 07980008
.IPLEXY  ANOP  ,                                                   @PCA 07990008
&IPLEXYES SETC  'IPLEXIST'                                         @PCA 08000008
.IPLEXOK ANOP  ,                                                   @PCA 08010008
.*                                                                      08020008
.********************************************************************   08030008
.*                                                                      08040008
.* LDIPL=(YES ! NO)                                                     08050008
.*                                                                      08060008
.* If LDIPL=YES is specified, specify LDIPL(DUMP) LDIRTS(4)             08070008
.* in the input to ICKDSF,                                              08080008
.*                                                                 @09A 08090008
.********************************************************************   08100008
.*                                                                      08110008
&LDIPLYES SETC  '        '                                         @09A 08120008
         AIF   ('&LDIPL' EQ 'YES').LDIPLY                          @09A 08130008
         AIF   ('&LDIPL' EQ 'NO').LDIPLOK                          @09A 08140008
         MNOTE 0,'AMDSADMP: LDIPL=&LDIPL IS NOT ALLOWED. IT MUST BE YESX08150010
                OR NO. LDIPL=NO HAS BEEN USED.'                    @09A 08160010
         AGO   .LDIPLOK                                            @09A 08170008
.LDIPLY  ANOP  ,                                                   @09A 08180008
&LDIPLYES SETC  'LDIPL(DUMP) LDIRTS(4)'                            @09A 08190008
         AIF   ('&IPLVAR' EQ 'D').LDIPLOK                          @09A 08200010
         MNOTE 0,'AMDSADMP: LDIPL=&LDIPL IS NOT ALLOWED FOR TAPE DEVICEX08210010
               S. LDIPL=NO HAS BEEN USED.'                         @09A 08210110
.LDIPLOK ANOP  ,                                                   @09A 08210208
.*                                                                      08210308
.********************************************************************   08220008
.*                                                                      08230008
.*  THE LABEL NAME OF THE MACRO IS USED FOR THE JOBNAME                 08240008
.*                                                                      08250008
.********************************************************************   08260008
.*                                                                      08270008
         AIF   ('&SADMP' EQ '').LBL2  IS LABEL BLANKS?                  08280008
&JOBNAME SETC  '&SADMP'                SET JOBNAME TO SADMP LABEL       08290008
         AGO   .LBL1                                                    08300008
.LBL2    ANOP  ,                       SET DEFAULT JOBNAME              08310008
&JOBNAME SETC  'AMDSADMP'              DEFAULT JOBNAME                  08320008
.LBL1    ANOP  ,                                                        08330008
.*                                                                      08340008
.********************************************************************   08350008
.*                                                                      08360008
.* ALIB= PARAMETER                                                      08370008
.*                                                                      08380008
.* SPECIFIES A GLOBAL VOLSER AND UNIT TYPE FOR THE SYS1.NUCLEUS,        08390008
.* SYS1.MODGEN, AND SYS1.LINKLIB SYSTEM DATA SETS WHICH ARE PUNCHED     08400008
.* OUT AS PART OF THE STAGE-TWO JCL IN THE TWO-STAGE GENERATION         08410008
.* PROCESS.                                                             08420008
.*                                                                @D2A  08430008
.********************************************************************   08440008
.*                                                                      08450008
&AVOL    SETC  ''                   INITIALIZE GLOBAL VOLSER      @D2A  08460008
&AUNIT   SETC  ''                   INITIALIZE GLOBAL UNIT TYPE   @D2A  08470008
         AIF   (K'&ALIB EQ 0).NOALIB   WAS ALIB SPECIFIED         @D2A  08480008
         AIF   (&OSG).ERRALIB2      ALIB is only for two-stage    @PEA  08490008
         AIF   (N'&ALIB NE 2).ERRALIB  ARE 2 PARMS SPECIFIED      @D2A  08500008
&AVOL    SETC  ',VOL=SER='.'&ALIB(1)'  USE VOLSER PROVIDED        @D2A  08510008
&AUNIT   SETC  ',UNIT='.'&ALIB(2)'     USE UNIT PROVIDED          @D2A  08520008
         AGO .NOALIB                NO ERROR, CONTINUE            @D2A  08530008
.ERRALIB2 ANOP  ,                                                 @PEA  08540008
         MNOTE 8,'AMDSADMP: ALIB=&ALIB IS NOT VALID FOR ONE-STAGE GENERX08550008
               ATION.'                                            @PEA  08560008
         AGO .NOALIB                Continue                      @PEA  08570008
.ERRALIB ANOP  ,                                                  @D2A  08580008
         MNOTE 8,'AMDSADMP: ALIB=&ALIB IS NOT VALID.  THE REQUIRED SYNTX08590008
               AX IS ALIB=(VOLSER,UNIT).'                         @D2A  08600008
.*                                                               2@PED  08610008
.NOALIB  ANOP  ,                    CONTINUE                      @D2A  08620008
.*                                                                      08630008
.********************************************************************   08640008
.*                                                                      08650008
.* NUCLIB= PARAMETER.                                                   08660008
.*                                                                      08670008
.* SPECIFIES A VOLSER AND UNIT TYPE FOR THE SYS1.NUCLEUS SYSTEM         08680008
.* DATA SET WHICH IS PUNCHED OUT AS PART OF THE STAGE-TWO JCL IN        08690008
.* THE TWO-STAGE GENERATION PROCESS, or passed to AMDSAOSG in the       08700008
.* one-stage generation process.                                        08710008
.*                                                                @PEC  08720008
.********************************************************************   08730008
.*                                                                      08740008
&NUCVOL  SETC  '&AVOL'              SET SYS1.NUCLEUS VOLSER       @D2A  08750008
&NUCUNIT SETC  '&AUNIT'             SET SYS1.NUCLEUS UNIT TYPE    @D2A  08760008
         AIF   (K'&NUCLIB EQ 0).NONUC   WAS NUCLIB SPECIFIED      @D2A  08770008
         AIF   (N'&NUCLIB NE 2).ERRNUC  ARE 2 PARMS SPECIFIED     @D2A  08780008
&NUCVOL  SETC  ',VOL=SER='.'&NUCLIB(1)' USE VOLSER PROVIDED       @D2A  08790008
&NUCUNIT SETC  ',UNIT='.'&NUCLIB(2)'    USE UNIT PROVIDED         @D2A  08800008
         AGO .NONUC                 NO ERROR, CONTINUE            @D2A  08810008
.ERRNUC  ANOP  ,                                                  @D2A  08820008
         MNOTE 8,'AMDSADMP: NUCLIB=&NUCLIB IS NOT VALID.  THE REQUIRED X08830008
               SYNTAX IS NUCLIB=(VOLSER,UNIT).'                   @D2A  08840008
&NUCVOL  SETC  ''                   RESET VOLSER TO NULL          @D2A  08850008
&NUCUNIT SETC  ''                   RESET UNIT TYPE TO NULL       @D2A  08860008
.NONUC   ANOP  ,                    CONTINUE                      @D2A  08870008
.*                                                                      08880008
.********************************************************************   08890008
.*                                                                      08900008
.* LNKLIB= PARAMETER.                                                   08910008
.*                                                                      08920008
.* SPECIFIES A VOLSER AND UNIT TYPE FOR THE SYS1.LINKLIB SYSTEM         08930008
.* DATA SET WHICH IS PUNCHED OUT AS PART OF THE STAGE-TWO JCL IN        08940008
.* THE TWO-STAGE GENERATION PROCESS.                                    08950008
.*                                                                @D2A  08960008
.********************************************************************   08970008
.*                                                                      08980008
&LNKVOL  SETC  '&AVOL'              SET SYS1.LINKLIB VOLSER       @D2A  08990008
&LNKUNIT SETC  '&AUNIT'             SET SYS1.LINKLIB UNIT TYPE    @D2A  09000008
         AIF   (K'&LNKLIB EQ 0).NOLNK   WAS LNKLIB SPECIFIED      @D2A  09010008
         AIF   (&OSG).ERRLNK2       LNKLIB is only for two-stage  @PEA  09020008
         AIF   (N'&LNKLIB NE 2).ERRLNK  ARE 2 PARMS SPECIFIED     @D2A  09030008
&LNKVOL  SETC  ',VOL=SER='.'&LNKLIB(1)' USE VOLSER PROVIDED       @D2A  09040008
&LNKUNIT SETC  ',UNIT='.'&LNKLIB(2)'    USE UNIT PROVIDED         @D2A  09050008
         AGO .NOLNK                 NO ERROR, CONTINUE            @D2A  09060008
.ERRLNK2 ANOP  ,                                                  @D2A  09070008
         MNOTE 8,'AMDSADMP: LNKLIB=&LNKLIB IS NOT VALID FOR ONE-STAGE GX09080008
               ENERATION.'                                        @PEA  09090008
         AGO .NOLNK                 Continue                      @PEA  09100008
.ERRLNK  ANOP  ,                                                  @D2A  09110008
         MNOTE 8,'AMDSADMP: LNKLIB=&LNKLIB IS NOT VALID.  THE REQUIRED X09120008
               SYNTAX IS LNKLIB=(VOLSER,UNIT).'                   @D2A  09130008
.*                                                               2@PED  09140008
.NOLNK   ANOP  ,                    CONTINUE                      @D2A  09150008
.*                                                                      09160008
.********************************************************************   09170008
.*                                                                      09180008
.* MODLIB= PARAMETER.                                                   09190008
.*                                                                      09200008
.* SPECIFIES A VOLSER AND UNIT TYPE FOR THE SYS1.MODGEN SYSTEM          09210008
.* DATA SET WHICH IS PUNCHED OUT AS PART OF THE STAGE-TWO JCL IN        09220008
.* THE TWO-STAGE GENERATION PROCESS.                                    09230008
.*                                                                @D2A  09240008
.********************************************************************   09250008
.*                                                                      09260008
&MODVOL  SETC  '&AVOL'              SET SYS1.MODGEN VOLSER        @D2A  09270008
&MODUNIT SETC  '&AUNIT'             SET SYS1.MODGEN UNIT TYPE     @D2A  09280008
         AIF   (K'&MODLIB EQ 0).NOMOD   WAS MODLIB SPECIFIED      @D2A  09290008
         AIF   (&OSG).ERRMOD2       MODLIB is only for two-stage  @PEA  09300008
         AIF   (N'&MODLIB NE 2).ERRMOD  ARE 2 PARMS SPECIFIED     @D2A  09310008
&MODVOL  SETC  ',VOL=SER='.'&MODLIB(1)' USE VOLSER PROVIDED       @D2A  09320008
&MODUNIT SETC  ',UNIT='.'&MODLIB(2)'    USE UNIT PROVIDED         @D2A  09330008
         AGO .NOMOD                 NO ERROR, CONTINUE            @D2A  09340008
.ERRMOD2 ANOP  ,                                                  @D2A  09350008
         MNOTE 8,'AMDSADMP: MODLIB=&MODLIB IS NOT VALID FOR ONE-STAGE GX09360008
               ENERATION.'                                        @PEA  09370008
         AGO .NOMOD                 Continue                      @PEA  09380008
.ERRMOD  ANOP  ,                                                  @D2A  09390008
         MNOTE 8,'AMDSADMP: MODLIB=&MODLIB IS NOT VALID.  THE REQUIRED X09400008
               SYNTAX IS MODLIB=(VOLSER,UNIT).'                   @D2A  09410008
.*                                                               2@PED  09420008
.NOMOD   ANOP  ,                    CONTINUE                      @D2A  09430008
.*                                                                      09440008
.********************************************************************   09450008
.*                                                                      09460008
.*  JCL TO ASSEMBLE AMDSADM2 WHICH WILL CREATE CSECTS AMDSACCT AND      09470008
.*  AMDSARDM, OR FOR ONE STEP GENERATION, THE ACTUAL EXPANSION OF       09480008
.*  THE AMDSADM2 MACRO TO CREATE THE OBJ AS OUTPUT PLUS CONTROL         09490008
.*  CARDS FOR AMDSABLD AND ICKDSF.                                      09500008
.*                                                                      09510008
.********************************************************************   09520008
.*                                                                      09530008
         SPACE                                                          09540008
         PUNCH '//&JOBNAME JOB MSGLEVEL=(1,1)'                     @L6C 09550008
.*                                                                3@L6D 09560008
         PUNCH '//ASMA EXEC PGM=ASMA90,REGION=1024K,'              @P9C 09570008
         PUNCH '//     PARM=''ASA,DECK,NORENT,NOOBJECT,NOXOBJECT'''    X09580008
                                                                   @07C 09590008
.*                                                                 @L6D 09600008
         PUNCH '//SYSLIB DD DSN=SYS1.MODGEN,DISP=SHR&MODVOL&MODUNIT'   X09610008
                                                                   @D2A 09620008
         PUNCH '//SYSUT1 DD UNIT=&SYSUT,SPACE=(1700,(400,50))'          09630008
         PUNCH '//SYSPRINT DD SYSOUT=A'                                 09640008
         PUNCH '//SYSPUNCH DD DSN=&&OBJ,UNIT=&SYSUT,'                   09650008
         PUNCH '// DCB=BLKSIZE=3360,'                          @YA47897 09660008
         PUNCH '// SPACE=(80,(250,50)),DISP=(,PASS)'                    09670008
         PUNCH '//SYSIN DD *'                                           09680008
.*                                                                      09690008
.********************************************************************   09700008
.* If One Stage generation, skip building the AMDSADM2 macro      @PEC  09710008
.********************************************************************   09720008
.*                                                                      09730008
         AIF   (&OSG).OSG01                                       @PEM  09740008
.*                                                                      09750008
.********************************************************************** 09760008
.*                                                                      09770008
.* BUILDS THE AMDSADM2 MACRO.                                           09780008
.*                                                                6@L6D 09790008
.********************************************************************** 09800008
.*                                                                      09810008
.*                                                                3@L6D 09820008
&LIST    SETC  'IPL='.'&IPLVAR'.','                                @L3A 09830008
&REP     SETA  53-K'&LIST                                          @L3A 09840008
&LIST    SETC  '&LIST'.(&REP)' '.'X'                               @L3A 09850008
         PUNCH '         AMDSADM2 &LIST'                           @L3A 09860008
.OSG01   ANOP  ,                                               @PCC1027 09870008
.*                                                                      09880008
.********************************************************************   09890008
.*                                                                      09900008
.* BUILD CONSOLE= KEYWORD WHICH MAY REQUIRE CONTINUATION LINES.         09910008
.*                                                                      09920008
.********************************************************************   09930008
.*                                                                      09940008
         AIF   (&OSG).OSG02                                             09950008
&KEYWORD SETC  'CONSOLE='       KEYWORD FOR AMDSADM2 MACRO              09960008
.OSG02   ANOP  ,                                                        09970008
&BEG     SETA  1                SUBSTRING INDEX INIT VALUE              09980008
.CLOOP   ANOP  ,                VALUE OF KEYWORD MAY REQUIRE SEVERAL   X09990008
                                CARDS PUNCHED.                          10000008
&LEN     SETA  56-K'&KEYWORD      TAKE MAX SUBSTRING FOR NEXT CARD      10010008
         AIF   (K'&CONLIST-&BEG+1 GE &LEN).C1 COMPARE TO REMAINING      10020008
&LEN     SETA  K'&CONLIST-&BEG+1 REDUCE TO THE REMAINING LENGTH         10030008
.C1      ANOP  ,                                                        10040008
&SUBSTR  SETC  '&CONLIST'(&BEG,&LEN) OBTAIN PORTION FOR THIS CARD       10050008
.*                                                                      10060008
&LIST    SETC  '&KEYWORD'.'&SUBSTR'                                     10070008
&COMMA   SETC  ','              ASSUME COMMA NEEDED TO END KEYWORD      10080008
         AIF   (&OSG).OSG03                                             10090008
&REP     SETA  55-K'&LIST       CALC NUM OF BLANKS NEEDED               10100008
         AIF   (&REP GE 0).C5   55 OR LESS CHAR IN STRING               10110008
&LIST    SETC  '&LIST'.'X'      56,SO ADD CONTINUATION CHARACTER        10120008
         AGO   .C7                                                      10130008
.C5      AIF   (&REP GT 0).C6   54 OR LESS CHAR IN STRING               10140008
&LIST    SETC  '&LIST'.',X'     55 SO, ADD COMMA & CONT CHAR            10150008
&COMMA   SETC  ''               COMMA NO LONGER NEEDED TO END KWD       10160008
         AGO   .C7                                                      10170008
.C6      ANOP  ,                54 OR LESS                              10180008
&LIST    SETC  '&LIST'.','.(&REP)' '.'X' COMMA BLANKS & CONT CHAR       10190008
&COMMA   SETC  ''               COMMA NO LONGER NEEDED TO END KWD       10200008
.C7      ANOP  ,                                                        10210008
         PUNCH '               &LIST'                                   10220008
         AGO   .OSG04                                                   10230008
.OSG03   ANOP  ,                                                        10240008
&CON2    SETC   '&CON2'.'&LIST'                                         10250008
.OSG04   ANOP  ,                                                        10260008
&BEG     SETA  &BEG+&LEN        MOVE TO THE NEXT PIECE                  10270008
         AIF   (&BEG GT K'&CONLIST).CONDONE IS ALL OF STRING DONE?      10280008
&KEYWORD SETC  ''               INIT FOR NEXT ITERATION                 10290008
         AGO   .CLOOP                                                   10300008
.CONDONE ANOP  ,                                                        10310008
.*                                                                      10320008
.********************************************************************   10330008
.*                                                                      10340008
.*  PUNCH PROMPT, MSG=, COMPACT=, and DDSPROMPT= KEYWORDS          @06C 10350008
.*      --NOTE POSSIBLE PRECEEDING COMMA FROM CONSOLE=                  10360008
.*                                                                      10370008
.********************************************************************   10380008
.*                                                                      10390008
&LIST    SETC  '&COMMA'.'&PMTK'.'MSG='.'&MSGK'.','                      10400008
&LIST    SETC  '&LIST'.'COMPACT='.'&COMPK'.','                     @06C 10410008
&LIST    SETC  '&LIST'.'DDSPROMPT='.'&DDSPMTK'.','                 @06A 10420008
         AIF   (&OSG).OSG05                                             10430008
&REP     SETA  56-K'&LIST                                               10440008
&LIST    SETC  '&LIST'.(&REP)' '.'X'                                    10450008
         PUNCH '               &LIST'                                   10460008
         AGO   .OSG06                                                   10470008
.OSG05   ANOP  ,                                                        10480008
&DM2LN3  SETC   '&LIST'                                                 10490008
.OSG06   ANOP  ,                                                        10500008
.*                                                                      10510008
.********************************************************************   10520008
.*                                                                      10530008
.* BUILD DUMP= KEYWORD WHICH MAY REQUIRE CONTINUATION LINES.            10540008
.* NOTE: THE VALUE OF THIS IS PASSED UNCHECKED AND UNCHANGED TO         10550008
.* AMDSADM2 AND FROM THERE TO AMDSAPMT FOR PARSING.                     10560008
.*                                                                      10570008
.********************************************************************   10580008
.*                                                                      10590008
         AIF   (&OSG).OSG07                                             10600008
         AIF (K'&DUMP EQ 0).NODUMP  CHECK FOR OPTIONAL DUMP= VALUE      10610008
&KEYWORD SETC  'DUMP='          KEYWORD FOR AMDSADM2 MACRO              10620008
&BEG     SETA  1                SUBSTRING INDEX INIT VALUE              10630008
.DLOOP   ANOP  ,                VALUE OF KEYWORD MAY REQUIRE SEVERAL    10640008
.*                              CARDS PUNCHED.                          10650008
&LEN     SETA  56-K'&KEYWORD      TAKE MAX SUBSTRING FOR NEXT CARD      10660008
         AIF   (K'&DUMP-&BEG+1 GE &LEN).D1 COMPARE WITH REMAINING       10670008
&LEN     SETA  K'&DUMP-&BEG+1   REDUCE TO THE REMAINING LENGTH          10680008
.D1      ANOP  ,                                                        10690008
&SUBSTR  SETC  '&DUMP'(&BEG,&LEN) OBTAIN PORTION FOR THIS CARD          10700008
.*                                                                      10710008
&INDEX   SETA  0                 INIT                                   10720008
&LIST    SETC  '&KEYWORD'        INIT                                   10730008
.SUBLOOP ANOP  ,                 LOOP TO DOUBLE UP THE QUOTES           10740008
         AIF   (&INDEX EQ K'&SUBSTR).D4 HAS END BEEN REACHED            10750008
&INDEX   SETA  &INDEX+1          MOVE TO NEXT CHAR                      10760008
         AIF   ('&SUBSTR'(&INDEX,1) EQ '&Q').D3  IS THIS A QUOTE        10770008
&LIST    SETC  '&LIST'.'&SUBSTR'(&INDEX,1) ADD CHAR AS IS               10780008
         AGO   .SUBLOOP                                                 10790008
.D3      ANOP  ,                                                        10800008
&LIST    SETC  '&LIST'.'&QQ'       REPLACE WITH DOUBLE QUOTE            10810008
         AGO   .SUBLOOP                                                 10820008
.D4      ANOP  ,                                                        10830008
.*                                                                      10840008
&COMMA   SETC  ','              ASSUME NEEDED TO END KEYWORD            10850008
&REP     SETA  55-K'&SUBSTR-K'&KEYWORD CALC NUM OF BLANKS NEEDED        10860008
         AIF   (&REP GE 0).D5   55 OR LESS CHAR IN STRING               10870008
&LIST    SETC  '&LIST'.'X'      56,SO ADD CONTINUATION CHARACTER        10880008
         AGO   .D7                                                      10890008
.D5      AIF   (&REP GT 0).D6   54 OR LESS CHAR IN STRING               10900008
&LIST    SETC  '&LIST'.',X'     55 SO, ADD COMMA & CONT CHAR            10910008
&COMMA   SETC  ''               COMMA NO LONGER NEEDED TO END KWD       10920008
         AGO   .D7                                                      10930008
.D6      ANOP  ,                54 OR LESS                              10940008
&LIST    SETC  '&LIST'.','.(&REP)' '.'X' COMMA BLANKS & CONT CHAR       10950008
&COMMA   SETC  ''               COMMA NO LONGER NEEDED TO END KWD       10960008
.D7      ANOP  ,                                                        10970008
         PUNCH '               &LIST'                                   10980008
&BEG     SETA  &BEG+&LEN        MOVE TO THE NEXT PIECE                  10990008
         AIF   (&BEG GT K'&DUMP).NODUMP IS ALL OF STRING DONE?          11000008
&KEYWORD SETC  ''               NULL AFTER FIRST CARD                   11010008
         AGO   .DLOOP                                                   11020008
.NODUMP  ANOP  ,                                                        11030008
.OSG07   ANOP  ,                                                        11040008
.*                                                                      11050008
.********************************************************************   11060008
.*                                                                      11070008
.* BUILD ADDSUMM= KEYWORD WHICH MAY REQUIRE CONTINUATION LINES.         11080008
.* NOTE: THE VALUE OF THIS IS PASSED UNCHECKED AND UNCHANGED TO         11090008
.* AMDSADM2 AND FROM THERE TO AMDSAPMT FOR PARSING.                     11100008
.*                                                                 @LAA 11110008
.********************************************************************   11120008
.*                                                                 @LAA 11130008
         AIF   (&OSG).OSG0S                                        @LAA 11140008
         AIF (K'&ADDSUMM EQ 0).NOADDS  CHECK FOR OPTIONAL ADDSUMM= @LAA 11150008
&KEYWORD SETC  'ADDSUMM='       KEYWORD FOR AMDSADM2 MACRO         @LAA 11160008
&BEG     SETA  1                SUBSTRING INDEX INIT VALUE         @LAA 11170008
.DLOOPA  ANOP  ,                VALUE OF KEYWORD MAY REQUIRE       @LAA 11180008
.*                              SEVERAL CARDS PUNCHED              @LAA 11190008
&LEN     SETA  56-K'&KEYWORD      TAKE MAX SUBSTRING FOR NEXT CARD @LAA 11200008
         AIF   (K'&ADDSUMM-&BEG+1 GE &LEN).A1 COMPARE W/ REMAINING @LAA 11210008
&LEN     SETA  K'&ADDSUMM-&BEG+1   REDUCE TO THE REMAINING LENGTH  @LAA 11220008
.A1      ANOP  ,                                                   @LAA 11230008
&SUBSTR  SETC  '&ADDSUMM'(&BEG,&LEN) OBTAIN PORTION FOR THIS CARD  @LAA 11240008
.*                                                                 @LAA 11250008
&INDEX   SETA  0                 INIT                              @LAA 11260008
&LIST    SETC  '&KEYWORD'        INIT                              @LAA 11270008
.SUBLPA  ANOP  ,                 LOOP TO DOUBLE UP THE QUOTES      @LAA 11280008
         AIF   (&INDEX EQ K'&SUBSTR).A3 HAS END BEEN REACHED       @LAA 11290008
&INDEX   SETA  &INDEX+1          MOVE TO NEXT CHAR                 @LAA 11300008
         AIF   ('&SUBSTR'(&INDEX,1) EQ '&Q').A2  IS THIS A QUOTE   @LAA 11310008
&LIST    SETC  '&LIST'.'&SUBSTR'(&INDEX,1) ADD CHAR AS IS          @LAA 11320008
         AGO   .SUBLPA                                             @LAA 11330008
.A2      ANOP  ,                                                   @LAA 11340008
&LIST    SETC  '&LIST'.'&QQ'       REPLACE WITH DOUBLE QUOTE       @LAA 11350008
         AGO   .SUBLPA                                             @LAA 11360008
.A3      ANOP  ,                                                   @LAA 11370008
.*                                                                 @LAA 11380008
&COMMA   SETC  ','              ASSUME NEEDED TO END KEYWORD       @LAA 11390008
&REP     SETA  55-K'&SUBSTR-K'&KEYWORD CALC NUM OF BLANKS NEEDED   @LAA 11400008
         AIF   (&REP GE 0).A4   55 OR LESS CHAR IN STRING          @LAA 11410008
&LIST    SETC  '&LIST'.'X'      56,SO ADD CONTINUATION CHARACTER   @LAA 11420008
         AGO   .A6                                                 @LAA 11430008
.A4      AIF   (&REP GT 0).A5   54 OR LESS CHAR IN STRING          @LAA 11440008
&LIST    SETC  '&LIST'.',X'     55 SO, ADD COMMA & CONT CHAR       @LAA 11450008
&COMMA   SETC  ''               COMMA NO LONGER NEEDED TO END KWD  @LAA 11460008
         AGO   .A6                                                 @LAA 11470008
.A5      ANOP  ,                54 OR LESS                         @LAA 11480008
&LIST    SETC  '&LIST'.','.(&REP)' '.'X' COMMA BLANKS & CONT CHAR  @LAA 11490008
&COMMA   SETC  ''               COMMA NO LONGER NEEDED TO END KWD  @LAA 11500008
.A6      ANOP  ,                                                   @LAA 11510008
         PUNCH '               &LIST'                              @LAA 11520008
&BEG     SETA  &BEG+&LEN        MOVE TO THE NEXT PIECE             @LAA 11530008
         AIF   (&BEG GT K'&ADDSUMM).NOADDS IS ALL OF STRING DONE?  @LAA 11540008
&KEYWORD SETC  ''               NULL AFTER FIRST CARD              @LAA 11550008
         AGO   .DLOOPA                                             @LAA 11560008
.NOADDS  ANOP  ,                                                   @LAA 11570008
.OSG0S   ANOP  ,                                                   @LAA 11580008
.********************************************************************   11590008
.*                                                                      11600008
.*  Punch keyword MINASID, REUSEDS, and AMD029                     @PCC 11610008
.*                                                                      11620008
.********************************************************************   11630008
.*                                                                      11640008
&LIST    SETC  '&COMMA'.'MINASID='.'&MINTYPE'.','                  @L3C 11650008
&LIST    SETC  '&COMMA'.'REAL='.'&REALTYPE'.','                    @LCA 11660008
&LIST    SETC  '&LIST'.'REUSEDS='.'&REUSDS1'.','                   @L4A 11670008
&LIST    SETC  '&LIST'.'AMD029='.'&AMD0291'.','                    @PCA 11680008
         AIF   (&OSG).MIN6                                         @L3M 11690008
&REP     SETA  56-K'&LIST                                          @L3M 11700008
&LIST    SETC  '&LIST'.(&REP)' '.'X'                               @L3M 11710008
         PUNCH '               &LIST'                              @L3M 11720008
.MIN6    ANOP  ,                                                   @L3M 11730008
.*                                                                      11740008
.********************************************************************** 11750008
.*  Logic: Punch the OUTPUT= keyword.                                   11760008
.*                                                                      11770008
.*  If the OUTPUT= keyword has a length that exceeds one line in        11780008
.*  length, then the OUTPUT= specification must be split into two       11790008
.*  lines with the first one containing a continuation character   @06A 11800008
.********************************************************************** 11810008
.*                                                                      11820008
&KEYWORD SETC  ''                      Initialize keyword          @06A 11830008
         AIF   (&OSG).OSG08            Is this 1-step generation?      X11840008
                                       Yes. Skip OUTPUT keyword    @06A 11850008
&KEYWORD SETC  'OUTPUT='               No.  Set OUTPUT keyword     @06A 11860008
.OSG08   ANOP  ,                                                   @L3A 11870008
&BEG     SETA  1                                                        11880008
&LEN     SETA  56-K'&KEYWORD           Maximum string length       @06A 11890008
         AIF   (K'&OUTPUT2 LE &LEN).OUT1  Is the length of the OUTPUT= X11900008
                                       parameter too large for one     X11910008
                                       line?                           X11920008
                                       No.  Punch 1 line only          X11930008
                                       Yes. Create first line with a   X11940008
                                            continuation character @06A 11950008
&LIST    SETC  '&KEYWORD'.'&OUTPUT2'(&BEG,&LEN).'X'                @06A 11960008
.*                                     Punch first line            @06A 11970008
         PUNCH '               &LIST'                                   11980008
&BEG     SETA  &LEN+1                                                   11990008
&LEN     SETA  K'&OUTPUT2-&LEN                                          12000008
&LIST    SETC  '&OUTPUT2'(&BEG,&LEN)   Set up second line              X12010008
                                       with remaining output       @06A 12020008
.*                                     Punch second line           @06A 12030008
         PUNCH '               &LIST'                                   12040008
         AGO   .OUT2                   Branch to continue          @06A 12050008
.OUT1    ANOP  ,                       Entire output specification     X12060008
                                       will fit on one line        @06A 12070008
&LIST    SETC '&KEYWORD'.'&OUTPUT2'    Set up output specification @06A 12080008
.*                                     Punch output specification  @06A 12090008
         PUNCH '               &LIST'                                   12100008
.OUT2    ANOP  ,                       Continue                    @06A 12110008
         AIF   (&OSG).OSG13                                             12120008
         PUNCH '         END'                                           12130008
.*                                                               18@L6D 12140008
.*                                                                      12150008
.********************************************************************   12160008
.*                                                                      12170008
.*  JCL FOR THE AMDSABLD STEP                                           12180008
.*                                                                      12190008
.********************************************************************   12200008
.*                                                                      12210008
.BLDSTEP ANOP  ,                       AMDSABLD STEP               @04A 12220008
         SPACE                                                          12230008
         PUNCH '/*'                                                     12240008
         PUNCH '//BUILD  EXEC PGM=AMDSABLD,'                       @04C 12250008
         PUNCH '// COND=((0,LT,ASMA)),'                            @L6C 12260008
         PUNCH '// REGION=1024K,'                                       12270008
         PUNCH '// PARM=''IPL=&IPLVAR'''                           @L3C 12280008
         AIF   ('&LNKVOL' EQ '').OSG14   IF LNKLIB ESTABLISHED     @D2A 12290008
         PUNCH '//STEPLIB DD DSN=SYS1.LINKLIB,DISP=SHR&LNKVOL&LNKUNIT' X12300008
                                                                   @D2A 12310008
         AGO   .OSG14                                                   12320008
.OSG13   ANOP  ,                                                        12330008
         PUNCH 'BLDPARMSIPL=&IPLVAR'                               @L3C 12340008
         PUNCH 'IPLUNIT &IPLUNIT'                                       12350008
         PUNCH 'IPLSER  &VOLSER'                                        12360008
         AIF   ('&NUCUNIT' EQ '').OSGNONUC If no NUCLIB            @PEA 12370008
         PUNCH 'NUCUNIT &NUCLIB(2)'                                @PEA 12380008
         PUNCH 'NUCSER  &NUCLIB(1)'                                @PEA 12390008
.OSGNONUC ANOP  ,                                                  @PEA 12400008
         AGO   .OSG15                                                   12410008
.*                                                                      12420008
.OSG14   ANOP  ,                                                        12430008
         PUNCH '//IPLDEV DD DSN=SYS1.PAGEDUMP.V&VOLSER,'           @L7C 12440008
         PUNCH '//  VOL=(PRIVATE,RETAIN,SER=&VOLSER),'                  12450008
         AIF   ('&IPLVAR' EQ 'T').TLDR                                  12460008
         PUNCH '// DCB=(LRECL=4096,BLKSIZE=4096,RECFM=F,DSORG=PS),'     12470008
         PUNCH '// UNIT=&IPLUNIT,DISP=(,KEEP),'                         12480008
         PUNCH '// SPACE=(4096,(1095),,CONTIG),LABEL=EXPDT=99366'  @L9C 12490008
         AGO   .ULBL1                                                   12500008
.TLDR    ANOP  ,                       TAPE IPL                         12510008
         PUNCH '// DCB=(BLKSIZE=12288,RECFM=U,DSORG=PS),'          @H1C 12520008
         PUNCH '// UNIT=&IPLUNIT,DISP=OLD,LABEL=(,NL)'                  12530008
         AGO   .JCLLDR3                                        @PCC1611 12540008
.*                                                                      12550008
.ULBL1   ANOP  ,                                                        12560008
         PUNCH '//TRK0TEXT DD DSN=&&REALDUMP,DISP=(,PASS),'             12570008
         PUNCH '// SPACE=(4096,(2,1)),DCB=RECFM=U,'                     12580008
.*                                                                5@PDD 12590008
         PUNCH '// UNIT=&SYSUT'                                         12600008
.JCLLDR3 ANOP  ,                                                        12610008
.*                                                                      12620008
         PUNCH '//SYSPRINT DD SYSOUT=A'                                 12630008
         PUNCH '//SYSPUNCH DD DSN=&&OBJ,DISP=(OLD,DELETE)'              12640008
         AIF   ('&IPLVAR' NE 'D').IPLTAPE  DASD IPL NEEDS AMDSAIPD @L3A 12650008
         PUNCH '//IPLTEXT DD DSN=SYS1.NUCLEUS(AMDSAIPD),'          @D2C 12660008
         PUNCH '//           DISP=SHR&NUCVOL&NUCUNIT'              @D2A 12670008
         AGO   .PUNDPL                                             @L3A 12680008
.IPLTAPE ANOP  ,                    TAPE IPL NEEDS MODULE AMDSAIPT @L3A 12690008
         PUNCH '//IPLTEXT DD DSN=SYS1.NUCLEUS(AMDSAIPT),'          @D2C 12700008
         PUNCH '//           DISP=SHR&NUCVOL&NUCUNIT'              @D2A 12710008
.PUNDPL  ANOP  ,                                                   @L3A 12720008
         PUNCH '//IPITEXT DD DSN=SYS1.NUCLEUS(AMDSAIPI),'          @L6A 12730008
         PUNCH '//           DISP=SHR&NUCVOL&NUCUNIT'              @L6A 12740008
         PUNCH '//DVITEXT DD DSN=SYS1.NUCLEUS(AMDSADVI),'          @L6A 12750008
         PUNCH '//           DISP=SHR&NUCVOL&NUCUNIT'              @L6A 12760008
         PUNCH '//DPLTEXT DD DSN=SYS1.NUCLEUS(AMDSADPL),'          @D2C 12770008
         PUNCH '//           DISP=SHR&NUCVOL&NUCUNIT'              @D2A 12780008
         PUNCH '//PGETEXT DD DSN=SYS1.NUCLEUS(AMDSAPGE),'          @D2C 12790008
         PUNCH '//           DISP=SHR&NUCVOL&NUCUNIT'              @D2A 12800008
.********************************************************************   12810008
.*                                                                      12820008
.*  THIS CODE PRODUCES UTILITY JCL AND CONTROL STATEMENTS TO PLACE      12830008
.*  THE IPL TEXT ON A DASD RESIDENCE VOLUME                             12840008
.*                                                                      12850008
.********************************************************************   12860008
.*                                                                      12870008
         SPACE                                                          12880008
         AIF   ('&IPLVAR' NE 'D').ENDUP1                                12890008
         PUNCH '//PUTIPL EXEC PGM=ICKDSF,REGION=6M,'               @PBC 12900008
         PUNCH '//   COND=((0,LT,ASMA),(0,LT,BUILD))'              @L6C 12910008
         PUNCH '//SYSPRINT DD SYSOUT=A'                                 12920008
         PUNCH '//IPLDEV DD DISP=OLD,UNIT=&IPLUNIT,'                    12930008
         PUNCH '//  VOL=(PRIVATE,RETAIN,SER=&VOLSER)'                   12940008
         PUNCH '//TRK0TEXT DD DSN=&&REALDUMP,DISP=(OLD,DELETE)'         12950008
         PUNCH '//SYSIN DD *'                                           12960008
         PUNCH ' REFORMAT DDNAME(IPLDEV) &ULABEL2 IPL(TRK0TEXT,ABS) NOVX12970008
               ERIFY + '                                           @PCC 12980008
         PUNCH '  BOOTSTRAP &IPLEXYES &LDIPLYES '                  @09C 12990008
         PUNCH '/*'                                                     13000008
         AGO   .OSG16                                                   13010008
.OSG15   ANOP  ,                                                        13020008
         PUNCH 'DSFPARMS REFORMAT DNAME(IPLDEV) &ULABEL2 IPL(TRK0TEXT,AX13030008
               BS) NOVFY + '                                       @PCC 13040008
         PUNCH 'DSFPARMS  BOOTSTRAP &IPLEXYES &LDIPLYES '          @09C 13050008
         AMDSADM2 IPL=&IPLVAR,                                         X13060008
               OUTPUT=&OUTPUT2,CONSOLE=&CON2,DUMP=&DUMP,               X13070008
               ADDSUMM=&ADDSUMM,DEBUG=&DEBUG,                          X13080008
               &PROMPT,MSG=&MSGK,MINASID=&MINTYPE,COMPACT=&COMPK,      X13090008
               REUSEDS=&REUSDS1,DDSPROMPT=&DDSPMTK,AMD029=&AMD0291,    X13100008
               REAL=&REALTYPE                                      @LCC 13110008
.OSG16   ANOP  ,                                                        13120008
.ENDUP1  ANOP  ,                       END OF PROCESSING                13130008
*********************************************************************   13140008
*                                                                       13150008
*    ASSEMBLY OF THIS MACRO HAS SUCCESSFULLY COMPLETED.                 13160008
*    THE DECK IS A JOB STREAM WHICH WHEN RUN WILL INITIALIZE            13170008
*    THE AMDSADMP RESIDENCE VOLUME.                                     13180008
*                                                                       13190008
*********************************************************************   13200008
         MEND  ,                                                        13210008
