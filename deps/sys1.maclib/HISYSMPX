*                                                                       00001000
* %DCL HISYSMPX_INCLUDED CHAR EXT;                                      00002000
* %DEACTIVATE HISYSMPX_INCLUDED;                                        00003000
* %IF HISYSMPX_INCLUDED = '' %THEN                                      00004000
* %DO;                                                                  00005000
*/* Macro made bi-lingual on 22125. CBGEN compile date 21138         */ 00006000
*% /*                                                                   00007000
         MACRO                                                          00008000
         HISYSMPX &DSECT=YES,&LIST=YES,&TITLE=YES,&HisSmpParm=YES,     *00009000
               &HisSDB_Trailer=COND,&HisSmp_GenericEntry=COND,         *00010000
               &HisSmp_Basic1Entry=COND                                 00011000
                      GBLC  &HISYSMPX_INCLUDED                          00012000
                      GBLC  &ZCBPRINT                                   00013000
&HISYSMPX_INCLUDED    SETC  'YES'                                       00014000
                      AIF   ('&LIST' EQ 'NONE').P0                      00015000
                      AIF   ('&TITLE' EQ 'NO').P5                       00016000
 TITLE                'HISYSMPX  - HIS Sampling Exit Interface         *00017000
                           '                                            00018000
.P5                   ANOP                                              00019000
**/ ;                                                                   00020000
*/****START OF SPECIFICATIONS****************************************** 00021000
*                                                                       00022000
*01* MACRO NAME: HISYSMPX                                               00023000
*                                                                       00024000
*01* DESCRIPTIVE NAME: HIS Sampling Exit Interface                      00025000
*02*  ACRONYM: N/A                                                      00026000
*                                                                       00027000
*01* PROPRIETARY STATEMENT=                                           * 00028000
***PROPRIETARY_STATEMENT*********************************************** 00029000
*                                                                     * 00030000
*   LICENSED MATERIALS - PROPERTY OF IBM                              * 00031000
*   5650-ZOS COPYRIGHT IBM CORP. 2013, 2017                           * 00032000
*                                                                     * 00033000
*   STATUS= HBB77B0                                                   * 00034000
*                                                                     * 00035000
***END_OF_PROPRIETARY_STATEMENT**************************************** 00036000
*                                                                       00037000
*01* EXTERNAL CLASSIFICATION:  PI                                       00038000
*01* END OF EXTERNAL CLASSIFICATION:                                    00039000
*                                                                       00040000
*01* DSECT NAME:                                                        00041000
*        HisSmpParm                                                     00042000
*        HisSDB_Trailer                                                 00043000
*        HisSmp_GenericEntry                                            00044000
*        HisSmp_Basic1Entry                                             00045000
*                                                                       00046000
*01* COMPONENT: Hardware Instrumentation Services (SCHIS)               00047000
*                                                                       00048000
*01* EYE-CATCHER:                                                       00049000
*        HisSmpParm          -- NONE                                    00050000
*        HisSDB_Trailer      -- NONE                                    00051000
*        HisSmp_GenericEntry -- NONE                                    00052000
*        HisSmp_Basic1Entry  -- NONE                                    00053000
*02*  OFFSET:  NONE                                                     00054000
*02*  LENGTH:  NONE                                                     00055000
*                                                                       00056000
*01* FUNCTION: Maps the parameter area and associated areas passed      00057000
*              into the HISSERV exit routine when the reason the        00058000
*              exit routine is called is to handle a sampling exit      00059000
*              callback.                                                00060000
*                                                                       00061000
*01* METHOD OF ACCESS:                                                  00062000
*                                                                       00063000
*02*   PL/X:                                                            00064000
*        %INCLUDE SYSLIB(HISYSMPX)                                      00065000
*                                                                       00066000
*02*   ASM:                                                             00067000
*        HISYSMPX                                                       00068000
*    DSECT=YES!NO                    -- Request DSECT definition        00069000
*    HISSMPPARM=YES!NO!COND          -- Request HisSmpParm mapping      00070000
*    HISSDB_TRAILER=YES!NO!COND      -- HisSdb_Trailer mapping          00071000
*    HISSMP_GENERICENTRY=YES!NO!COND -- HisSmp_GenericEntry mapping     00072000
*    HISSMP_BASIC1ENTRY=YES!NO!COND  -- HisSmp_Basic1Entry mapping      00073000
*                                                                       00074000
*     Default: DSECT=YES,HISSMPPARM=YES,                                00075000
*                HISSDB_TRAILER=COND,HISSMP_GENERICENTRY=COND,          00076000
*                HISSMP_BASIC1ENTRY=COND                                00077000
*     Notes: name=YES  => expand                                        00078000
*            name=NO   => do not expand                                 00079000
*            name=COND => expand only if DSECT=YES                      00080000
*                                                                       00081000
*01* SIZE:                                                              00082000
*        HisSmpParm          -- X'0020' bytes                           00083000
*        HisSDB_Trailer      -- X'0040' bytes                           00084000
*        HisSmp_GenericEntry -- X'0004' bytes                           00085000
*        HisSmp_Basic1Entry  -- X'0020' bytes                           00086000
*                                                                       00087000
*01* POINTED TO BY:                                                     00088000
*        HisSmpParm          -- Register 1 on entry to the exit routine 00089000
*        HisSDB_Trailer      -- Trailer of each SDB (no explicit ptr)   00090000
*        HisSmp_GenericEntry -- Entry within SDB (no explicit ptr)      00091000
*        HisSmp_Basic1Entry  -- Entry within SDB (no explicit ptr)      00092000
*                                                                       00093000
*01* CREATED BY: Caller                                                 00094000
*                                                                       00095000
*01* DELETED BY: Caller                                                 00096000
*                                                                       00097000
*    HisSmpParm                                                         00098000
*01* STORAGE ATTRIBUTES:                                                00099000
*02*   SUBPOOL:   230 (HIS Private)                                     00100000
*02*   KEY:       0                                                     00101000
*02*   RESIDENCY: Above 16M line                                        00102000
*                                                                       00103000
*    HisSDB_Trailer/HisSmp_GenericEntry/HisSmp_Basic1Entry              00104000
*01* STORAGE ATTRIBUTES:                                                00105000
*02*   ATTRIBUTES: HIS Private Fixed, can be above 2G                   00106000
*02*   KEY:        0                                                    00107000
*02*   RESIDENCY:  Above 16M line                                       00108000
*                                                                       00109000
*01* FREQUENCY:  Created for call to exit routine                       00110000
*                                                                       00111000
*01* SERIALIZATION:  None                                               00112000
*                                                                       00113000
*01* DEPENDENCIES:   None                                               00114000
*                                                                       00115000
*01* NOTES:                                                             00116000
*       o The SDBs should should be treated as read only storage, an    00117000
*         exit routine should not write into an SDB.                    00118000
*                                                                       00119000
*01* DISTRIBUTION LIBRARY:  AMACLIB                                     00120000
*                                                                       00121000
*01* EYE-CATCHER:    N/A                                                00122000
*                                                                       00123000
*01* CHANGE-ACTIVITY:                                                   00124000
*                                                                       00125000
* $L0=HISSERV HBB7790 110110 PDBS: HIS Extendability                    00126000
* $L1=HDEXT   HBB77B0 170224 PDNJ: HIS changes                          00127000
* $01=OA55887 HBB77A0 180904 PDNJ: HisSmpEntryFormat_kDiag5             00128000
* $02=OA60036 HBB77B0 220308 PDNJ: HisSmpEntryFormat_kDiag7             00129000
*                                                                       00130000
****END OF SPECIFICATIONS*********************************************/ 00131000
*% /*                                                                   00132000
.P0                   ANOP                                              00133000
                      AIF   ('&ZCBPRINT' EQ 'NO').P1                    00134000
                      AIF   ('&LIST' EQ 'YES').P2                       00135000
.P1                   ANOP                                              00136000
                      PUSH  PRINT                                       00137000
                      PRINT OFF                                         00138000
.P2                   ANOP                                              00139000
                      AIF   ('&HisSmpParm' EQ 'NO').L0002               00140000
                      AIF   ('&DSECT' EQ 'YES').L0003                   00141000
                      AIF   ('&HisSmpParm' NE 'YES').L0002              00142000
.L0003                ANOP                                              00143000
*                                                                       00144000
* ********************************************************************  00145000
* * The Sampling Exit Function Code Parameter Area                   *  00146000
* *   When HisExitParm_Func is HisExitParmFunc_kSmp, this mapping    *  00147000
* *   should be used to map the entire parameter area.               *  00148000
* *                                                                  *  00149000
* *   A Sampling Data Block (SDB) is a set of contiguous sampling    *  00150000
* *   entries. This exit provides a group of SDBs that are ready to  *  00151000
* *   be processed.  Every SDB is of the length contained in field   *  00152000
* *   HisSmpParm_SDBLength, and the SDBs are contiguous in storage,  *  00153000
* *   the first at the address contained in HisSmpParm_FirstSDBAddr  *  00154000
* *   and the last at the address contained in                       *  00155000
* *   HisSmpParm_LastSDBAddr. An SDB begins with a sampling entry.   *  00156000
* *   The sampling entries within an SDB can be of different types   *  00157000
* *   and lengths. To identify the sampling entry, use the generic   *  00158000
* *   sample entry mapping (HisGenericSmpEntry) to obtain the entry  *  00159000
* *   format code (HisSmpGenericEntry_Format). Once the entry is     *  00160000
* *   identified, use the appropriate mapping to process the entry.  *  00161000
* *   To get to the next entry, use the HisSmpEntryFormat* constants *  00162000
* *   to match a format code with its length. If the format is       *  00163000
* *   HisSmpEntryFormat_kNone there are no more sampling entries in  *  00164000
* *   the SDB.                                                       *  00165000
* *                                                                  *  00166000
* *   The last bytes of each SDB makes up the trailer, mapped by     *  00167000
* *   HisSDB_Trailer. The trailer always resides at                  *  00168000
* *   (Addr(SDB)+HisSmpParm_SDBLength)-HisSDBTrailer_kLength. This   *  00169000
* *   means that it is possible for there to be unused space between *  00170000
* *   the last sampling entry and the trailer entry. Therefore, you  *  00171000
* *   are at the end of an SDB when either the                       *  00172000
* *   HisSmpGenericEntry_Format is HisSmpEntryFormat_kNone or the    *  00173000
* *   next sampling entry is within the address range of the trailer.*  00174000
* *                                                                  *  00175000
* *   Note that the SDBs are specific to a single CPU. The exit      *  00176000
* *   routine is called by the same task for a given CPU's sampling  *  00177000
* *   data. This means that any resources obtained by an exit routine*  00178000
* *   for a particular CPU can persist to subsequent sampling        *  00179000
* *   callbacks for that CPU.                                        *  00180000
* *                                                                  *  00181000
* ********************************************************************  00182000
*                                                                       00183000
*                                                                       00184000
                      AIF   ('&DSECT' EQ 'YES').L0004                   00185000
HisSmpParm            DS    0D                                          00186000
                      AGO   .L0005                                      00187000
.L0004                ANOP                                              00188000
HisSmpParm            DSECT                                             00189000
.L0005                ANOP                                              00190000
HisSmpParm_Info       DS    CL4    The common portion of the exit      *00191000
                                   routine parameter area, mapped by   *00192000
                                   DSECT HisExitParm in macro          *00193000
                                   HISYEXIT.                            00194000
HisSmpParm_ServiceSeq DS    F      The sequence number representing    *00195000
                                   the sampling state of the service   *00196000
                                   for when this data was provided.     00197000
HisSmpParm_CpuId      DS    H      The CPU ID these SDBs were filled   *00198000
                                   by                                   00199000
HisSmpParm_Flgs       DS    BL2                                         00200000
*  Bit definitions:                                                     00201000
HisSmpParmFlgs_Last   EQU   X'80'  This is the last sample exit that   *00202000
                                   will be received from this CPU,     *00203000
                                   either because a HISSERV            *00204000
                                   REQUEST=PROFILE,ACTION=STOP request *00205000
                                   was made or the service is updating *00206000
                                   or is disabling. If the service is  *00207000
                                   updating, sample exit callbacks     *00208000
                                   will resume once the update has     *00209000
                                   completed.                           00210000
HisSmpParm_SDBLength  DS    F      The size of each SDB                 00211000
HisSmpParm_FirstSDBAddr DS  AD     The address of the first SDB to be  *00212000
                                   processed, if zero there are no     *00213000
                                   SDBS to process.                     00214000
HisSmpParm_LastSDBAddr DS   AD     The address of the last SDB to be   *00215000
                                   processed, will be greater or equal *00216000
                                   to HisSmpParm_FirstSDBAddr           00217000
HisSmpParm_End        DS    0C                                          00218000
HisSmpParm_kVersionMax EQU  1                                           00219000
HisSmpParm_kVersion1  EQU   1                                           00220000
HisSmpParm_kVersionMin EQU  1                                           00221000
HisSmpParm_Len        EQU   *-HisSmpParm                                00222000
.L0002                ANOP                                              00223000
                      AIF   ('&HisSDB_Trailer' EQ 'NO').L0006           00224000
                      AIF   ('&DSECT' EQ 'YES').L0007                   00225000
                      AIF   ('&HisSDB_Trailer' NE 'YES').L0006          00226000
.L0007                ANOP                                              00227000
*                                                                       00228000
* ********************************************************************  00229000
* * The trailer entry for each SDB gives information about the SDB,  *  00230000
* * it is always located at the end of each SDB regardless of the    *  00231000
* * end of the previous sampling entry (for a given SDB, the trailer *  00232000
* * is located at SDB+HisSmpParm_SDBLength-HisSDBTrailer_kLength).   *  00233000
* ********************************************************************  00234000
*                                                                       00235000
*                                                                       00236000
                      AIF   ('&DSECT' EQ 'YES').L0008                   00237000
HisSDB_Trailer        DS    0D                                          00238000
                      AGO   .L0009                                      00239000
.L0008                ANOP                                              00240000
HisSDB_Trailer        DSECT                                             00241000
.L0009                ANOP                                              00242000
HisSDBTrailer0_15     DS    CL16                                        00243000
                      ORG   HisSDBTrailer0_15                           00244000
HisSDBTrailer_Ctl     DS    CL1                                         00245000
*  Bit definitions:                                                     00246000
HisSDBTrailer_Full    EQU   X'80'  Block full indicator                 00247000
HisSDBTrailer_FullTODAsSTCKE EQU X'20' Timestamp format, when ON,      *00248000
                                   HisSDBTrailer_FullTOD contains the  *00249000
                                   full timestamp in STCKE format.     *00250000
                                   When OFF, HisSDBTrailer_FullTOD_Low *00251000
                                   contains the full timestamp in STCK *00252000
                                   format.                              00253000
                      DS    CL3                                         00254000
HisSDBTrailer_BSDES   DS    H      Basic sample data entry size in     *00255000
                                   bytes                                00256000
HisSDBTrailer_DSDES   DS    H      Diagnostic sampling data entry size *00257000
                                   in bytes                             00258000
HisSDBTrailer_OverflowCount DS FL8 Number of sampling entries written  *00259000
                                   into this SDB when the SDB is       *00260000
                                   already indicated as full           *00261000
                                   (HisSDBTrailer_Full is one)          00262000
HisSDBTrailer_FullTOD DS    CL16   The TOD clock value at the time the *00263000
                                   SDB became full, in STCKE format.   *00264000
                                   Use when                            *00265000
                                   HisSDBTrailer_FullTODAsSTCKE is on   00266000
                      ORG   HisSDBTrailer_FullTOD                       00267000
HisSDBTrailer_FullTOD_High DS CL8                                       00268000
HisSDBTrailer_FullTOD_Low DS CL8   The TOD clock value at the time the *00269000
                                   SDB became full, in STCK format.    *00270000
                                   Use when                            *00271000
                                   HisSDBTrailer_FullTODAsSTCKE is off  00272000
                      DS    CL16                                        00273000
HisSDBTrailer_UserArea DS   CL16   User control area used by the       *00274000
                                   service                              00275000
                      ORG   HisSDBTrailer_UserArea                      00276000
HisSDBTrailerUser_VirtBufPtr DS AD Virtual address of the SDB this     *00277000
                                   trailer is a part of                 00278000
                      ORG   HisSDBTrailer_UserArea+16                   00279000
HisSDBTrailer_End     DS    0C                                          00280000
HisSDBTrailer_kLength EQU   64                                          00281000
HisSDB_Trailer_Len    EQU   *-HisSDB_Trailer                            00282000
.L0006                ANOP                                              00283000
                      AIF   ('&HisSmp_GenericEntry' EQ 'NO').L000A      00284000
                      AIF   ('&DSECT' EQ 'YES').L000B                   00285000
                      AIF   ('&HisSmp_GenericEntry' NE 'YES').L000A     00286000
.L000B                ANOP                                              00287000
*                                                                       00288000
* ********************************************************************  00289000
* * The generic sample entry within an SDB. This can be used to      *  00290000
* * determine what type of sampling entry is currently being looked  *  00291000
* * at, whether it is valid, and where the next sample entry         *  00292000
* * begins.  To figure out where the next sample entry begins,       *  00293000
* * use the HisSmpEntryFormat* constants to match a format code to   *  00294000
* * its associated length. If the format code is unknown, runtime    *  00295000
* * lengths provided as part of the ANSAREA for a HISSERV            *  00296000
* * REQUEST=QUERY,TYPE=SAMPLE should be used.                        *  00297000
* *                                                                  *  00298000
* * The number of sampling entries in an SDB depends on the size of  *  00299000
* * the SDB (given in HisSmpParm_SDBLength). Note, the end of every  *  00300000
* * SDB is a trailer entry mapped by HisSDB_Trailer. If the sampling *  00301000
* * entries do not fit perfectly in the SDB there will be unused     *  00302000
* * space between the last full sampling entry and the SDB's         *  00303000
* * trailer. In that case, the next sample entry will have a format  *  00304000
* * code of HisSmpEntryFormat_kNone.                                 *  00305000
* ********************************************************************  00306000
*                                                                       00307000
*                                                                       00308000
                      AIF   ('&DSECT' EQ 'YES').L000C                   00309000
HisSmp_GenericEntry   DS    0F                                          00310000
                      AGO   .L000D                                      00311000
.L000C                ANOP                                              00312000
HisSmp_GenericEntry   DSECT                                             00313000
.L000D                ANOP                                              00314000
HisSmpGenericEntry_Format DS CL2   The type of sampling entry being    *00315000
                                   looked at. Can be one of the the    *00316000
                                   HisSmpEntryFormat* equates.          00317000
HisSmpGenericEntry_Ctl DS   CL2                                         00318000
                      ORG   HisSmpGenericEntry_Ctl                      00319000
HisSmpGenericEntryCtl_Byte0 DS B                                        00320000
HisSmpGenericEntryCtl_Byte1 DS B                                        00321000
*  Bit definitions:                                                     00322000
HisSmpGenericEntry_Invalid EQU X'01' Whether this sampling entry is    *00323000
                                   invalid.                             00324000
                      ORG   HisSmpGenericEntry_Ctl+2                    00325000
HisSmpGenericEntry_End DS   0C                                          00326000
HisSmpEntryFormat_kNone EQU X'0000'                                     00327000
HisSmpEntryFormat_kDiag1 EQU X'8001'                                    00328000
HisSmpEntryFormat_kDiag2 EQU X'8002'                                    00329000
HisSmpEntryFormat_kDiag3 EQU X'8003'                                    00330000
HisSmpEntryFormat_kDiag4 EQU X'8004'                                    00331000
HisSmpEntryFormat_kDiag5 EQU X'8005'                                    00332000
HisSmpEntryFormat_kDiag6 EQU X'8006'                                    00333000
HisSmpEntryFormat_kDiag7 EQU X'8007'                                    00334000
HisSmpEntryLength_kDiag1 EQU 64                                         00335000
HisSmpEntryLength_kDiag2 EQU 74                                         00336000
HisSmpEntryLength_kDiag3 EQU 85                                         00337000
HisSmpEntryLength_kDiag4 EQU 112                                        00338000
HisSmpEntryLength_kDiag5 EQU 159                                        00339000
HisSmpEntryLength_kDiag6 EQU 165                                        00340000
HisSmpEntryLength_kDiag7 EQU 173                                        00341000
HisSmp_GenericEntry_Len EQU *-HisSmp_GenericEntry                       00342000
.L000A                ANOP                                              00343000
                      AIF   ('&HisSmp_Basic1Entry' EQ 'NO').L000E       00344000
                      AIF   ('&DSECT' EQ 'YES').L000F                   00345000
                      AIF   ('&HisSmp_Basic1Entry' NE 'YES').L000E      00346000
.L000F                ANOP                                              00347000
*                                                                       00348000
* ********************************************************************  00349000
* * The basic sample entry within an SDB. Note, for z/OS the         *  00350000
* * program parameter is mapped by macro IHAPPR.                     *  00351000
* ********************************************************************  00352000
*                                                                       00353000
*                                                                       00354000
                      AIF   ('&DSECT' EQ 'YES').L0010                   00355000
HisSmp_Basic1Entry    DS    0D                                          00356000
                      AGO   .L0011                                      00357000
.L0010                ANOP                                              00358000
HisSmp_Basic1Entry    DSECT                                             00359000
.L0011                ANOP                                              00360000
HisSmpBasic1Entry_Format DS CL2    Format code of the data entry,      *00361000
                                   should be equal to                  *00362000
                                   HisSmpEntryFormat_kBasic1            00363000
HisSmpBasic1Entry_State1 DS CL1                                         00364000
*  Bit definitions:                                                     00365000
HisSmpBasic1Entry_UniqueInstr EQU X'0F' The number of unique           *00366000
                                   instructions simultaneously         *00367000
                                   executing during this sample.        00368000
HisSmpBasic1Entry_State2 DS CL1                                         00369000
*  Bit definitions:                                                     00370000
HisSmpBasic1Entry_DAT EQU   X'20'  DAT mode bit of PSW                  00371000
HisSmpBasic1Entry_Wait EQU  X'10'  Wait state bit of PSW                00372000
HisSmpBasic1Entry_Problem EQU X'08' Problem state bit of PSW            00373000
HisSmpBasic1Entry_ASC EQU   X'06'  Address-space control of PSW         00374000
HisSmpBasic1Entry_Invalid EQU X'01' Indicates entry is invalid          00375000
HisSmpBasic1Entry_State3 DS CL1                                         00376000
*  Bit definitions:                                                     00377000
HisSmpBasic1Entry_ConfigLevel EQU X'C0' Configuration Level of the CPU *00378000
                                   during sample cycle. '10'b          *00379000
                                   indicates virtual machine level     *00380000
                                   '01'b indicates LPAR (logical       *00381000
                                   partition) level '00'b and '11'b    *00382000
                                   are reserved                         00383000
HisSmpBasic1Entry_IsHost EQU X'20' Host Indicator - On when the        *00384000
                                   basic-sampling data entry (BSDE) is *00385000
                                   stored to sample-data blocks (SDB)  *00386000
                                   established by a control program    *00387000
                                   run at the logical partition level. *00388000
                                   Value is not meaningful when        *00389000
                                   HisSmpBasic1Entry_ConfigLevel is    *00390000
                                   '00'b                                00391000
                      DS    CL1                                         00392000
HisSmpBasic1Entry_PASN DS   H      Primary ASN from control register 4  00393000
HisSmpBasic1Entry_InstrAddr DS AD  The address of the instruction      *00394000
                                   being executed.                      00395000
HisSmpBasic1Entry_GPP DS    CL8    The program parameter most recently *00396000
                                   set by the CPU at the virtual       *00397000
                                   machine level (the guest OS).        00398000
HisSmpBasic1Entry_HPP DS    CL8    The program parameter most recently *00399000
                                   set by the CPU at the logical       *00400000
                                   partition level (the host OS).       00401000
HisSmpBasic1Entry_End DS    0C                                          00402000
HisSmpEntryFormat_kBasic1 EQU X'0001'                                   00403000
HisSmpEntryLength_kBasic1 EQU 32                                        00404000
HisSmp_Basic1Entry_Len EQU  *-HisSmp_Basic1Entry                        00405000
.L000E                ANOP                                              00406000
                      AIF   ('&ZCBPRINT' EQ 'NO').P3                    00407000
                      AIF   ('&LIST' EQ 'YES').P4                       00408000
.P3                   ANOP                                              00409000
                      POP   PRINT                                       00410000
.P4                   ANOP                                              00411000
.P_EXIT               ANOP                                              00412000
                      MEND                                              00413000
**/ ;                                                                   00414000
* %HISYSMPX_INCLUDED = 'YES';                                           00415000
* %DCL ZCBPRINT CHAR EXT;                                               00416000
* %DEACTIVATE ZCBPRINT;                                                 00417000
* %DCL HISYSMPX_LIST CHAR EXT;                                          00418000
* %DEACTIVATE HISYSMPX_LIST;                                            00419000
* %IF HISYSMPX_LIST = 'NO' !                                            00420000
*    ZCBPRINT = 'NO' %THEN                                              00421000
* %DO;                                                                  00422000
*   @LIST PUSH NOECHO;                                                  00423000
*   @LIST NOASSEMBLE NOECHO;                                            00424000
*   @LIST OFF C NOECHO;                                                 00425000
* %END;                                                                 00426000
*/* Start of PL/X Source                                             */ 00427000
*                                                                       00428000
*?ASAADMAC Name(HISYEXIT) ListOpt(COND);                                00429000
*?ASAADMAC Name(HISYSERV) ListOpt(COND);                                00430000
*                                                                       00431000
*/********************************************************************/ 00432000
*/* The Sampling Exit Function Code Parameter Area                   */ 00433000
*/*   When HisExitParm_Func is HisExitParmFunc_kSmp, this mapping    */ 00434000
*/*   should be used to map the entire parameter area.               */ 00435000
*/*                                                                  */ 00436000
*/*   A Sampling Data Block (SDB) is a set of contiguous sampling    */ 00437000
*/*   entries. This exit provides a group of SDBs that are ready to  */ 00438000
*/*   be processed.  Every SDB is of the length contained in field   */ 00439000
*/*   HisSmpParm_SDBLength, and the SDBs are contiguous in storage,  */ 00440000
*/*   the first at the address contained in HisSmpParm_FirstSDBAddr  */ 00441000
*/*   and the last at the address contained in                       */ 00442000
*/*   HisSmpParm_LastSDBAddr. An SDB begins with a sampling entry.   */ 00443000
*/*   The sampling entries within an SDB can be of different types   */ 00444000
*/*   and lengths. To identify the sampling entry, use the generic   */ 00445000
*/*   sample entry mapping (HisGenericSmpEntry) to obtain the entry  */ 00446000
*/*   format code (HisSmpGenericEntry_Format). Once the entry is     */ 00447000
*/*   identified, use the appropriate mapping to process the entry.  */ 00448000
*/*   To get to the next entry, use the HisSmpEntryFormat* constants */ 00449000
*/*   to match a format code with its length. If the format is       */ 00450000
*/*   HisSmpEntryFormat_kNone there are no more sampling entries in  */ 00451000
*/*   the SDB.                                                       */ 00452000
*/*                                                                  */ 00453000
*/*   The last bytes of each SDB makes up the trailer, mapped by     */ 00454000
*/*   HisSDB_Trailer. The trailer always resides at                  */ 00455000
*/*   (Addr(SDB)+HisSmpParm_SDBLength)-HisSDBTrailer_kLength. This   */ 00456000
*/*   means that it is possible for there to be unused space between */ 00457000
*/*   the last sampling entry and the trailer entry. Therefore, you  */ 00458000
*/*   are at the end of an SDB when either the                       */ 00459000
*/*   HisSmpGenericEntry_Format is HisSmpEntryFormat_kNone or the    */ 00460000
*/*   next sampling entry is within the address range of the trailer.*/ 00461000
*/*                                                                  */ 00462000
*/*   Note that the SDBs are specific to a single CPU. The exit      */ 00463000
*/*   routine is called by the same task for a given CPU's sampling  */ 00464000
*/*   data. This means that any resources obtained by an exit routine*/ 00465000
*/*   for a particular CPU can persist to subsequent sampling        */ 00466000
*/*   callbacks for that CPU.                                        */ 00467000
*/*                                                                  */ 00468000
*/********************************************************************/ 00469000
*Dcl                                                                    00470000
* 1 HisSmpParm Bdy(Dword) Type                                          00471000
*  ,3 HisSmpParm_Info Char(Size(HisExitParm)) Bdy(Dword) /* The common  00472000
*                        portion of the exit routine parameter area,    00473000
*                        mapped by DSECT HisExitParm in macro HISYEXIT. 00474000
*                                                                    */ 00475000
*    ,5 HisSmpParm_Info_IsA IsA(HisExitParm)                            00476000
*  ,3 HisSmpParm_ServiceSeq Fixed(32) /* The sequence number            00477000
*                        representing the sampling state of the service 00478000
*                        for when this data was provided.            */ 00479000
*  ,3 HisSmpParm_CpuId     Fixed(16) /* The CPU ID these SDBs were      00480000
*                        filled by                                   */ 00481000
*  ,3 HisSmpParm_Flgs Bit(16)                                           00482000
*    ,5 HisSmpParmFlgs_Last Bit(1) /* This is the last sample exit      00483000
*                        that will be received from this CPU, either    00484000
*                        because a HISSERV REQUEST=PROFILE,ACTION=STOP  00485000
*                        request was made or the service is updating    00486000
*                        or is disabling. If the service is updating,   00487000
*                        sample exit callbacks will resume once the     00488000
*                        update has completed.                       */ 00489000
*  ,3 HisSmpParm_SDBLength Fixed(31) /* The size of each SDB         */ 00490000
*  ,3 HisSmpParm_FirstSDBAddr Ptr(64) /* The address of the first SDB   00491000
*                        to be processed, if zero there are no SDBS to  00492000
*                        process.                                    */ 00493000
*  ,3 HisSmpParm_LastSDBAddr Ptr(64) /* The address of the last SDB     00494000
*                        to be processed, will be greater or equal to   00495000
*                        HisSmpParm_FirstSDBAddr                     */ 00496000
*  ,3 HisSmpParm_End Char(0) Bdy(Dword);                                00497000
*                                                                       00498000
*Dcl HisSmpParm_kVersionMax Fixed(16) Constant(HisSmpParm_kVersion1);   00499000
*Dcl HisSmpParm_kVersion1   Fixed(16) Constant(1);                      00500000
*Dcl HisSmpParm_kVersionMin Fixed(16) Constant(HisSmpParm_kVersion1);   00501000
*                                                                       00502000
*/********************************************************************/ 00503000
*/* The trailer entry for each SDB gives information about the SDB,  */ 00504000
*/* it is always located at the end of each SDB regardless of the    */ 00505000
*/* end of the previous sampling entry (for a given SDB, the trailer */ 00506000
*/* is located at SDB+HisSmpParm_SDBLength-HisSDBTrailer_kLength).   */ 00507000
*/********************************************************************/ 00508000
*Dcl                                                                    00509000
* 1 HisSDB_Trailer Bdy(Qword) Type                                      00510000
*  ,3 HisSDBTrailer0_15 Char(16) Bdy(Qword)                             00511000
*    ,5 HisSDBTrailer_Ctl Char(1)                                       00512000
*      ,7 HisSDBTrailer_Full  Bit(1) /* Block full indicator         */ 00513000
*      ,7 HisSDBTrailer_Alert Bit(1) /* Alert request indicator, for    00514000
*                        IBM use only                                */ 00515000
*      ,7 HisSDBTrailer_FullTODAsSTCKE Bit(1) /* Timestamp format,      00516000
*                        when ON, HisSDBTrailer_FullTOD contains        00517000
*                        the full timestamp in STCKE format. When OFF,  00518000
*                        HisSDBTrailer_FullTOD_Low contains the full    00519000
*                        timestamp in STCK format.                   */ 00520000
*    ,5 * Char(3)                                             /* @L1C*/ 00521000
*    ,5 HisSDBTrailer_BSDES Fixed(16) /* Basic sample data entry size   00522000
*                        in bytes                                @L1A*/ 00523000
*    ,5 HisSDBTrailer_DSDES Fixed(16) /* Diagnostic sampling data entry 00524000
*                        size in bytes                           @L1A*/ 00525000
*    ,5 HisSDBTrailer_OverflowCount Fixed(64) /* Number of sampling     00526000
*                        entries written into this SDB when the SDB is  00527000
*                        already indicated as full (HisSDBTrailer_Full  00528000
*                        is one)                                     */ 00529000
*  ,3 HisSDBTrailer_FullTOD Char(16) /* The TOD clock value at the      00530000
*                        time the SDB became full, in STCKE format.     00531000
*                        Use when HisSDBTrailer_FullTODAsSTCKE is on */ 00532000
*    ,5 HisSDBTrailer_FullTOD_High Char(8)                              00533000
*    ,5 HisSDBTrailer_FullTOD_Low  Char(8) /* The TOD clock value at    00534000
*                        the time the SDB became full, in STCK format.  00535000
*                        Use when HisSDBTrailer_FullTODAsSTCKE is off*/ 00536000
*  ,3 * Char(16)                                                        00537000
*  ,3 HisSDBTrailer_UserArea Char(16) Bdy(Dword) /* User control area   00538000
*                        used by the service                         */ 00539000
*    ,5 HisSDBTrailerUser_VirtBufPtr Ptr(64) /* Virtual address of the  00540000
*                        SDB this trailer is a part of               */ 00541000
*  ,3 HisSDBTrailer_End Char(0) Bdy(Qword);                             00542000
*                                                                       00543000
*Dcl HisSDBTrailer_kLength Fixed(16) Constant(Length(HisSDB_Trailer));  00544000
*                                                                       00545000
*/********************************************************************/ 00546000
*/* The generic sample entry within an SDB. This can be used to      */ 00547000
*/* determine what type of sampling entry is currently being looked  */ 00548000
*/* at, whether it is valid, and where the next sample entry         */ 00549000
*/* begins.  To figure out where the next sample entry begins,       */ 00550000
*/* use the HisSmpEntryFormat* constants to match a format code to   */ 00551000
*/* its associated length. If the format code is unknown, runtime    */ 00552000
*/* lengths provided as part of the ANSAREA for a HISSERV            */ 00553000
*/* REQUEST=QUERY,TYPE=SAMPLE should be used.                        */ 00554000
*/*                                                                  */ 00555000
*/* The number of sampling entries in an SDB depends on the size of  */ 00556000
*/* the SDB (given in HisSmpParm_SDBLength). Note, the end of every  */ 00557000
*/* SDB is a trailer entry mapped by HisSDB_Trailer. If the sampling */ 00558000
*/* entries do not fit perfectly in the SDB there will be unused     */ 00559000
*/* space between the last full sampling entry and the SDB's         */ 00560000
*/* trailer. In that case, the next sample entry will have a format  */ 00561000
*/* code of HisSmpEntryFormat_kNone.                                 */ 00562000
*/********************************************************************/ 00563000
*Dcl                                                                    00564000
* 1 HisSmp_GenericEntry Bdy(Word) Type                                  00565000
*  ,3 HisSmpGenericEntry_Format Char(2) /* The type of sampling entry   00566000
*                        being looked at. Can be one of the             00567000
*                        the HisSmpEntryFormat* equates.             */ 00568000
*  ,3 HisSmpGenericEntry_Ctl Char(2)                                    00569000
*    ,5 HisSmpGenericEntryCtl_Byte0 Bit(8)                              00570000
*    ,5 HisSmpGenericEntryCtl_Byte1 Bit(8)                              00571000
*      ,7 * Bit(7)                                                      00572000
*      ,7 HisSmpGenericEntry_Invalid Bit(1) /* Whether this sampling    00573000
*                        entry is invalid.                           */ 00574000
*  ,3 HisSmpGenericEntry_End Char(0);                                   00575000
*                                                                       00576000
*Dcl HisSmpEntryFormat_kNone  Bit(16)   Constant('0000'X);              00577000
*Dcl HisSmpEntryFormat_kDiag1 Bit(16)   Constant('8001'X);              00578000
*Dcl HisSmpEntryFormat_kDiag2 Bit(16)   Constant('8002'X);              00579000
*Dcl HisSmpEntryFormat_kDiag3 Bit(16)   Constant('8003'X);    /* @L1A*/ 00580000
*Dcl HisSmpEntryFormat_kDiag4 Bit(16)   Constant('8004'X);    /* @L1A*/ 00581000
*Dcl HisSmpEntryFormat_kDiag5 Bit(16)   Constant('8005'X);    /* @01A*/ 00582000
*Dcl HisSmpEntryFormat_kDiag6 Bit(16)   Constant('8006'X);    /* @01A*/ 00583000
*Dcl HisSmpEntryFormat_kDiag7 Bit(16)   Constant('8007'X);    /* @02A*/ 00584000
*                                                                       00585000
*Dcl HisSmpEntryLength_kDiag1 Fixed(31) Constant(64);                   00586000
*Dcl HisSmpEntryLength_kDiag2 Fixed(31) Constant(74);                   00587000
*Dcl HisSmpEntryLength_kDiag3 Fixed(31) Constant(85);         /* @L1A*/ 00588000
*Dcl HisSmpEntryLength_kDiag4 Fixed(31) Constant(112);        /* @L1A*/ 00589000
*Dcl HisSmpEntryLength_kDiag5 Fixed(31) Constant(159);        /* @01A*/ 00590000
*Dcl HisSmpEntryLength_kDiag6 Fixed(31) Constant(165);        /* @01A*/ 00591000
*Dcl HisSmpEntryLength_kDiag7 Fixed(31) Constant(173);        /* @02A*/ 00592000
*                                                                       00593000
*/********************************************************************/ 00594000
*/* The basic sample entry within an SDB. Note, for z/OS the         */ 00595000
*/* program parameter is mapped by macro IHAPPR.                     */ 00596000
*/********************************************************************/ 00597000
*Dcl                                                                    00598000
* 1 HisSmp_Basic1Entry Bdy(Dword) Type                                  00599000
*  ,3 HisSmpBasic1Entry_Format Char(2) /* Format code of the data       00600000
*                        entry, should be equal to                      00601000
*                        HisSmpEntryFormat_kBasic1                   */ 00602000
*  ,3 HisSmpBasic1Entry_State1 Char(1)                                  00603000
*    ,5 * Bit(4)                                                        00604000
*    ,5 HisSmpBasic1Entry_UniqueInstr Bit(4) /* The number of unique    00605000
*                        instructions simultaneously executing during   00606000
*                        this sample.                                */ 00607000
*  ,3 HisSmpBasic1Entry_State2 Char(1)                                  00608000
*    ,5 * Bit(2)                                                        00609000
*    ,5 HisSmpBasic1Entry_DAT     Bit(1) /* DAT mode bit of PSW      */ 00610000
*    ,5 HisSmpBasic1Entry_Wait    Bit(1) /* Wait state bit of PSW    */ 00611000
*    ,5 HisSmpBasic1Entry_Problem Bit(1) /* Problem state bit of PSW */ 00612000
*    ,5 HisSmpBasic1Entry_ASC     Bit(2) /* Address-space control of    00613000
*                        PSW                                         */ 00614000
*    ,5 HisSmpBasic1Entry_Invalid Bit(1) /* Indicates entry is invalid  00615000
*                                                                    */ 00616000
*  ,3 HisSmpBasic1Entry_State3 Char(1)                        /* @L1A*/ 00617000
*    ,5 HisSmpBasic1Entry_ConfigLevel Bit(2) /* Configuration Level of  00618000
*                        the CPU during sample cycle.                   00619000
*                        '10'b indicates virtual machine level          00620000
*                        '01'b indicates LPAR (logical partition) level 00621000
*                        '00'b and '11'b are reserved            @L1A*/ 00622000
*    ,5 HisSmpBasic1Entry_IsHost Bit(1) /* Host Indicator - On when the 00623000
*                        basic-sampling data entry (BSDE) is stored to  00624000
*                        sample-data blocks (SDB) established by a      00625000
*                        control program run at the logical partition   00626000
*                        level. Value is not meaningful when            00627000
*                        HisSmpBasic1Entry_ConfigLevel is '00'b  @L1A*/ 00628000
*  ,3 * Char(1)                                               /* @L1C*/ 00629000
*  ,3 HisSmpBasic1Entry_PASN Fixed(16) /* Primary ASN from control      00630000
*                        register 4                                  */ 00631000
*  ,3 HisSmpBasic1Entry_InstrAddr Ptr(64) /* The address of the         00632000
*                        instruction being executed.                 */ 00633000
*  ,3 HisSmpBasic1Entry_GPP Char(8) /* The program parameter most       00634000
*                        recently set by the CPU at the virtual machine 00635000
*                        level (the guest OS).                       */ 00636000
*  ,3 HisSmpBasic1Entry_HPP Char(8) /* The program parameter most       00637000
*                        recently set by the CPU at the logical         00638000
*                        partition level (the host OS).              */ 00639000
*  ,3 HisSmpBasic1Entry_End Char(0);                                    00640000
*                                                                       00641000
*Dcl HisSmpEntryFormat_kBasic1 Bit(16)   Constant('0001'X);             00642000
*Dcl HisSmpEntryLength_kBasic1 Fixed(16)                                00643000
*                              Constant(Length(HisSmp_Basic1Entry));    00644000
*                                                                       00645000
* @LOGIC;                                                               00646000
* #PRAGMA TOOL=CBGEN.                                                   00647000
* #USEORG.                                                              00648000
* #NOTUPPER.                                                            00649000
* #ALIGNOP.                                                             00650000
* #LINE.%INCLUDE SYSLIB(HISYSMPX);                                      00651000
* #NOMAP.                                                               00652000
* #LINE.%INCLUDE SYSLIB(HISYEXIT);                                      00653000
* #LINE.%INCLUDE SYSLIB(HISYSERV);                                      00654000
* #DELETE.HisSmpParm_Info_IsA                                           00655000
* #DELETE.HisSDBTrailer_Alert                                           00656000
* #MAP.                                                                 00657000
* #EPRAGMA.                                                             00658000
* @ENDLOGIC;                                                            00659000
*/* End of PL/X Source                                               */ 00660000
* %IF HISYSMPX_LIST = 'NO' !                                            00661000
*    ZCBPRINT = 'NO' %THEN                                              00662000
* %DO;                                                                  00663000
*   @LIST POP NOECHO;                                                   00664000
* %END;                                                                 00665000
* %END;                                                                 00666000
