*                                                                       00001000
* %DCL ISGYNQPB_INCLUDED CHAR EXT;                                      00002000
* %DEACTIVATE ISGYNQPB_INCLUDED;                                        00003000
* %IF ISGYNQPB_INCLUDED = '' %THEN                                      00004000
* %DO;                                                                  00005000
*/* Macro made bi-lingual on 13023. CBGEN compile date 12258         */ 00006000
*% /*                                                                   00007000
         MACRO                                                          00008000
         ISGYNQPB &DSECT=YES,&LIST=YES,&TITLE=YES,&NQPB=YES             00009000
         GBLC  &ISGYNQPB_INCLUDED                                       00010000
         GBLC  &ZCBPRINT                                                00011000
&ISGYNQPB_INCLUDED SETC 'YES'                                           00012000
         AIF   ('&LIST' EQ 'NONE').P0                                   00013000
         AIF   ('&TITLE' EQ 'NO').P5                                    00014000
 TITLE   'ISGYNQPB  - Pre-Batch ENQ Exit Parameter List              '  00015000
.P5      ANOP                                                           00016000
**/ ISGYNQPB_1:;                                                        00017000
*/* START OF SPECIFICATIONS ******************************************* 00018000
*                                                                       00019000
*01* DESCRIPTIVE NAME:  Pre-Batch ENQ Exit Parameter List               00020000
*02*  ACRONYM:  NQPB                                                    00021000
*                                                                       00022000
*01* PROPRIETARY STATEMENT =                                            00023000
*                                                                       00024000
*    LICENSED MATERIALS - PROPERTY OF IBM                               00025000
*    5650-ZOS COPYRIGHT IBM CORP. 2001,2013                             00026000
*                                                                       00027000
*01* STATUS = HBB7790                                                   00028000
*                                                                       00029000
*01* EXTERNAL CLASSIFICATION: PI                                        00030000
*01* END OF EXTERNAL CLASSIFICATION:                                    00031000
*                                                                       00032000
*01* MACRO NAME: ISGYNQPB                                               00033000
*                                                                       00034000
*01* DSECT NAME: NQPB                                                   00035000
*                                                                       00036000
*01* COMPONENT:  Global Resource Serialization (SCSDS)                  00037000
*                                                                       00038000
*01* EYE-CATCHER:  NQPB                                                 00039000
*02*  OFFSET:  0                                                        00040000
*02*  LENGTH:  4                                                        00041000
*                                                                       00042000
*01* STORAGE ATTRIBUTES:                                                00043000
*02*  SUBPOOL:  215                                                     00044000
*02*  KEY:  0                                                           00045000
*02*  RESIDENCY:  Above the 16M line                                    00046000
*                                                                       00047000
*01* SIZE:  LENGTH(NQPB)                                                00048000
*            NQPB -- X'0060' bytes                                      00049000
*            NQPBRSC_ENTRY -- X'0030' bytes                             00050000
*                                                                       00051000
*01* FREQUENCY:  1 per active ENQ/DEQ request                           00052000
*                                                                       00053000
*01* CREATED BY: ISGGNX                                                 00054000
*                                                                       00055000
*01* POINTED TO BY: R1 points to the NQPB on entry to the exit routine  00056000
*                                                                       00057000
*01* SERIALIZATION: N/A                                                 00058000
*                                                                       00059000
*01* FUNCTION:                                                          00060000
*                                                                       00061000
*    The Pre-Batched ENQ/DEQ Parameter list is passed to an             00062000
*    installation provided exit (installed at the ISGNQXITPREBATCH exit 00063000
*    point) to determine if the request should be presented to the      00064000
*    ISGNQXITBATCHCND, ISGNQXITQUEUED1, or ISGNQXITQUEUED2 exits.       00065000
*    If an exit routine for any resource in a list request indicates    00066000
*    that an exit be called, the entire resource list will be           00067000
*    presented to that exit.                                            00068000
*                                                                       00069000
*    Note:  If there are no ISGNQXITPREBATCH exit routines, the         00070000
*    ISGNQXITBATCHCND exit will never be invoked. The ISGNQXITQUEUED1   00071000
*    and ISGNQXITQUEUED2 exits are called only if either of the batch   00072000
*    exits (ISGNQXITBATCH and ISGNQXITBATCHCND) are called.             00073000
*                                                                       00074000
*    If the request is to be globally managed by an alternate           00075000
*    serialization product, then NQPB_ER_AltSerExtended should be set.  00076000
*    This indication will be returned on an ISGQUERY request, or by     00077000
*    an ISGENQ TEST=YES request.                                        00078000
*                                                                       00079000
*    The data presented in this parameter list are read only.  Changes  00080000
*    to an ENQ/DEQ/RESERVE request can only be made through the         00081000
*    ISGNQXIT exit point.  Altering the data in the parameter list can  00082000
*    result in severe consequences, including ABENDs, data integrity    00083000
*    errors, and/or system wait states.                                 00084000
*                                                                       00085000
*    The exits are called after each of the individual resources have   00086000
*    been processed by ISGNQXIT/ISGNQXITFAST exits and GRS RNLs. The    00087000
*    RNLs are always processed with any alterations made by the         00088000
*    ISGNQXIT/ISGNQXITFAST exits.  A history of the changes made by     00089000
*    the exits and RNLs is provided via the following fields:           00090000
*                                                                       00091000
*    Scope alteration history:                                          00092000
*     1.Nqpb_RD_OriginalScope - The scope specified on the ENQ,         00093000
*                               DEQ, ISGENQ, or RESERVE.                00094000
*     2.Nqpb_RD_NqxitScope    - The scope after any ISGNQXIT/FAST exit  00095000
*                               alterations.                            00096000
*     3.Nqpb_RD_Scope         - The scope after any RNL alterations.    00097000
*                               Regardless of all other indicators,     00098000
*                               this is the final scope that will be    00099000
*                               used.                                   00100000
*                                                                       00101000
*    RNL processing history:                                            00102000
*     Nqpb_SF2_RnlEqNo     - RNLs were not processed                    00103000
*     Nqpb_SF3_Included    - A SYSTEM scope was promoted to SYSTEMS     00104000
*     Nqpb_SF3_Excluded    - A SYSTEMS scope was excluded to SYSTEM     00105000
*                            This and Nqpb_SF3_Included can be          00106000
*                            on as it may have been promoted            00107000
*                            generically and then more specifical       00108000
*                            demoted.                                   00109000
*     Nqpb_SF3_Converted   - A RESERVE obtain/release was               00110000
*                            converted from a RESERVE-ENQ/DEQ to        00111000
*                            a ENQ/DEQ only.                            00112000
*                                                                       00113000
*    Most of the exits that are driven for a request are provided a     00114000
*    unique "request token" which allows the exits to correlate any     00115000
*    required user information between exit callers. For example, the   00116000
*    Nqpb_RD_RequestToken will be the same as the Nqxp_RequestToken if  00117000
*    both the ISGNQXITPREBATCH and ISGNQXITFAST exits are driven for    00118000
*    the same request.                                                  00119000
*                                                                       00120000
*01* METHOD OF ACCESS: DECLARE NQPBPTR PTR(31)                          00121000
*                      %INCLUDE SYSLIB(ISGYNQPB)                        00122000
*                                                                       00123000
*01* DELETED BY: ISGGNX                                                 00124000
*                                                                       00125000
*01* NOTES: none                                                        00126000
*                                                                       00127000
*02*  DEPENDENCIES:                                                     00128000
*                                                                       00129000
*01* DISTRIBUTION LIBRARY: AMACLIB                                      00130000
*                                                                       00131000
*01* CHANGE ACTIVITY:                                                   00132000
*                                                                       00133000
*    $00=OW56028 ,HBB7707,020826,PDBD: Add ISGNQXITPREBATCH exit        00134000
*    $P1=64GRS   ,HBB7709,031215,PD2V: add ISGENQ bit                   00135000
*    $P2=PJK1603 ,HBB7709,040315,PDRY: Add Nqpb_SF1_IsgEnqCondYes -     00136000
*                                      indicates the conditional state  00137000
*                                      of an ISGENQ request             00138000
*    $P3=ME00672 ,HBB7720,040615,PDFY: Add Nqpb_ER_AltSerExtended       00139000
*    $01=OA06611 ,HBB7709,040515,PD2V: Add PreBatch vote bits           00140000
*       =ME01463 ,HBB7730,050808,PDCJ: Fix copyright                    00141000
*    $P4=ME05220 ,HBB7730,060109,PDRY: Update comments                  00142000
*    $L1=GRSTOR2 ,HBB7740,060515,PDCJ: Add Nqpb_ qxitScope and new      00143000
*                                      version to support it.           00144000
*    $L2=GRSRSNS ,HBB7750,070403,PDFX: Add more ISGENQ data             00145000
*    $P5=ME10689 ,HBB7750,070731,PDFY: Update comments                  00146000
*       =GRSISVCP,HBB7760,070910,PDFX: Update prolog for Queued2 exit   00147000
*    $L3=GRSCHNG ,HBB7790,110225,PDFY: Change to Share indication       00148000
*                                                                       00149000
**** END OF SPECIFICATIONS *******************************************/ 00150000
*% /*                                                                   00151000
.P0      ANOP                                                           00152000
         AIF   ('&ZCBPRINT' EQ 'NO').P1                                 00153000
         AIF   ('&LIST' EQ 'YES').P2                                    00154000
.P1      ANOP                                                           00155000
         PUSH  PRINT                                                    00156000
         PRINT OFF                                                      00157000
.P2      ANOP                                                           00158000
         AIF   ('&NQPB' EQ 'NO').L0002                                  00159000
         AIF   ('&DSECT' EQ 'YES').L0003                                00160000
         AIF   ('&NQPB' NE 'YES').L0002                                 00161000
NQPB     DS    0D                                                       00162000
         AGO   .L0004                                                   00163000
.L0003   ANOP                                                           00164000
NQPB     DSECT                                                          00165000
.L0004   ANOP                                                           00166000
NQPB_ID  DS    CL4       Eyecatcher                                     00167000
NQPB_VERSION DS X        Version. See version constants below e.g.     *00168000
                         Nqpb_kVersion#1                                00169000
         DS    CL3       Reserved                                       00170000
NQPB_WORKAREA@ DS A      Pointer to a 4K work area, usable by exit     *00171000
                         routines                                       00172000
NQPB_REQUESTDATA DS 0CL72 ENQ/DEQ request state information, these     *00173000
                         values cannot be changed                       00174000
NQPB_RD_REQUESTTOKEN DS CL16 Unique token identifying the GRS exit     *00175000
                         call processing for the request. If needed,   *00176000
                         all exits driven for this request can use     *00177000
                         this token to identify the same request. See  *00178000
                         the prologue for more information.             00179000
NQPB_RD_QNAME@ DS A      Pointer to request QNAME                       00180000
NQPB_RD_RNAME@ DS A      Pointer to request RNAME                       00181000
NQPB_RD_UCB@ DS A        Request UCB address after ISGNQXIT/FAST and   *00182000
                         RNL processing. Only valid when Nqpb_SF1_ENQ  *00183000
                         is set. Note that the actual device RESERVE   *00184000
                         will not be issued when Nqpb_SF3_Converted is *00185000
                         set                                            00186000
NQPB_RD_SCOPE DS X       Request scope, see Nqpb_kScope values          00187000
NQPB_RD_ORIGINALSCOPE DS X Scope before exit and RNL processing, see   *00188000
                         Nqpb_kScope                                    00189000
NQPB_RD_RET DS 0X        Request RET value, see Nqpb_kRET values        00190000
NQPB_RD_RET1 EQU X'04'   Maps to PELRET1                                00191000
NQPB_RD_RET2 EQU X'02'   Maps to PELRET2                                00192000
NQPB_RD_RET3 EQU X'01'   Maps to PELRET3                                00193000
         ORG   NQPB_RD_RET+1                                            00194000
NQPB_RD_RNAMELEN DS X    Length of the RName. When 0, request is a     *00195000
                         generic DEQ                                    00196000
NQPB_RD_ASCB@ DS A       Pointer to requester's ASCB                    00197000
NQPB_RD_TCB@ DS A        Pointer to requester's TCB or directed TCB if *00198000
                         TCB= was specified                             00199000
NQPB_RD_MASID DS H       Request MASID value                            00200000
NQPB_RD_NQXITSCOPE DS X  Scope value after ISGNQXITFAST and ISGNQXIT   *00201000
                         processing. See Nqpb_kScope for possible      *00202000
                         values and the prologue for information on    *00203000
                         which scopes are presented. Only provided in  *00204000
                         version Nqpb_kVersion#3 and up. A comparison  *00205000
                         with Nqpb_RD_OriginalScope determines if the  *00206000
                         exit changed the scope.                        00207000
         DS    CL1       Reserved                                       00208000
NQPB_RD_MTCB DS A        Request MTCB value                             00209000
NQPB_RD_JOBNAME DS CL8   Requester's Jobname                            00210000
NQPB_RD_SYSNAME DS CL8   Requester's Sysname                            00211000
NQPB_RD_NSI@ DS 0A       Requester's next sequential instruction       *00212000
                         address, when ENQ/DEQ ends, this is address   *00213000
                         of the next instruction in the calling        *00214000
                         program that will be executed                  00215000
NQPB_RD_AMODE31 EQU X'80' When set, ENQ caller is AMODE 31              00216000
         ORG   NQPB_RD_NSI@+4                                           00217000
NQPB_RD_ECB@ DS A        Pointer to original request ECB (set when     *00218000
                         ECB= specified on the request)                 00219000
NQPB_STATEFLAGS DS 0CL3  ENQ/DEQ request state flags, these values     *00220000
                         cannot be changed                              00221000
NQPB_STATEFLAGS1 DS 0B   First byte of state flags                      00222000
NQPB_SF1_ENQ EQU X'80'   When 1, request is ENQ/RESERVE, when 0,       *00223000
                         request is DEQ. If Nqpb_SF1_ISGENQ is set     *00224000
                         then when 1, ISGENQ REQUEST=OBTAIN or CHANGE, *00225000
                         when 0, REQUEST=RELEASE. See Nqpb_SF2_Change  *00226000
                         to distinguish between ISGENQ REQUEST=OBTAIN  *00227000
                         and REQUEST=CHANGE.                            00228000
NQPB_SF1_AUTHORIZED EQU X'40' Caller is authorized                      00229000
NQPB_SF1_MATCHTASK EQU X'20' When 1, request specified MASID/MTCB       00230000
NQPB_SF1_SMCORRMC EQU X'10'                                             00231000
NQPB_SF1_STEPMUSTCOMPLETE EQU X'10' When 1, ENQ request specified      *00232000
                         SMC=YES                                        00233000
NQPB_SF1_RESETMUSTCOMPLETE EQU X'10' When 1, DEQ request specified     *00234000
                         RMC=YES                                        00235000
NQPB_SF1_LINKAGE EQU X'08' When 1, request is PC entered when 0,       *00236000
                         request is SVC entered. As ISGENQ requests    *00237000
                         are all PC entered, this bit will be 1 for    *00238000
                         all ISGENQ requests.                           00239000
NQPB_SF1_ISGENQ EQU X'04' When 1, request is ISGENQ                     00240000
NQPB_SF1_ISGENQCONDYES EQU X'02' When 1, request is a conditional      *00241000
                         ISGENQ request (ISGENQ COND=YES)               00242000
         ORG   NQPB_STATEFLAGS1+1                                       00243000
NQPB_STATEFLAGS2 DS 0B   Second byte of state flags                     00244000
NQPB_SF2_SHARE EQU X'80' For ENQ/RESERVE requests, when 1 request is   *00245000
                         for shared access, when 0, request is for     *00246000
                         exclusive access                               00247000
NQPB_SF2_RNLEQNO EQU X'40' RNL=NO was specified on the request          00248000
NQPB_SF2_CHANGE EQU X'20' When 1, request is a change (i.e. ENQ        *00249000
                         RET=CHNG or ISGENQ REQUEST=CHANGE).            00250000
NQPB_SF2_TEST_YES EQU X'10' When 1, ISGENQ with TEST=YES. When 0, Not  *00251000
                         ISGENQ with TEST=YES (i.e. TEST=NO if         *00252000
                         Nqpb_SF1_ISGENQ is set).                       00253000
NQPB_SF2_CONTENTIONACT_FAIL EQU X'08' When 1, ISGENQ with              *00254000
                         CONTENTIONACT=FAIL. When 0, not               *00255000
                         CONTENTIONACT=FAIL (i.e. CONTENTIONACT=WAIT   *00256000
                         if Nqpb_SF1_ISGENQ is set and                 *00257000
                         Nqpb_SF2_TEST_YES is off).                     00258000
NQPB_SF2_ECB EQU X'04'   When 1, ECB keyword specified (i.e. ISGENQ    *00259000
                         WAITTYPE=ECB or or ENQ with ECB). When 0, No  *00260000
                         ECB specified (i.e. WAITTYPE=SUSPEND if       *00261000
                         Nqpb_SF1_ISGENQ is set and Nqpb_SF2_TEST_YES  *00262000
                         and Nqpb_SF2_CONTENTIONACT_FAIL are off).      00263000
NQPB_SF2_CHANGETOSHARED EQU X'02' When 1, ISGENQ REQUEST=CHANGE        *00264000
                         specified CONTROL=SHARED. If the request is   *00265000
                         successful, the requester will be converted   *00266000
                         from an exclusive owner to a shared owner.    *00267000
                         Only valid when Nqpb_SF2_Change is 1           00268000
         ORG   NQPB_STATEFLAGS2+1                                       00269000
NQPB_STATEFLAGS3 DS 0B   Third byte of state flags                      00270000
NQPB_SF3_INCLUDED EQU X'80' Resource promoted to SYSTEMS scope          00271000
NQPB_SF3_CONVERTED EQU X'40' Resource converted from RESERVE to        *00272000
                         SYSTEMS ENQ only. As such, the device RESERVE *00273000
                         will not be issued, but Nqpb_RD_Ucb@ will     *00274000
                         still be set                                   00275000
NQPB_SF3_EXCLUDED EQU X'20' Resource demoted to SYSTEM scope            00276000
NQPB_SF3_GLOBAL EQU X'10' Resource request will be processed globally  *00277000
                         by GRS. Note Nqpb_SF3_Global will always be   *00278000
                         off in GRS=NONE mode.                          00279000
         ORG   NQPB_STATEFLAGS+3                                        00280000
         DS    CL1       Reserved                                       00281000
NQPB_EXITRESPONSEFLAGS DS 0CL4 Response from exit routines              00282000
NQPB_EXITRESPONSEFLAGS1 DS 0B First byte of exit response flags         00283000
NQPB_ER_CALLISGNQXITBATCHCND EQU X'80' Drive this request through the  *00284000
                         ISGNQXITBATCHCND exit point                    00285000
NQPB_ER_ALTSEREXTENDED EQU X'40' Used by alternate serialization       *00286000
                         products to show that this request is being   *00287000
                         managed at the global (SYSTEMS) level. Only   *00288000
                         processed when version is Nqpb_kVersion#2 and *00289000
                         above.                                         00290000
NQPB_ER_INTERESTINPREB EQU X'08'                                        00291000
NQPB_ER_CALLPREBFORTHISRESOURCE EQU X'04'                               00292000
         ORG   NQPB_EXITRESPONSEFLAGS1+1                                00293000
         DS    CL3       Reserved                                       00294000
         DS    CL4       Reserved                                       00295000
NQPB_END DS    0C                                                       00296000
*                                                                       00297000
*   ******************************************************************  00298000
*                                                                       00299000
*                          NQPB Constants                               00300000
*                                                                       00301000
*   ******************************************************************  00302000
*                                                                       00303000
*                                                                       00304000
NQPB_KID EQU   C'NQPB'   Used to identify control block                 00305000
NQPB_KVERSION#1 EQU 1    Version constant - HBB7705                     00306000
NQPB_KVERSION#2 EQU 2    Version constant - HBB7709                     00307000
NQPB_KVERSION#3 EQU 3    Version constant - HBB7740                     00308000
NQPB_KVERSION#4 EQU 4    Version constant - HBB7750                     00309000
NQPB_KCURRENTVERSION EQU 4 Current version                              00310000
NQPB_KSCOPESTEP EQU 0    Scope=Step                                     00311000
NQPB_KSCOPESYSTEM EQU 1  Scope=System                                   00312000
NQPB_KSCOPESYSTEMS EQU 2 Scope=Systems                                  00313000
NQPB_KRETNONE EQU 0      Ret=None                                       00314000
NQPB_KRETHAVE EQU 1      Ret=Have                                       00315000
NQPB_KRETCHNG EQU 2      Ret=Chng                                       00316000
NQPB_KRETUSE EQU 3       Ret=Use                                        00317000
NQPB_KRETTEST EQU 7      Ret=Test                                       00318000
NQPB_KSF3MASK EQU 240    Mask for copying from PelXFlg1 to             *00319000
                         Nqpb_StateFlags3                               00320000
NQPB_KLENGTH EQU 96      Length of NQPB                                 00321000
NQPB_LEN EQU   *-NQPB                                                   00322000
.L0002   ANOP                                                           00323000
         AIF   ('&ZCBPRINT' EQ 'NO').P3                                 00324000
         AIF   ('&LIST' EQ 'YES').P4                                    00325000
.P3      ANOP                                                           00326000
         POP   PRINT                                                    00327000
.P4      ANOP                                                           00328000
.P_EXIT  ANOP                                                           00329000
         MEND                                                           00330000
**/ ISGYNQPB_2:;                                                        00331000
* %ISGYNQPB_INCLUDED = 'YES';                                           00332000
* %DCL ZCBPRINT CHAR EXT;                                               00333000
* %DEACTIVATE ZCBPRINT;                                                 00334000
* %DCL ISGYNQPB_LIST CHAR EXT;                                          00335000
* %DEACTIVATE ISGYNQPB_LIST;                                            00336000
* %IF ISGYNQPB_LIST ^= 'NO' &                                           00337000
*    ZCBPRINT ^= 'NO' %THEN                                             00338000
*   %GOTO ISGYNQPB_3;                                                   00339000
*   @LIST PUSH NOECHO;                                                  00340000
*   @LIST NOASSEMBLE NOECHO;                                            00341000
*   @LIST OFF C NOECHO;                                                 00342000
* %ISGYNQPB_3:;                                                         00343000
*/* Start of PL/X Source                                             */ 00344000
*%if NqpbAttr = '' %then                                                00345000
*  %NqpbAttr = 'based(NqpbPtr) bdy(dword)';                             00346000
*dcl                                                                    00347000
*   1 Nqpb NqpbAttr                                                     00348000
*  ,  3 Nqpb_Id char(4)             /* Eyecatcher                    */ 00349000
*  ,  3 Nqpb_Version fixed(8)       /* Version. See version constants   00350000
*                                      below e.g. Nqpb_kVersion#1       00351000
*                                                                @L2C*/ 00352000
*  ,  3 * char(3)                   /* Reserved                      */ 00353000
*  ,  3 Nqpb_WorkArea@ ptr(31)      /* Pointer to a 4K work area,       00354000
*                                      usable by exit routines       */ 00355000
*  ,  3 Nqpb_RequestData            /* ENQ/DEQ request state            00356000
*                                      information, these values        00357000
*                                      cannot be changed             */ 00358000
*  ,    5 Nqpb_RD_RequestToken char(16) /* Unique token identifying     00359000
*                                      the GRS exit call processing for 00360000
*                                      the request. If needed, all      00361000
*                                      exits driven for this request    00362000
*                                      can use this token to identify   00363000
*                                      the same request.  See the       00364000
*                                      prologue for more information.   00365000
*                                                                @L1C*/ 00366000
*  ,    5 Nqpb_RD_QName@ ptr(31)    /* Pointer to request QNAME      */ 00367000
*  ,    5 Nqpb_RD_RName@ ptr(31)    /* Pointer to request RNAME      */ 00368000
*  ,    5 Nqpb_RD_Ucb@ ptr(31)      /* Request UCB address after        00369000
*                                      ISGNQXIT/FAST and RNL            00370000
*                                      processing. Only valid when      00371000
*                                      Nqpb_SF1_ENQ is set. Note that   00372000
*                                      the actual device RESERVE        00373000
*                                      will not be issued when          00374000
*                                      Nqpb_SF3_Converted is set @P4C*/ 00375000
*  ,    5 Nqpb_RD_Scope fixed(8)    /* Request scope, see Nqpb_kScope   00376000
*                                      values                        */ 00377000
*  ,    5 Nqpb_RD_OriginalScope fixed(8) /* Scope before exit and RNL   00378000
*                                      processing, see Nqpb_kScope   */ 00379000
*  ,    5 Nqpb_RD_Ret fixed(8)      /* Request RET value, see           00380000
*                                      Nqpb_kRET values              */ 00381000
*  ,      7 * bit(5)                /* Unused                        */ 00382000
*  ,      7 Nqpb_RD_Ret1 bit(1)     /* Maps to PELRET1               */ 00383000
*  ,      7 Nqpb_RD_Ret2 bit(1)     /* Maps to PELRET2               */ 00384000
*  ,      7 Nqpb_RD_Ret3 bit(1)     /* Maps to PELRET3               */ 00385000
*  ,    5 Nqpb_RD_RNameLen fixed(8) /* Length of the RName. When 0,     00386000
*                                      request is a generic DEQ  @P4C*/ 00387000
*  ,    5 Nqpb_RD_Ascb@ ptr(31)     /* Pointer to requester's ASCB   */ 00388000
*  ,    5 Nqpb_RD_Tcb@ ptr(31)      /* Pointer to requester's TCB or    00389000
*                                      directed TCB if TCB= was         00390000
*                                      specified                     */ 00391000
*  ,    5 Nqpb_RD_MAsid fixed(15)   /* Request MASID value           */ 00392000
*  ,    5 Nqpb_RD_NqxitScope fixed(8)/*Scope value after ISGNQXITFAST   00393000
*                                      and ISGNQXIT processing.  See    00394000
*                                      Nqpb_kScope for possible values  00395000
*                                      and the prologue for information 00396000
*                                      on which scopes are presented.   00397000
*                                      Only provided in version         00398000
*                                      Nqpb_kVersion#3 and up. A        00399000
*                                      comparison with                  00400000
*                                      Nqpb_RD_OriginalScope determines 00401000
*                                      if the exit changed the scope.   00402000
*                                                                @L3A*/ 00403000
*  ,    5 * char(1)                 /* Reserved                      */ 00404000
*  ,    5 Nqpb_RD_MTcb ptr(31)      /* Request MTCB value            */ 00405000
*  ,    5 Nqpb_RD_Jobname char(8)   /* Requester's Jobname           */ 00406000
*  ,    5 Nqpb_RD_Sysname char(8)   /* Requester's Sysname           */ 00407000
*  ,    5 Nqpb_RD_NSI@ ptr(31)      /* Requester's next sequential      00408000
*                                      instruction address, when        00409000
*                                      ENQ/DEQ ends, this is address    00410000
*                                      of the next instruction in the   00411000
*                                      calling program that will be     00412000
*                                      executed                      */ 00413000
*  ,      7 Nqpb_RD_AMode31 bit(1)  /* When set, ENQ caller is AMODE    00414000
*                                      31                            */ 00415000
*  ,    5 Nqpb_RD_Ecb@ ptr(31)      /* Pointer to original request ECB  00416000
*                                      (set when ECB= specified on the  00417000
*                                      request)                      */ 00418000
*  ,  3 Nqpb_StateFlags             /* ENQ/DEQ request state flags,     00419000
*                                      these values cannot be changed   00420000
*                                                                    */ 00421000
*  ,    5 Nqpb_StateFlags1 bit(8)   /* First byte of state flags     */ 00422000
*  ,      7 Nqpb_SF1_ENQ bit(1)     /* When 1, request is ENQ/RESERVE,  00423000
*                                      when 0, request is DEQ.          00424000
*                                      If Nqpb_SF1_ISGENQ is set then   00425000
*                                      when 1, ISGENQ REQUEST=OBTAIN or 00426000
*                                      CHANGE, when 0, REQUEST=RELEASE. 00427000
*                                      See Nqpb_SF2_Change to           00428000
*                                      distinguish between ISGENQ       00429000
*                                      REQUEST=OBTAIN and               00430000
*                                      REQUEST=CHANGE.           @L2C*/ 00431000
*  ,      7 Nqpb_SF1_Authorized bit(1) /* Caller is authorized       */ 00432000
*  ,      7 Nqpb_SF1_MatchTask bit(1) /* When 1, request specified      00433000
*                                      MASID/MTCB                    */ 00434000
*  ,      7 Nqpb_SF1_SMCorRMC bit(1)                                    00435000
*  ,        9 Nqpb_SF1_StepMustComplete bit(1) /* When 1, ENQ request   00436000
*                                      specified SMC=YES             */ 00437000
*  ,          11 Nqpb_SF1_ResetMustComplete bit(1) /* When 1, DEQ       00438000
*                                      request specified RMC=YES     */ 00439000
*  ,      7 Nqpb_SF1_Linkage bit(1) /* When 1, request is PC entered    00440000
*                                      when 0, request is SVC entered.  00441000
*                                      As ISGENQ requests are all PC    00442000
*                                      entered, this bit will be 1 for  00443000
*                                      all ISGENQ requests.      @P5C*/ 00444000
*  ,      7 Nqpb_SF1_ISGENQ bit(1)  /* When 1, request is ISGENQ @P1A*/ 00445000
*  ,      7 Nqpb_SF1_IsgEnqCondYes bit(1) /* When 1, request is a       00446000
*                                      conditional ISGENQ request       00447000
*                                      (ISGENQ COND=YES)         @P2C*/ 00448000
*  ,      7 * bit(1)                /* Reserved                  @P2C*/ 00449000
*  ,    5 Nqpb_StateFlags2 bit(8)   /* Second byte of state flags    */ 00450000
*  ,      7 Nqpb_SF2_Share bit(1)   /* For ENQ/RESERVE requests,        00451000
*                                      when 1 request is for shared     00452000
*                                      access,                          00453000
*                                      when 0, request is for           00454000
*                                      exclusive access              */ 00455000
*  ,      7 Nqpb_SF2_RnlEqNo bit(1) /* RNL=NO was specified on the      00456000
*                                      request                       */ 00457000
*  ,      7 Nqpb_SF2_Change bit(1)  /* When 1, request is a change      00458000
*                                      (i.e. ENQ RET=CHNG or ISGENQ     00459000
*                                      REQUEST=CHANGE).          @L2A*/ 00460000
*  ,      7 Nqpb_SF2_TEST_YES bit(1) /* When 1, ISGENQ with TEST=YES.   00461000
*                                      When 0, Not ISGENQ with TEST=YES 00462000
*                                      (i.e. TEST=NO if                 00463000
*                                      Nqpb_SF1_ISGENQ is set).  @L2A*/ 00464000
*  ,      7 Nqpb_SF2_CONTENTIONACT_FAIL bit(1) /* When 1, ISGENQ with   00465000
*                                      CONTENTIONACT=FAIL.              00466000
*                                      When 0, not CONTENTIONACT=FAIL   00467000
*                                      (i.e. CONTENTIONACT=WAIT if      00468000
*                                      Nqpb_SF1_ISGENQ is set and       00469000
*                                      Nqpb_SF2_TEST_YES is off).       00470000
*                                                                @L2A*/ 00471000
*  ,      7 Nqpb_SF2_ECB bit(1)     /* When 1, ECB keyword specified    00472000
*                                      (i.e. ISGENQ WAITTYPE=ECB or     00473000
*                                      or ENQ with ECB).                00474000
*                                      When 0, No ECB specified         00475000
*                                      (i.e. WAITTYPE=SUSPEND if        00476000
*                                      Nqpb_SF1_ISGENQ is set and       00477000
*                                      Nqpb_SF2_TEST_YES and            00478000
*                                      Nqpb_SF2_CONTENTIONACT_FAIL      00479000
*                                      are off).                 @L2A*/ 00480000
*  ,      7 Nqpb_SF2_ChangeToShared bit(1) /* When 1, ISGENQ            00481000
*                                      REQUEST=CHANGE specified         00482000
*                                      CONTROL=SHARED. If the request   00483000
*                                      is successful, the requester     00484000
*                                      will be converted from an        00485000
*                                      exclusive owner to a shared      00486000
*                                      owner. Only valid when           00487000
*                                      Nqpb_SF2_Change is 1      @L3A*/ 00488000
*  ,      7 * bit(1)                /* Reserved                  @L3C*/ 00489000
*  ,    5 Nqpb_StateFlags3 bit(8)   /* Third byte of state flags     */ 00490000
*  ,      7 Nqpb_SF3_Included bit(1) /* Resource promoted to            00491000
*                                      SYSTEMS scope                 */ 00492000
*  ,      7 Nqpb_SF3_Converted bit(1) /* Resource converted from        00493000
*                                      RESERVE to SYSTEMS ENQ only.     00494000
*                                      As such, the device RESERVE      00495000
*                                      will not be issued, but          00496000
*                                      Nqpb_RD_Ucb@ will still          00497000
*                                      be set                    @P4C*/ 00498000
*  ,      7 Nqpb_SF3_Excluded bit(1) /* Resource demoted to SYSTEM      00499000
*                                      scope                         */ 00500000
*  ,      7 Nqpb_SF3_Global bit(1)  /* Resource request will be         00501000
*                                      processed globally by GRS. Note  00502000
*                                      Nqpb_SF3_Global will             00503000
*                                      always be off in GRS=NONE        00504000
*                                      mode.                     @P4C*/ 00505000
*  ,  3 * char(1)                   /* Reserved                      */ 00506000
*  ,  3 Nqpb_ExitResponseFlags      /* Response from exit routines   */ 00507000
*  ,    5 Nqpb_ExitResponseFlags1 bit(8) /* First byte of exit          00508000
*                                      response flags                */ 00509000
*  ,      7 Nqpb_ER_CallISGNQXITBATCHCND bit(1) /* Drive this request   00510000
*                                      through the ISGNQXITBATCHCND     00511000
*                                      exit point                    */ 00512000
*  ,      7 Nqpb_ER_AltSerExtended bit(1) /* Used by alternate          00513000
*                                      serialization products to show   00514000
*                                      that this request is being       00515000
*                                      managed at the global (SYSTEMS)  00516000
*                                      level. Only processed when       00517000
*                                      version is Nqpb_kVersion#2 and   00518000
*                                      above.                    @L1C*/ 00519000
*  ,      7 * bit(2)                /* Reserved                  @01A*/ 00520000
* /*******************************************************************/ 00521000
* /* Exit Caching:                                                   */ 00522000
* /*  The following bits will be used to determine if the            */ 00523000
* /*  ISGNQXITPreBatch exit will be called again for this resource.  */ 00524000
* /*  The protocol for setting these bits is as described:           */ 00525000
* /*                                                                 */ 00526000
* /*  To indicate the PreBatch  exit should be called you must code: */ 00527000
* /*                                                                 */ 00528000
* /*     OI Nqpb_ExitResponseFlags1,Nqpb_ER_InterestInPreB+          */ 00529000
* /*        Nqpb_ER_CallPreBForThisResource                          */ 00530000
* /*                                                                 */ 00531000
* /*  To indicate the PreBatch  exit should NOT be called you must   */ 00532000
* /*  code:                                                          */ 00533000
* /*                                                                 */ 00534000
* /*     OI Nqpb_ExitResponseFlags1,Nqpb_ER_InterestInLQCB           */ 00535000
* /*                                                                 */ 00536000
* /*  Turning on these bits in any other combination other than what */ 00537000
* /*  is describe will result in a call to the ISGNQXITPreBatch exit.*/ 00538000
* /*  NOTE: If more than 1 PreBatch exit is installed, the exit      */ 00539000
* /*  will be called if any one of the PreBatch exits indicates to   */ 00540000
* /*  call.                                                          */ 00541000
* /*  NOTE: These bits may only be turned on in the above manner,    */ 00542000
* /*  and never should be turned off.  Turing off bits may result in */ 00543000
* /*  unexpected results]                                        @01A*/ 00544000
* /*  NOTE: When the Prebatch exit receives control for a Generic    */ 00545000
* /*  DEQ requests, the setting of the above bits is ignored.    @01A*/ 00546000
* /*  NOTE: When the Prebatch exit receives control for a Generic    */ 00547000
* /*  DEQ requests, the Rname length is zero and the scope will be   */ 00548000
* /*  set to SYSTEMS.                                            @L1A*/ 00549000
* /*  NOTE: If an exit specifies in the Prebatch response area to not*/ 00550000
* /*  call the PreB  again for this resource, and also specifies to  */ 00551000
* /*  call the BatchCnd, the request to call BatchCnd is ignored.    */ 00552000
* /*  This is true in all cases expect Generic DEQ requests.         */ 00553000
* /*  Therefore, it is possible to have a Prebatch exit get control  */ 00554000
* /*  for a Generic DEQ where the exit indicates to not be called    */ 00555000
* /*  again using the above bits, and also indicate to call the      */ 00556000
* /*  BatchCnd where the end result would be a call to the Batchcnd  */ 00557000
* /*  exit and the above bits are ignored.                       @01A*/ 00558000
* /*  NOTE: Adding or activating an ISGNQXITPREBATCH exit will result*/ 00559000
* /*  in the clearing of the GRS Exit Cache.                     @01A*/ 00560000
* /*******************************************************************/ 00561000
*  ,      7 Nqpb_ER_InterestInPREB bit(1) /*                     @01A*/ 00562000
*  ,      7 Nqpb_ER_CallPreBForThisResource bit(1) /*            @01A*/ 00563000
*  ,    5 * char(3)                 /* Reserved                      */ 00564000
*  ,  3 * char(4)                   /* Reserved                      */ 00565000
*  ,  3 Nqpb_End char(0) bdy(dword)                                     00566000
*  ;                                                                    00567000
* /*******************************************************************/ 00568000
* /*                                                                 */ 00569000
* /*                       NQPB Constants                            */ 00570000
* /*                                                                 */ 00571000
* /*******************************************************************/ 00572000
* dcl                                                                   00573000
*    Nqpb_kId char(4) constant('NQPB') /* Used to identify control      00574000
*                                      block                         */ 00575000
*   ,Nqpb_kVersion#1 constant(1)    /* Version constant - HBB7705    */ 00576000
*   ,Nqpb_kVersion#2 constant(2)   /* Version constant - HBB7709 @P1A*/ 00577000
*   ,Nqpb_kVersion#3 constant(3)   /* Version constant - HBB7740 @L1A*/ 00578000
*   ,Nqpb_kVersion#4 constant(4)   /* Version constant - HBB7750 @L2A*/ 00579000
*   ,Nqpb_kCurrentVersion constant(Nqpb_kVersion#4) /* Current version  00580000
*                                                                @L2C*/ 00581000
*   ,Nqpb_kScopeStep   constant(0)  /* Scope=Step                    */ 00582000
*   ,Nqpb_kScopeSystem constant(1)  /* Scope=System                  */ 00583000
*   ,Nqpb_kScopeSystems constant(2) /* Scope=Systems                 */ 00584000
*   ,Nqpb_kRetNone constant('00000000'b) /* Ret=None                 */ 00585000
*   ,Nqpb_kRetHave constant('00000001'b) /* Ret=Have                 */ 00586000
*   ,Nqpb_kRetChng constant('00000010'b) /* Ret=Chng                 */ 00587000
*   ,Nqpb_kRetUse constant('00000011'b) /* Ret=Use                   */ 00588000
*   ,Nqpb_kRetTest constant('00000111'b) /* Ret=Test                 */ 00589000
*   ,Nqpb_kSF3Mask constant('11110000'b) /* Mask for copying from       00590000
*                                      PelXFlg1 to Nqpb_StateFlags3  */ 00591000
*   ,Nqpb_kLength constant(length(Nqpb)) /* Length of NQPB           */ 00592000
*   ;                                                                   00593000
*/* End of PL/X Source                                               */ 00594000
* %IF ISGYNQPB_LIST ^= 'NO' &                                           00595000
*    ZCBPRINT ^= 'NO' %THEN                                             00596000
*   %GOTO ISGYNQPB_4;                                                   00597000
*   @LIST POP NOECHO;                                                   00598000
* %ISGYNQPB_4:;                                                         00599000
* %END;                                                                 00600000
