*                                                                       00001000
* %DCL IXGQBUF_INCLUDED CHAR EXT;                                       00002000
* %DEACTIVATE IXGQBUF_INCLUDED;                                         00003000
* %IF IXGQBUF_INCLUDED = '' %THEN                                       00004000
* %DO;                                                                  00005000
*/* Macro made bi-lingual on 11104. CBGEN compile date 11090         */ 00006000
*% /*                                                                   00007000
         MACRO                                                          00008000
         IXGQBUF &DSECT=YES,&LIST=YES,&TITLE=YES,&QBUF=YES              00009000
         GBLC  &IXGQBUF_INCLUDED                                        00010000
         GBLC  &ZCBPRINT                                                00011000
&IXGQBUF_INCLUDED SETC 'YES'                                            00012000
         AIF   ('&LIST' EQ 'NONE').P0                                   00013000
         AIF   ('&TITLE' EQ 'NO').P5                                    00014000
 TITLE   'IXGQBUF  - Query Buffer                                '      00015000
.P5      ANOP                                                           00016000
**/ IXGQBUF_1:;                                                         00017000
*/* START OF SPECIFICATIONS ******************************************/ 00018000
*/*                                                                  */ 00019000
*/*01* PROPRIETARY STATEMENT=                                        */ 00020000
*/***PROPRIETARY_STATEMENT********************************************/ 00021000
*/*                                                                  */ 00022000
*/* LICENSED MATERIALS - PROPERTY OF IBM                             */ 00023000
*/* 5650-ZOS                                                         */ 00024000
*/* COPYRIGHT IBM CORP. 1997, 2017                                   */ 00025000
*/*                                                                  */ 00026000
*/* STATUS = HBB77B0                                                 */ 00027000
*/*                                                                  */ 00028000
*/***END_OF_PROPRIETARY_STATEMENT*************************************/ 00029000
*/*                                                                  */ 00030000
*/*                                                                  */ 00031000
*/*02* ACRONYM:  QBUF                                                */ 00032000
*/*                                                                  */ 00033000
*/*01* DESCRIPTIVE NAME: Query Buffer                                */ 00034000
*/*                                                                  */ 00035000
*/*01* MACRO NAME: IXGQBUF                                           */ 00036000
*/*                                                                  */ 00037000
*/*01* DSECT NAME: QBUF                                              */ 00038000
*/*                                                                  */ 00039000
*/*01* Component:  System Logger (SCLOG)                             */ 00040000
*/*                                                                  */ 00041000
*/*01* EYE-CATCHER:  NONE                                            */ 00042000
*/*                                                                  */ 00043000
*/*01* STORAGE ATTRIBUTES:                                           */ 00044000
*/*02*   MAIN STORAGE: Caller's storage or function dynamic storage  */ 00045000
*/*                                                                  */ 00046000
*/*01* SIZE:  Version 0                                          @L3C*/ 00047000
*/*           72 bytes                                           @L3C*/ 00048000
*/*           QBUF -- X'0048' bytes                                  */ 00049000
*/*                                                                  */ 00050000
*/*           Version 1                                          @L3A*/ 00051000
*/*           88 bytes                                           @L3A*/ 00052000
*/*           QBUF -- X'0058' bytes                                  */ 00053000
*/*                                                                  */ 00054000
*/*           Version 2                                          @L3A*/ 00055000
*/*           168 bytes                                          @L4C*/ 00056000
*/*           QBUF -- X'00A8' bytes                              @L4C*/ 00057000
*/*                                                                  */ 00058000
*/*           Version 3 and 4                                    @03A*/ 00059000
*/*           200 bytes                                          @L5A*/ 00060000
*/*           QBUF -- X'00C8' bytes                                  */ 00061000
*/*                                                                  */ 00062000
*/*01* CREATED BY: CALLER                                            */ 00063000
*/*                                                                  */ 00064000
*/*01* POINTED TO BY: CALLER                                         */ 00065000
*/*                                                                  */ 00066000
*/*                                                                  */ 00067000
*/*01* SERIALIZATION:                                                */ 00068000
*/*     None required                                                */ 00069000
*/*                                                                  */ 00070000
*/*01* FUNCTION: Maps information returned by IXGQUERY               */ 00071000
*/*02*                                                               */ 00072000
*/*                                                                  */ 00073000
*/*01* EXTERNAL CLASSIFICATION: GUPI                                 */ 00074000
*/*01* END OF EXTERNAL CLASSIFICATION:                               */ 00075000
*/*                                                                  */ 00076000
*/*01* METHOD OF ACCESS:                                             */ 00077000
*/*02*  ASM:  IXGQBUF  USING on QBUF                                 */ 00078000
*/*                                                                  */ 00079000
*/*02*  PLX:  %INCLUDE SYSLIB(IXGQBUF)                               */ 00080000
*/*     ASM:  Specify LIST=YES on macro call for listing             */ 00081000
*/*                                                                  */ 00082000
*/*01* DELETED BY: N/A                                               */ 00083000
*/*                                                                  */ 00084000
*/*01* FREQUENCY:  One per call                                  @L3C*/ 00085000
*/*                                                                  */ 00086000
*/*01* DEPENDENCIES: N/A                                             */ 00087000
*/*                                                                  */ 00088000
*/*01* DISTRIBUTION LIBRARY: AMACLIB                                 */ 00089000
*/*                                                                  */ 00090000
*/*01* CHANGE ACTIVITY:                                              */ 00091000
*/*                                                                  */ 00092000
*/*   Flag LineItem  FMID    Date   ID    Comment                    */ 00093000
*/*                                                                  */ 00094000
*/*     $L0=RSR      HBB6603 960130 PDXD: Remote Site Recovery       */ 00095000
*/*     $P2=PQC1489  HBB6603 960617 PDXD: If the safe import point   */ 00096000
*/*                                       to be returned is the      */ 00097000
*/*                                       lowest valid block id      */ 00098000
*/*                                       (rather than the high      */ 00099000
*/*                                       committed rba), subtract 1 */ 00100000
*/*                                       from the low valid blkid   */ 00101000
*/*                                       before returning it to the */ 00102000
*/*                                       caller.                    */ 00103000
*/*     $P3=PQC1730  HBB6603 960717 PDXD: QBUF_LEN defined twice     */ 00104000
*/*                                       causing assembler errors   */ 00105000
*/*     $P4=PQC1931  HBB6603 960717 PDXD: SIZE comment missing from  */ 00106000
*/*                                       prolog causing SHOWHDR     */ 00107000
*/*                                       errors                     */ 00108000
*/*     $P5=PQC1798  HBB6603 960905 PDV6: Loss of Data Bounds        */ 00109000
*/*     $L1=LOGR4    JBB6604 961029 PDTT: Dasd only log stream   @L1A*/ 00110000
*/*     $L2=CFDUP    HBB7705 000914 PDJL: CF Auto-duplexing      @L2A*/ 00111000
*/*     $01=OW54759  HBB7705 020515 PD00A8: Correct BAL version      */ 00112000
*/*     $L3=CHREQ    HBB7720 040310 PDNJ: version 2 for health   @L3A*/ 00113000
*/*                                       checker support        @L3A*/ 00114000
*/*     $L4=CHREQ    HBB7720 040827 PDNJ: additions to ver 2     @L4A*/ 00115000
*/*     $02=OA11052  HBB7720 050322 PDNJ: CHREQ Rolldown             */ 00116000
*/*     $L5=LOGSEP   HBB7730 050505 PD00A8: Separation Support       */ 00117000
*/*     $P6=ME10027  HBB7750 070518 PDDZ: prolog cleanup         @P6A*/ 00118000
*/*     $03=OA30548  HBB7740 091201 PDAS: size field expansion   @03A*/ 00119000
*/*     $04=OA36172  HBB7750 110408 PDNJ: HIGHOFFLOAD, LOWOFFLOAD@04A*/ 00120000
*/*     $L6=LOGRMXRC HBB77B0 160613 PDDZ: remove DRXRC support   @L6A*/ 00120102
*/*                                                                  */ 00121000
*/*END OF SPECIFICATIONS *********************************************/ 00122000
*% /*                                                                   00123000
.P0      ANOP                                                           00124000
         AIF   ('&ZCBPRINT' EQ 'NO').P1                                 00125000
         AIF   ('&LIST' EQ 'YES').P2                                    00126000
.P1      ANOP                                                           00127000
         PUSH  PRINT                                                    00128000
         PRINT OFF                                                      00129000
.P2      ANOP                                                           00130000
         AIF   ('&QBUF' EQ 'NO').L0002                                  00131000
         AIF   ('&DSECT' EQ 'YES').L0003                                00132000
         AIF   ('&QBUF' NE 'YES').L0002                                 00133000
QBUF     DS    0D        Mapping of returned buffer when IXGQUERY      *00134000
                         requested                                      00135000
         AGO   .L0004                                                   00136000
.L0003   ANOP                                                           00137000
QBUF     DSECT           Mapping of returned buffer when IXGQUERY      *00138000
                         requested                                      00139000
.L0004   ANOP                                                           00140000
QBUF_SECTION_BEGIN DS 0CL68                                             00141000
QBUF_VERSION_NUMBER DS F Version number of this mapping                 00142000
QBUF_SAFE_IMPORT_POINT DS CL8 All log blocks with a blockid less than  *00143000
                         or equal to this 8-byte integer can be safely *00144000
                         imported into a log stream                     00145000
QBUF_STRUCT_VERSION_NUMBER DS 0CL8 Logical structure version number of *00146000
                         the coupling facility being used to support   *00147000
                         this log stream                                00148000
QBUF_INSTANCE_VERSION_NUMBER DS CL8 Alternate name                      00149000
QBUF_CONTROL_INFO_SIZE DS F Number of bytes that System Logger adds to *00150000
                         a log block written via the IXGWRITE service   00151000
QBUF_LS_TIMESTAMP DS CL8 8 Byte time stamp assigned to the log stream. *00152000
                         If zero, no time stamp is assigned             00153000
QBUF_NEXT_BLOCKID_TO_BE_ASSIGNED DS CL8 Next log block id to be        *00154000
                         assigned when a log block is successfully     *00155000
                         written to the log stream. May change over a  *00156000
                         rebuild operation                              00157000
QBUF_CF_TIMESTAMP_VALUE DS CL8 GMT Time stamp value maintained in the  *00158000
                         coupling facility for this log stream. The    *00159000
                         next log block written or imported to this    *00160000
                         log stream must have a GMT time stamp value   *00161000
                         >= to this value                               00162000
QBUF_FLAGS DS  0B        Flag byte                                      00163000
QBUF_AUTODELETE EQU X'80' ON, log stream data may be deleted whenever  *00164000
                         the retention period expires or whenever the  *00165000
                         data has been deleted via an IXGDELET         *00166000
                         request. OFF, log data may be deleted only    *00167000
                         after the retention period expires and the    *00168000
                         data has been deleted via an IXGDELET         *00169000
                         request. Only set if autodelete is supported  *00170000
                         by current logger cds level. If an update is  *00171000
                         pending, represents the pending state of the  *00172000
                         field.                                         00173000
QBUF_LOSSOFDATA EQU X'40' ON, the log stream has a lost log data. The  *00174000
                         range of log data the is affected is          *00175000
                         identified by QBUF_low_loss_of_data_blkid and *00176000
                         QBUF_high_loss_of_data_blkid. OFF, the log    *00177000
                         stream has not encountered a loss of log      *00178000
                         data.                                          00179000
QBUF_USING_PHYSICAL_STRUCT EQU X'20' On = Using physical structure      00180000
QBUF_USING_PHYSICAL_STRUCT2 EQU X'10' On = Using second physical       *00181000
                         structure                                      00182000
QBUF_LS_OFFLOAD_RETURNED EQU X'08' Log stream definition HIGHOFFLOAD   *00183000
                         and LOWOFFLOAD are returned in fields         *00184000
                         QBUF_Ls_HighOffload QBUF_Ls_LowOffload         00185000
         ORG   QBUF_FLAGS+1                                             00186000
QBUF_RETPD DS  FL3       Log stream data retention period. Only set if *00187000
                         retention period is supported by current      *00188000
                         logger cds level. If an update is pending,    *00189000
                         represents the pending state of the field.     00190000
*                                                                       00191000
*     ****************************************************************] 00192000
*     *                                                               ] 00193000
*     * The following two fields represent the loss of data bounds    ] 00194000
*     * for a log stream and are valid only when QBUF_LossOfData is   ] 00195000
*     * ON. The following examples are meant to help explain the      ] 00196000
*     * contents of these two fields, which are the "low loss of data ] 00197000
*     * bound" and the "high loss of data bound". Ex. 1 - assume the  ] 00198000
*     * log stream has 8 log blocks, with block ids 1 thru 8 before a ] 00199000
*     * loss of data occurs and time increase as the block ids        ] 00200000
*     * increase. BlkIDs in LS ! 1 2 3 4 5 6 7 8 !. After a loss of   ] 00201000
*     * data that causes log blocks 5 and 6 to be lost, the log       ] 00202000
*     * stream looks like: BlkIDs in LS ! 1 2 3 4 loss of data 7 8 !. ] 00203000
*     * IXGQUERY will return: QBUF_low_loss_of_data_blkid = 4         ] 00204000
*     * QBUF_high_loss_of_data_blkid = >8 where >8 means a block id   ] 00205000
*     * that will be the first block ID to be assign to the first log ] 00206000
*     * block write after the loss of data occurs. Ex. 2 - assume the ] 00207000
*     * log stream has 8 log blocks, with block ids 1 thru 8 before a ] 00208000
*     * loss of data occurs and time increase as the block ids        ] 00209000
*     * increase. BlkIDs in LS ! 1 2 3 4 5 6 7 8 !. After a loss of   ] 00210000
*     * data that causes log blocks 5 thru 8 to be lost, the log      ] 00211000
*     * stream looks like: BlkIDs in LS ! 1 2 3 4 loss of data !.     ] 00212000
*     * IXGQUERY will return: QBUF_low_loss_of_data_blkid = 4         ] 00213000
*     * QBUF_high_loss_of_data_blkid = > 8 where >8 means a block id  ] 00214000
*     * that will be the first block ID to be assign to the first log ] 00215000
*     * block write after the loss of data occurs. Ex. 3 - assume the ] 00216000
*     * log stream has 8 log blocks, 1 thru 8 before a loss of data   ] 00217000
*     * occurs and time increase as the block ids increase. BlkIDs in ] 00218000
*     * LS ! 1 2 3 4 5 6 7 8 !. After a loss of data that causes log  ] 00219000
*     * blocks 1 thru 8 to be lost, the log stream looks like: BlkIDs ] 00220000
*     * in LS ! loss of data. !. IXGQUERY will return:                ] 00221000
*     * QBUF_low_loss_of_data_blkid = < 1 where <1 means a block id   ] 00222000
*     * that will be less than any block ID in the log stream.        ] 00223000
*     * QBUF_high_loss_of_data_blkid = > 8 where >8 means a block id  ] 00224000
*     * that will be the first block ID to be assign to the first log ] 00225000
*     * block write after the loss of data occurs.                    ] 00226000
*     *                                                               ] 00227000
*     ****************************************************************] 00228000
*                                                                       00229000
*                                                                       00230000
QBUF_LOW_LOSS_OF_DATA_BLKID DS CL8 If log stream has encountered a     *00231000
                         loss of data condition, this field contains a *00232000
                         log block id just prior to (older than) the   *00233000
                         first occurance of the loss of data range in  *00234000
                         the log stream. Note, as the prior examples   *00235000
                         indicate, there is no guaranteed that this    *00236000
                         block ID represents a valid log block ID in   *00237000
                         the log stream (see Ex. 3).                    00238000
QBUF_HIGH_LOSS_OF_DATA_BLKID DS CL8 If log stream has encountered a    *00239000
                         loss of data condition, this field contains a *00240000
                         log block id just after (younger than) the    *00241000
                         loss of data range in the log stream. Note,   *00242000
                         as the prior examples indicate, there is no   *00243000
                         guaranteed that this block ID represents a    *00244000
                         valid log block ID in the log stream (see Ex. *00245000
                         2).                                            00246000
QBUF_RESERVED DS CL4     Insert filler bytes to insure QBUF section is *00247000
                         a multiple of doublewords in length            00248000
QBUF_SECTION_END DS 0C   End of Original QBUF section                   00249000
QBUF_VERSION1_SECTION_BEGIN DS 0CL16 Beginning of Version 1 data        00250000
QBUF_PHYSICAL_STRUCT_VERSIONS DS 0CL16                                  00251000
QBUF_PHYSICAL_STRUCTS_VERSIONS DS 0CL16                                 00252000
QBUF_PHYSICAL_STRUCT_VERSION DS 0CL8 Physical structure version number *00253000
                         of the second coupling facility being used to *00254000
                         support this log stream.                       00255000
QBUF_PHYSICAL_INSTANCE_VERSION DS CL8 Alternate name                    00256000
QBUF_PHYSICAL_STRUCT_VERSION2 DS 0CL8 See below                         00257000
QBUF_PHYSICAL_STRUCT2_VERSION DS 0CL8 Second physical structure        *00258000
                         version number of the second coupling         *00259000
                         facility being used to support this log       *00260000
                         stream.                                        00261000
QBUF_PHYSICAL_INSTANCE_VERSION2 DS 0CL8 See above                       00262000
QBUF_PHYSICAL_INSTANCE2_VERSION DS CL8 Alternate name                   00263000
QBUF_VERSION1_RESERVED DS 0C Insert filler bytes to insure QBUF        *00264000
                         Version 1 section is a multiple of            *00265000
                         doublewords in length                          00266000
QBUF_VERSION1_SECTION_END DS 0C End of Version 1 data                   00267000
*                                                                       00268000
*      ***************************************************************  00269000
*      *                                                             *  00270000
*      * VERSION 2 DATA                                                 00271000
*      *                                                             *  00272000
*      ***************************************************************  00273000
*                                                                       00274000
*                                                                       00275000
QBUF_VERSION2_SECTION_BEGIN DS 0CL80 Beginning of version 2 data        00276000
QBUF_LS_DS_NAME DS CL44  Name of the most recently allocated Logstream *00277000
                         Offload Data Set on this system if known. Set *00278000
                         to binary zeros if unknown.                    00279000
QBUF_LS_DS_SIZE DS F     Represents the most recently allocated        *00280000
                         Logstream Offload data set size in bytes      *00281000
                         (using zero origin) if known, and value of    *00282000
                         zero if unknown. If Offload data set size is  *00283000
                         2GB or greater, this field will be            *00284000
                         x'7FFFFFFF'. When the , QBUF_VERSION_NUMBER   *00285000
                         is 4 or greater and the offload data set size *00286000
                         is known, the the full value will be in field *00287000
                         QBUF_FULL_LS_DS_SIZE.                          00288000
QBUF_STR_SIZE DS CL8     Size of the structure as reported by xes, set *00289000
                         to zero if logstream is dasdonly.              00290000
QBUF_STG_DS_SIZE DS F    Represents the Logstream Staging data set     *00291000
                         size in bytes (using zero origin) if staging  *00292000
                         data set are in use, zero if staging data     *00293000
                         sets are not in use. If Staging data set size *00294000
                         is 2GB or greater, this field will be         *00295000
                         x'7FFFFFFF'. When the QBUF_VERSION NUMBER is  *00296000
                         4 or greater and staging data sets are in     *00297000
                         use, the the full value will be in field      *00298000
                         QBUF_FULL_STG_DS_SIZE.                         00299000
QBUF_DUPLEX_FLAGS DS 0B  Duplex flags - one or more of these flags can *00300000
                         be on                                          00301000
QBUF_LOCAL_BUFFER_DUPLEXING EQU X'80' ON => Log stream is currently    *00302000
                         being duplexed to local buffers. OFF => Log   *00303000
                         stream is not being duplexed to local         *00304000
                         buffers.                                       00305000
QBUF_STAGING_DATASET_DUPLEXING EQU X'40' ON => Log stream is currently *00306000
                         being duplexed to staging data sets. OFF =>   *00307000
                         Log stream is not being duplexed to staging   *00308000
                         data sets.                                     00309000
QBUF_DR_STAGING_DATASET_DUPLEXING EQU X'20' ON => Log stream is         00310000
*                        currently duplexing using the XRC facility.    00311000
*                        OFF => Log stream is not duplexing using the   00312000
*                        XRC facility.                                  00313000
*                        This flag will no longer be set on as of       00313100
*                        release HBB77B0 (z/OS v2r3).              @L6A 00313200
QBUF_STRUCTURE_DUPLEXING EQU X'10' ON => Log stream is currently being *00314000
                         duplexed to a coupling facility structure.    *00315000
                         OFF => Log stream is not being duplexed to a  *00316000
                         coupling facility structure.                   00317000
         ORG   QBUF_DUPLEX_FLAGS+1                                      00318000
QBUF_VER2_OTHER_FLAGS DS 0B Other flags                                 00319000
QBUF_DASDONLY_LOGSTREAM EQU X'80' ON => Log stream has been defined as *00320000
                         dasd only. OFF => Log stream has been defined *00321000
                         as CF based.                                   00322000
QBUF_CURRENT_DATASET EQU X'40' ON => Data set referred to by           *00323000
                         QBUF_Ls_Ds_Name is the current offload data   *00324000
                         set. OFF => Data set referred to by           *00325000
                         QBUF_Ls_Ds_Name is not the current offload    *00326000
                         data set or the current data set is           *00327000
                         undefined.                                     00328000
         ORG   QBUF_VER2_OTHER_FLAGS+1                                  00329000
QBUF_LS_HIGHOFFLOAD DS X Logstream HighOffload percentage               00330000
QBUF_LS_LOWOFFLOAD DS X  Logstream LowOffload percentage                00331000
QBUF_STR_LOGSNUM DS F    Max number of logstreams that can be defined  *00332000
                         to this structure. Set to 0 if DASDONLY.       00333000
QBUF_STR_CONNECTCOUNT DS F Number of logstreams using space in this    *00334000
                         structure (connected to this structure). Set  *00335000
                         to 0 if DASDONLY.                              00336000
QBUF_STR_SIZE_USABLE DS CL8 Number of bytes of usable structure space  *00337000
                         for this logstream, (as determined by element *00338000
                         pool and element size). Set to 0 if DASDONLY.  00339000
QBUF_VERSION2_RESERVED DS 0C Insert filler bytes to insure QBUF        *00340000
                         Version 2 section is a multiple of            *00341000
                         doublewords in length                          00342000
QBUF_VERSION2_SECTION_END DS 0C End of Version 2 data area              00343000
*                                                                       00344000
*      ***************************************************************  00345000
*      *                                                             *  00346000
*      * END VERSION 2 DATA                                             00347000
*      * VERSION 3 AND 4 DATA                                           00348000
*      *                                                             *  00349000
*      ***************************************************************  00350000
*                                                                       00351000
*                                                                       00352000
QBUF_VERSION3_SECTION_BEGIN DS 0CL32 Beginning of version 3 data        00353000
QBUF_GROUPVALUE DS CL8   GROUP Value for this Logstream. If the        *00354000
                         logstream was defined with GROUP(PRODUCTION), *00355000
                         the value will be 'PROD '. If GROUP(TEST) was *00356000
                         used, the value will be 'TEST '.               00357000
QBUF_FULL_LS_DS_SIZE DS FL8 Represents the most recently allocated     *00358000
                         Logstream Offload data set size in bytes      *00359000
                         (using zero origin) if known, and the value   *00360000
                         of zero if unknown. Only valid if the         *00361000
                         QBUF_VERSION_NUMBER is 4 or greater.           00362000
QBUF_FULL_STG_DS_SIZE DS FL8 Represents the Staging data set size in   *00363000
                         bytes (using zero origin) if staging data     *00364000
                         sets are being used, and zreo if staging data *00365000
                         sets are not in use. Only valid if the        *00366000
                         QBUF_VERSION_NUMBER is 4 or greater            00367000
         DS    CL8       Reserved                                       00368000
QBUF_VERSION3_RESERVED DS 0C Insert filler bytes to insure QBUF        *00369000
                         Version 3 section is a multiple of            *00370000
                         doublewords in length                          00371000
QBUF_VERSION3_SECTION_END DS 0C End of Version 3 data area              00372000
*                                                                       00373000
*      ***************************************************************  00374000
*      *                                                             *  00375000
*      * END VERSION 3 DATA                                             00376000
*      *                                                             *  00377000
*      ***************************************************************  00378000
*                                                                       00379000
*                                                                       00380000
QBUFEND  DS    0C        End of QBUF                                    00381000
QBUF_LENGTH EQU 72                                                      00382000
*                                                                       00383000
*    *****************************************************************  00384000
*    *                                                               *  00385000
*    * should remain 72 bytes                                           00386000
*    *                                                               *  00387000
*    *****************************************************************  00388000
*                                                                       00389000
*                                                                       00390000
QBUF_VERSION1_LENGTH EQU 88                                             00391000
*                                                                       00392000
*    *****************************************************************  00393000
*    *                                                               *  00394000
*    * should remain 88 bytes                                           00395000
*    *                                                               *  00396000
*    *****************************************************************  00397000
*                                                                       00398000
*                                                                       00399000
QBUF_VERSION2_LENGTH EQU 168                                            00400000
*                                                                       00401000
*    *****************************************************************  00402000
*    *                                                               *  00403000
*    * should remain 168 bytes                                          00404000
*    *                                                               *  00405000
*    *****************************************************************  00406000
*                                                                       00407000
*                                                                       00408000
QBUF_VERSION3_LENGTH EQU 200                                            00409000
*                                                                       00410000
*    *****************************************************************  00411000
*    *                                                               *  00412000
*    * should remain 200 bytes                                          00413000
*    *                                                               *  00414000
*    *****************************************************************  00415000
*                                                                       00416000
*                                                                       00417000
QBUF_VERSION4_LENGTH EQU 200                                            00418000
*                                                                       00419000
*    *****************************************************************  00420000
*    *                                                               *  00421000
*    * should remain 200 bytes                                          00422000
*    *                                                               *  00423000
*    *****************************************************************  00424000
*                                                                       00425000
*                                                                       00426000
QBUF_LEN EQU   200       Max length                                     00427000
QBUFVERNUM EQU 0                                                        00428000
QBUFVERONE EQU 1                                                        00429000
QBUFVERTWO EQU 2                                                        00430000
QBUFVERTHREE EQU 3                                                      00431000
QBUFVERFOUR EQU 4                                                       00432000
.L0002   ANOP                                                           00434000
         AIF   ('&ZCBPRINT' EQ 'NO').P3                                 00435000
         AIF   ('&LIST' EQ 'YES').P4                                    00436000
.P3      ANOP                                                           00437000
         POP   PRINT                                                    00438000
.P4      ANOP                                                           00439000
.P_EXIT  ANOP                                                           00440000
         MEND                                                           00441000
**/ IXGQBUF_2:;                                                         00442000
* %IXGQBUF_INCLUDED = 'YES';                                            00443000
* %DCL ZCBPRINT CHAR EXT;                                               00444000
* %DEACTIVATE ZCBPRINT;                                                 00445000
* %DCL IXGQBUF_LIST CHAR EXT;                                           00446000
* %DEACTIVATE IXGQBUF_LIST;                                             00447000
* %IF IXGQBUF_LIST ^= 'NO' &                                            00448000
*    ZCBPRINT ^= 'NO' %THEN                                             00449000
*   %GOTO IXGQBUF_3;                                                    00450000
*   @LIST PUSH NOECHO;                                                  00451000
*   @LIST NOASSEMBLE NOECHO;                                            00452000
*   @LIST OFF C NOECHO;                                                 00453000
* %IXGQBUF_3:;                                                          00454000
*/* Start of PL/X Source                                             */ 00455000
* DCL 1 QBUF BDY(DWORD) BASED,     /* Mapping of returned buffer when   00456000
*                                     IXGQUERY requested             */ 00457000
*      2  QBUF_Section_Begin,                                           00458000
*                                                                       00459000
*         3 QBUF_Version_Number FIXED(31), /* Version number            00460000
*                                             of this mapping        */ 00461000
*         3 QBUF_Safe_Import_Point CHAR(8), /* All log blocks with a    00462000
*                                     blockid less than or equal to     00463000
*                                     this 8-byte integer can be        00464000
*                                     safely imported into a log        00465000
*                                     stream                    @P2C */ 00466000
*         3 QBUF_Struct_Version_Number CHAR(8),/* Logical structure     00467000
*                                     version number of the coupling    00468000
*                                     facility being used to support    00469000
*                                     this log stream            @L2C*/ 00470000
*           5 QBUF_Instance_Version_Number CHAR(8), /* Alternate name   00471000
*                                                                @L1A*/ 00472000
*         3 QBUF_Control_Info_Size FIXED(31),/* Number of bytes that    00473000
*                                     System Logger adds to a log block 00474000
*                                     written via the IXGWRITE service  00475000
*                                                                    */ 00476000
*         3 QBUF_LS_TimeStamp CHAR(8), /* 8 Byte time stamp assigned to 00477000
*                                     the log stream. If zero, no time  00478000
*                                     stamp is assigned              */ 00479000
*         3 QBUF_Next_BlockID_To_Be_Assigned CHAR(8), /* Next log block 00480000
*                                     id to be assigned when a log      00481000
*                                     block is successfully written to  00482000
*                                     the log stream. May change over a 00483000
*                                     rebuild operation              */ 00484000
*         3 QBUF_CF_TimeStamp_Value CHAR(8), /* GMT Time stamp value    00485000
*                                     maintained in the coupling        00486000
*                                     facility for this log stream. The 00487000
*                                     next log block written or         00488000
*                                     imported to this log stream must  00489000
*                                     have a GMT time stamp value >=    00490000
*                                     to this value                  */ 00491000
*         3 QBUF_FLAGS BIT(8),    /* Flag byte                       */ 00492000
*           5 QBUF_AutoDelete bit(1), /* ON, log stream data may be     00493000
*                   deleted whenever the retention period               00494000
*                   expires or whenever the data has been               00495000
*                   deleted via an IXGDELET request. OFF,               00496000
*                   log data may be deleted only after                  00497000
*                   the retention period expires and the                00498000
*                   data has been deleted via an IXGDELET               00499000
*                   request.                                            00500000
*                   Only set if autodelete is supported by       @L3A   00501000
*                   current logger cds level.                    @L3A   00502000
*                   If an update is pending, represents the      @L3A   00503000
*                   pending state of the field.                  @L3A*/ 00504000
*           5 QBUF_LossOfData bit(1), /* ON, the log stream has         00505000
*                   a lost log data. The range of log data the          00506000
*                   is affected is identified by                        00507000
*                   QBUF_low_loss_of_data_blkid and                     00508000
*                   QBUF_high_loss_of_data_blkid.                       00509000
*                   OFF, the log stream has not encountered             00510000
*                   a loss of log data.                          @P5A*/ 00511000
*           5 QBUF_Using_Physical_Struct  BIT(1), /* On = Using         00512000
*                                         physical structure     @L2A*/ 00513000
*           5 QBUF_Using_Physical_Struct2 BIT(1), /* On = Using second  00514000
*                                         physical structure     @L2A*/ 00515000
*           5 QBUF_LS_Offload_Returned Bit(1), /* Log stream definition 00516000
*                                    HIGHOFFLOAD and LOWOFFLOAD are     00517000
*                                    returned in fields                 00518000
*                                    QBUF_Ls_HighOffload                00519000
*                                    QBUF_Ls_LowOffload          @04A*/ 00520000
*           5 * BIT(3),           /* Reserved for expansion      @04C*/ 00521000
*                                                                       00522000
*         3 QBUF_Retpd FIXED(24), /* Log stream data retention          00523000
*                                    period.                            00524000
*                   Only set if retention period is supported by @L3A   00525000
*                   current logger cds level.                    @L3A   00526000
*                   If an update is pending, represents the      @L3A   00527000
*                   pending state of the field.                  @L3A*/ 00528000
*         ]                                                             00529000
*         ] The following two fields represent the loss of data         00530000
*         ] bounds for a log stream and are valid only when             00531000
*         ] QBUF_LossOfData is ON.                                      00532000
*         ]                                                             00533000
*         ] The following examples are meant to help explain the        00534000
*         ] contents of these two fields,                               00535000
*         ] which are the "low loss of data bound"                      00536000
*         ] and the "high loss of data bound".                          00537000
*         ]                                                             00538000
*         ] Ex. 1 - assume the log stream has 8 log blocks, with block  00539000
*         ]         ids 1 thru 8 before a loss of data occurs           00540000
*         ]         and time increase as the block ids increase.        00541000
*         ]                                                             00542000
*         ]     BlkIDs                                                  00543000
*         ]     in LS  ! 1  2  3  4  5  6  7  8          !.             00544000
*         ]                                                             00545000
*         ]   After a loss of data that causes log blocks 5 and         00546000
*         ]   6 to be lost, the log stream looks like:                  00547000
*         ]                                                             00548000
*         ]     BlkIDs                                                  00549000
*         ]     in LS  ! 1  2  3  4  loss of data  7  8  !.             00550000
*         ]                                                             00551000
*         ]   IXGQUERY will return:                                     00552000
*         ]       QBUF_low_loss_of_data_blkid = 4                       00553000
*         ]       QBUF_high_loss_of_data_blkid = >8                     00554000
*         ]           where >8 means a block id that will be            00555000
*         ]           the first block ID to be assign to the            00556000
*         ]           first log block write after the loss              00557000
*         ]           of data occurs.                                   00558000
*         ]                                                             00559000
*         ] Ex. 2 - assume the log stream has 8 log blocks, with block  00560000
*         ]         ids 1 thru 8 before a loss of data occurs           00561000
*         ]         and time increase as the block ids increase.        00562000
*         ]                                                             00563000
*         ]     BlkIDs                                                  00564000
*         ]     in LS  ! 1  2  3  4  5  6  7  8   !.                    00565000
*         ]                                                             00566000
*         ]   After a loss of data that causes log blocks 5 thru        00567000
*         ]   8 to be lost, the log stream looks like:                  00568000
*         ]                                                             00569000
*         ]     BlkIDs                                                  00570000
*         ]     in LS  ! 1  2  3  4  loss of data !.                    00571000
*         ]                                                             00572000
*         ]   IXGQUERY will return:                                     00573000
*         ]       QBUF_low_loss_of_data_blkid = 4                       00574000
*         ]       QBUF_high_loss_of_data_blkid = > 8                    00575000
*         ]           where >8 means a block id that will be            00576000
*         ]           the first block ID to be assign to the            00577000
*         ]           first log block write after the loss              00578000
*         ]           of data occurs.                                   00579000
*         ]                                                             00580000
*         ] Ex. 3 - assume the log stream has 8 log blocks,             00581000
*         ]         1 thru 8 before a loss of data occurs               00582000
*         ]         and time increase as the block ids increase.        00583000
*         ]                                                             00584000
*         ]     BlkIDs                                                  00585000
*         ]     in LS  ! 1  2  3  4  5  6  7  8   !.                    00586000
*         ]                                                             00587000
*         ]   After a loss of data that causes log blocks 1 thru        00588000
*         ]   8 to be lost, the log stream looks like:                  00589000
*         ]                                                             00590000
*         ]     BlkIDs                                                  00591000
*         ]     in LS  !       loss of data.      !.                    00592000
*         ]                                                             00593000
*         ]   IXGQUERY will return:                                     00594000
*         ]       QBUF_low_loss_of_data_blkid = < 1                     00595000
*         ]           where <1 means a block id that will be            00596000
*         ]           less than any block ID in the log stream.         00597000
*         ]       QBUF_high_loss_of_data_blkid = > 8                    00598000
*         ]           where >8 means a block id that will be            00599000
*         ]           the first block ID to be assign to the            00600000
*         ]           first log block write after the loss              00601000
*         ]           of data occurs.                                   00602000
*         ]                                                             00603000
*         ]                                                             00604000
*         3 QBUF_low_loss_of_data_blkid char(8), /* If log stream has   00605000
*            encountered a loss of data condition, this field contains  00606000
*            a log block id just prior to (older than) the first        00607000
*            occurance of the loss of data range in the log stream.     00608000
*            Note, as the prior examples indicate, there is no          00609000
*            guaranteed that this block ID represents a valid log       00610000
*            block ID in the log stream (see Ex. 3).             @P5A*/ 00611000
*         3 QBUF_high_loss_of_data_blkid char(8), /* If log stream has  00612000
*            encountered a loss of data condition, this field contains  00613000
*            a log block id just after (younger than) the loss of       00614000
*            data range in the log stream.                              00615000
*            Note, as the prior examples indicate, there is no          00616000
*            guaranteed that this block ID represents a valid log       00617000
*            block ID in the log stream (see Ex. 2).             @P5A*/ 00618000
*                                                                       00619000
*      2  QBUF_Reserved                                                 00620000
*           CHAR((((LENGTH(QBUF_Section_Begin)+7)/8)*8)-                00621000
*                  LENGTH(QBUF_Section_Begin)), /* Insert filler bytes  00622000
*                                          to insure QBUF section       00623000
*                                          is a multiple of             00624000
*                                          doublewords in length @L2A*/ 00625000
*      2  QBUF_Section_End char(0), /* End of Original QBUF section     00626000
*                                                                @L2A*/ 00627000
*      2  QBUF_Version1_Section_Begin, /* Beginning of Version 1        00628000
*                                         data                   @L2A*/ 00629000
*         3 QBUF_Physical_Struct_Versions CHAR(16), ]              @L5A 00630000
*          4 QBUF_Physical_Structs_Versions CHAR(16), ]            @L5C 00631000
*                                                                       00632000
*           5 QBUF_Physical_Struct_Version CHAR(8), /* Physical         00633000
*               structure version number of the second coupling         00634000
*               facility being used to support this log stream.  @L2A*/ 00635000
*             7 QBUF_Physical_Instance_Version CHAR(8),  /* Alternate   00636000
*                                                           name @L2A*/ 00637000
*           5 QBUF_Physical_Struct_Version2 CHAR(8),/* See below @L5C*/ 00638000
*            6 QBUF_PHYSICAL_STRUCT2_VERSION CHAR(8), /* Second         00639000
*               physical structure version number of the second         00640000
*               coupling facility being used to support this log        00641000
*               stream.                                          @L5A*/ 00642000
*             7 QBUF_PHYSICAL_INSTANCE_VERSION2 Char(8), /* See above   00643000
*                                                                @L5A*/ 00644000
*              8 QBUF_Physical_Instance2_Version CHAR(8), /* Alternate  00645000
*                                                           name @L5C*/ 00646000
*      2  QBUF_Version1_Reserved                                        00647000
*           CHAR((((LENGTH(QBUF_Version1_Section_Begin)+7)/8)*8)-       00648000
*                  LENGTH(QBUF_Version1_Section_Begin)), /* Insert      00649000
*                                          filler bytes to insure       00650000
*                                          QBUF Version 1 section is    00651000
*                                          a multiple of doublewords    00652000
*                                          in length             @L2C*/ 00653000
*      2  QBUF_Version1_Section_End char(0), /* End of Version 1        00654000
*                                               data             @L2A*/ 00655000
*                                                                       00656000
*     /*  VERSION 2 DATA                                         @L3A*/ 00657000
*      2    QBUF_Version2_Section_Begin, /* Beginning of version 2      00658000
*                  data                                          @L3A*/ 00659000
*       3    QBUF_Ls_Ds_Name Char(44), /* Name of the most recently     00660000
*                  allocated Logstream Offload Data Set on this system  00661000
*                  if known. Set to binary zeros if unknown.     @L3A*/ 00662000
*       3    QBUF_Ls_Ds_Size Fixed(31), /* Represents the most recently 00663000
*                  allocated Logstream Offload data set size in bytes   00664000
*                  (using zero origin) if known, and value of zero if   00665000
*                  unknown. If Offload data set size is 2GB or greater, 00666000
*                  this field will be x'7FFFFFFF'. When the   ,         00667000
*                  QBUF_VERSION_NUMBER is 4 or greater and the offload  00668000
*                  data set size is known, the the full value will be   00669000
*                  in field QBUF_FULL_LS_DS_SIZE.                @03C*/ 00670000
*       3    QBUF_Str_Size Char(8), /* Size of the structure as         00671000
*                  reported by xes, set to zero if logstream is         00672000
*                  dasdonly.                                     @L4C*/ 00673000
*       3    QBUF_Stg_Ds_Size Fixed(31), /* Represents the Logstream    00674000
*                  Staging data set size in bytes (using zero origin)   00675000
*                  if staging data set are in use, zero if staging      00676000
*                  data sets are not in use. If Staging data set size   00677000
*                  is 2GB or greater, this field will be x'7FFFFFFF'.   00678000
*                  When the QBUF_VERSION NUMBER is 4 or greater and     00679000
*                  staging data sets are in use, the the full value     00680000
*                  will be in field QBUF_FULL_STG_DS_SIZE.       @03C*/ 00681000
*       3    QBUF_Duplex_Flags Bit(8), /* Duplex flags  - one or more   00682000
*                  of these flags can be on                      @L3A*/ 00683000
*         5    QBUF_Local_Buffer_Duplexing Bit(1), /* ON => Log stream  00684000
*                  is currently being duplexed to local buffers. OFF => 00685000
*                  Log stream is not being duplexed to local buffers.   00686000
*                                                                @L3A*/ 00687000
*         5    QBUF_Staging_Dataset_Duplexing Bit(1), /* ON => Log      00688000
*                  stream is currently being duplexed to staging data   00689000
*                  sets. OFF => Log stream is not being duplexed to     00690000
*                  staging data sets.                            @L3A*/ 00691000
*         5    QBUF_Dr_Staging_Dataset_Duplexing Bit(1), /* ON =>       00692000
*                  Log stream is currently duplexing using the XRC      00693000
*                  facility. OFF => Log stream is not duplexing using   00694000
*                  the XRC facility.                               @L3A 00695000
*                  This flag will no longer be set on as of             00695100
*                  release HBB77B0 (z/OS v2r3).                  @L6A*/ 00695300
*         5    QBUF_Structure_Duplexing Bit(1), /* ON => Log stream     00696000
*                  is currently being duplexed to a coupling facility   00697000
*                  structure. OFF => Log stream is not being duplexed   00698000
*                  to a coupling facility structure.             @L3A*/ 00699000
*         5    *   Bit(4), /* Reserved Bits                      @L3A*/ 00700000
*       3    QBUF_Ver2_Other_Flags Bit(8), /* Other flags        @L3A*/ 00701000
*         5    QBUF_Dasdonly_Logstream Bit(1), /* ON => Log stream has  00702000
*                  been defined as dasd only. OFF => Log stream has     00703000
*                  been defined as CF based.                     @L3A*/ 00704000
*         5    QBUF_Current_Dataset Bit(1), /* ON => Data set referred  00705000
*                  to by QBUF_Ls_Ds_Name is the current offload data    00706000
*                  set. OFF => Data set referred to by QBUF_Ls_Ds_Name  00707000
*                  is not the current offload data set or the current   00708000
*                  data set is undefined.                        @L3A*/ 00709000
*         5    *   Bit(6), /* Reserved Bits                      @L3A*/ 00710000
*       3    QBUF_LS_HighOffload Fixed(8), /* Logstream HighOffload     00711000
*                  percentage                                    @04A*/ 00712000
*       3    QBUF_LS_LowOffload Fixed(8), /* Logstream LowOffload       00713000
*                  percentage                                    @04A*/ 00714000
*       3    QBUF_Str_LogSNum Fixed(31), /* Max number of logstreams    00715000
*                  that can be defined to this structure. Set to 0 if   00716000
*                  DASDONLY.                                     @L4A*/ 00717000
*       3    QBUF_Str_ConnectCount Fixed(31), /* Number of logstreams   00718000
*                  using space in this structure (connected to this     00719000
*                  structure). Set to 0 if DASDONLY.             @L4A*/ 00720000
*       3    QBUF_Str_Size_Usable  Char(8), /* Number of bytes of       00721000
*                  usable structure space for this logstream, (as       00722000
*                  determined by element pool and element size). Set to 00723000
*                  0 if DASDONLY.                                @L4A*/ 00724000
*      2    QBUF_Version2_Reserved CHAR((((LENGTH(                      00725000
*               QBUF_Version2_Section_Begin)+7)/8)*8)-LENGTH(           00726000
*               QBUF_Version2_Section_Begin)), /* Insert filler bytes   00727000
*                  to insure QBUF Version 2 section is a multiple of    00728000
*                  doublewords in length                         @L3A*/ 00729000
*      2    QBUF_Version2_Section_End char(0), /* End of Version 2      00730000
*                  data area                                     @L3A*/ 00731000
*     /*  END VERSION 2 DATA                                     @L3A*/ 00732000
*     /*  VERSION 3 AND 4 DATA                                   @03C*/ 00733000
*      2    QBUF_Version3_Section_Begin, /* Beginning of version 3      00734000
*                                     data                       @L5A*/ 00735000
*       3    QBUF_GroupValue Char(8),  /* GROUP Value for this          00736000
*                                     Logstream. If the logstream was   00737000
*                                     defined with GROUP(PRODUCTION),   00738000
*                                     the value will be 'PROD    '.  If 00739000
*                                     GROUP(TEST) was used, the value   00740000
*                                     will be 'TEST    '.        @L5A*/ 00741000
*       3    QBUF_FULL_LS_DS_SIZE Fixed(64), /* Represents the most     00742000
*                             recently allocated Logstream Offload      00743000
*                             data set size in bytes (using zero        00744000
*                             origin) if known, and the value of zero   00745000
*                             if unknown. Only valid if the             00746000
*                             QBUF_VERSION_NUMBER is 4 or greater.      00747000
*                                                                @03A*/ 00748000
*       3    QBUF_FULL_STG_DS_SIZE Fixed(64), /* Represents the         00749000
*                             Staging data set size in bytes (using     00750000
*                             zero origin) if staging data sets are     00751000
*                             being used, and zreo if staging data sets 00752000
*                             are not in use. Only valid if the         00753000
*                             QBUF_VERSION_NUMBER is 4 or greater@03A*/ 00754000
*       3    *                Char(8),  /* Reserved              @03C*/ 00755000
*      2    QBUF_Version3_Reserved Char((((Length(                      00756000
*               QBUF_Version3_Section_Begin)+7)/8)*8)-Length(           00757000
*               QBUF_Version3_Section_Begin)), /* Insert filler bytes   00758000
*                  to insure QBUF Version 3 section is a multiple of    00759000
*                  doublewords in length                         @L5A*/ 00760000
*      2    QBUF_Version3_Section_End Char(0), /* End of Version 3      00761000
*                                     data area                  @L5A*/ 00762000
*     /*  END VERSION 3 DATA                                     @L5A*/ 00763000
*      2  QBUFEnd CHAR(0) BDY(DWORD);  /* End of QBUF                */ 00764000
*                                                                       00765000
* Dcl QBUF_Length          Constant(Offset(QBUF_Section_End)); /*@L2C*/ 00766000
*                           /* should remain 72 bytes            @L3A*/ 00767000
* Dcl QBUF_Version1_Length Constant(Offset(QBUF_Version1_Section_End)); 00768000
*                           /* should remain 88 bytes            @L3C*/ 00769000
* Dcl QBUF_Version2_Length Constant(Offset(QBUF_Version2_Section_End)); 00770000
*                           /* should remain 168 bytes           @L3A*/ 00771000
* Dcl QBUF_Version3_Length Constant(Offset(QBUF_Version3_Section_End)); 00772000
*                           /* should remain 200 bytes           @L5A*/ 00773000
* Dcl QBUF_Version4_Length Constant(Offset(QBUF_Version3_Section_End)); 00774000
*                           /* should remain 200 bytes           @03A*/ 00775000
* Dcl QBUF_Len Constant(Length(QBUF)); /* Max length             @04A*/ 00776000
* Dcl QBUFVerNum           Constant(0);                                 00777000
* Dcl QBUFVerOne           Constant(1);                        /*@L2A*/ 00778000
* Dcl QBUFVerTwo           Constant(2);                        /*@L3A*/ 00779000
* Dcl QBUFVerThree         Constant(3);                        /*@L5A*/ 00780000
* Dcl QBUFVerFour          Constant(4);                        /*@03A*/ 00781000
*/* End of PL/X Source                                               */ 00782000
* %IF IXGQBUF_LIST ^= 'NO' &                                            00783000
*    ZCBPRINT ^= 'NO' %THEN                                             00784000
*   %GOTO IXGQBUF_4;                                                    00785000
*   @LIST POP NOECHO;                                                   00786000
* %IXGQBUF_4:;                                                          00787000
* %END;                                                                 00788000
