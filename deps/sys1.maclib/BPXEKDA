*/**** START OF SPECIFICATIONS **************************************** 00010000
*                                                                     * 00020000
*                                                                     * 00030000
*01* MACRO NAME:  BPXEKDA                               -08/17/99-<0> * 00040000
*                                                                     * 00050000
*                                                                     * 00060000
*01* DESCRIPTIVE NAME: UNIX System Services Enhanced Reporter Support * 00070000
*                                                                     * 00080000
*01* PROPRIETARY STATEMENT=                                           * 00090000
*                                                                     * 00100000
*     LICENSED MATERIALS - PROPERTY OF IBM                            * 00110000
*     THIS MACRO IS "RESTRICTED MATERIALS OF IBM"                     * 00120000
*     5650-ZOS  COPYRIGHT IBM CORP. 2000, 2015                        * 00130001
*                                                                     * 00140000
*   STATUS= HBB77A0                                                   * 00150001
*                                                                     * 00160000
*                                                                     * 00170000
*01* EXTERNAL CLASSIFICATION:  GUPI                                   * 00180000
*01* END OF EXTERNAL CLASSIFICATION:                                  * 00190000
*                                                                     * 00200000
*01* FUNCTION:                                                        * 00210000
*                                                                     * 00220000
*      BPXEKDA macro provides an interface for an authorized reporter * 00230000
*      application to retrieve kernel data.                           * 00240000
*                                                                     * 00250000
*01* INVOCATION REQUIREMENTS:                                         * 00260000
*                                                                     * 00270000
*                                                                     * 00280000
*      Authorization:          Supervisor state.                      * 00290000
*                                                                     * 00300000
*      Dispatchable unit mode: Task                                   * 00310000
*                                                                     * 00320000
*      Cross memory mode:      PASN=HASN                              * 00330000
*                                                                     * 00340000
*      Addressing Mode:        31 bit addressing mode.                * 00350000
*                                                                     * 00360000
*      ASC mode:               Primary mode.                          * 00370000
*                                                                     * 00380000
*      Interrupt status:       Enabled for interrupts                 * 00390000
*                                                                     * 00400000
*      Locks:                  Unlocked                               * 00410000
*                                                                     * 00420000
*      Control parameters:     All parameters must be addressable by  * 00430000
*                              the caller and in the primary address  * 00440000
*                              space.                                 * 00450000
*                                                                     * 00460000
*                                                                     * 00470000
*01* INPUT REGISTERS:  GR0-GR12    Undefined                          * 00480000
*                      GR13        Points to 72-byte register         * 00490000
*                                  savearea                           * 00500000
*                      GR14-GR15   Undefined                          * 00510000
*                                                                     * 00520000
*01* OUTPUT REGISTERS: GR0-GR1     Unpredictable                      * 00530000
*                      GR2-GR13    Unchanged                          * 00540000
*                      GR14        Next Instruction Address           * 00550000
*                      GR15        Return Code                        * 00560000
*                                                                     * 00570000
*01* INVOCATION FORMAT:                                               * 00580000
*                                                                     * 00590000
* Ýxlabel¨ BPXEKDA     KBUFPTR=xkbufptr                               * 00600000
*                     ,KBUFLEN=xkbuflen                               * 00610000
*                     ,KBUFALET=xkbufalet                             * 00620000
*                     ,RETCODE=xretcode                               * 00630000
*                   ÐÝ,MF=S¨                                          * 00640000
*                   ÔÝ,MF=(L,xmfctrl»,xmfattr!0Dº)¨                   * 00650000
*                   ¿Ý,MF=(E,xmfctrl)¨                                * 00660000
*                                                                     * 00670000
*                                                                     * 00680000
*      Where:                                                         * 00690000
*                                                                     * 00700000
*                                                                     * 00710000
*      Ýxlabel¨                                                       * 00720000
*          is an optional symbol, starting in column 1, that is the   * 00730000
*          name of the BPXEKDA macro invocation.  The name must       * 00740000
*          conform to the rules for an ordinary assembler language    * 00750000
*          symbol.                                                    * 00760000
*          DEFAULT: No name.                                          * 00770000
*                                                                     * 00780000
*                                                                     * 00790000
*      KBUFPTR=xkbufptr                                               * 00800000
*          is the name (RS-type), or address in register (2)-(12), of * 00810000
*          a required 4 byte area that contains the address of a      * 00820000
*          required input/output area that is to contain the input    * 00830000
*          request data and the output data to be returned by BPXEKDA.* 00840000
*          The mapping macro BPXZODMV maps all of this input and      * 00850000
*          output data. The input request data is mapped by the       * 00860000
*          OdmvInputParms field. The remainder of the BPXZODMV mapping* 00870000
*          macro describes data that is returned by BPXEKDA when it   * 00880000
*          completes successfully.                                    * 00890000
*                                                                     * 00900000
*                                                                     * 00910000
*       KBUFLEN=xkbuflen                                              * 00920000
*          is the name (RS-type), or length in register (2)-(12), of  * 00930000
*          a required fullword field that contains the length of the  * 00940000
*          supplied buffer.  It is recommended that this buffer be    * 00950000
*          at least 1 Megabyte in length to contain all of the data   * 00960000
*          that could be returned for the input request data. Upon    * 00970000
*          successful completion, this area will be defined by the    * 00980000
*          mapping macro BPXZODMV.  If BPXEKDA is unsuccessful,       * 00990000
*          this area will contain invalid data.                       * 01000000
*                                                                     * 01010000
*                                                                     * 01020000
*       KBUFALET=xkbufalet                                            * 01030000
*          is the name (RS-type), or length in register (2)-(12), of  * 01040000
*          a required fullword field that contains the ALET of the    * 01050000
*          supplied buffer.                                           * 01060000
*                                                                     * 01070000
*                                                                     * 01080000
*      ÝRETCODE=xretcode¨                                             * 01090000
*          is the name (RS-type) of an optional fullword output       * 01100000
*          variable, or register (2)-(12), into which the return code * 01110000
*          is to be copied from GPR 15.                               * 01120000
*                                                                     * 01130000
*                                                                     * 01140000
*      ÝMF=»S!L!Eº¨                                                   * 01150000
*          is an optional keyword input which specifies the macro     * 01160000
*          form.                                                      * 01170000
*          DEFAULT: S                                                 * 01180000
*                                                                     * 01190000
*          ÝMF=S¨                                                     * 01200000
*              specifies the standard form of the macro.  The "S"     * 01210000
*              form generates code to put the parameters into an      * 01220000
*              in-line parameter list and invoke the desired service. * 01230000
*              Full checking for required macro keys is done along    * 01240000
*              with supplying defaults for optional parameters that   * 01250000
*              are not specified.                                     * 01260000
*                                                                     * 01270000
*          ÝMF=(L,xmfctrl»,xmfattr!0Dº)¨                              * 01280000
*              specifies the list form of the macro.  The "L" form    * 01290000
*              defines an area to be used for the parameter list.     * 01300000
*              Any other macro parameters are flagged as errors.      * 01310000
*                                                                     * 01320000
*            ,xmfctrl                                                 * 01330000
*              is a required input.  It is the name of a storage area * 01340000
*              for the parameter list.                                * 01350000
*                                                                     * 01360000
*            »,xmfattr!0Dº                                            * 01370000
*              is an optional 60 character input string that varies   * 01380000
*              from 1 to 60 characters. It can contain any value that * 01390000
*              is valid on an assembler DS pseudo-op. You can use     * 01400000
*              this parameter to force boundary alignment of the      * 01410000
*              parameter list.                                        * 01420000
*              DEFAULT: 0D which forces the parameter list to a       * 01430000
*              doubleword boundary.                                   * 01440000
*                                                                     * 01450000
*          ÝMF=(E,xmfctrl)¨                                           * 01460000
*              specifies the execute form of the macro.  The "E" form * 01470000
*              generates code to put the parameters into the          * 01480000
*              parameter list specified by xmfctrl and provides full  * 01490000
*              syntax checking with default setting.                  * 01500000
*                                                                     * 01510000
*            ,xmfctrl                                                 * 01520000
*              is a required input.  It is the name (RS-type), or     * 01530000
*              address in register (2)-(12), of a storage area for    * 01540000
*              the parameter list.                                    * 01550000
*                                                                     * 01560000
*                                                                     * 01570000
*                                                                     * 01580000
*01* RETURN CODES:                                                    * 01590000
*                                                                     * 01600000
*                                                                     * 01610000
*       00        The macro completed successfully.                   * 01620000
*                                                                     * 01630000
*       04        The macro was unsuccessful.  The supplied user      * 01640000
*                 user name or ASID was not found.                    * 01650000
*                                                                     * 01660000
*       08        The macro was unsuccessful.  An internal            * 01670000
*                 error occurred attempting to obtain file system     * 01680000
*                 mount data.                                         * 01690000
*                                                                     * 01700000
*       12        The macro was unsuccessful.  The supplied           * 01710000
*                 buffer was not large enough to hold all of the      * 01720000
*                 data that the macro attempted to return.            * 01730000
*                                                                     * 01740000
*       16        The macro was unsuccessful.  The input flags        * 01750000
*                 specified mutually exclusive values.                * 01760000
*                                                                     * 01770000
*       20        The macro was unsuccessful.  The caller does not    * 01780000
*                 have the correct authorization to use this service. * 01790000
*                                                                     * 01800000
*                                                                     * 01810000
*01* REASON CODES:  None.                                             * 01820000
*                                                                     * 01830000
*01* MODULE TYPE:  ASSEM MACRO                                        * 01840000
*                                                                     * 01850000
*02*   PROCESSOR:  ASSEM                                              * 01860000
*                                                                     * 01870000
*01* COMPONENT:  SCPX1                                                * 01880000
*                                                                     * 01890000
*01* DISTRIBUTION LIBRARY: AMACLIB                                    * 01900000
*                                                                     * 01910000
*01* MACRO USAGE NOTES:                                               * 01920000
*                                                                     * 01930000
*                                                                     * 01940000
*    1.  Printing of the macro expansion is controlled by the ZPRINT  * 01950000
*        global macro variable.  Any value other than 'NO' will       * 01960000
*        result in the macro expansion being printed.  The default is * 01970000
*        'YES'.  The following examples illustrate how the ZPRINT     * 01980000
*        variable should be set.                                      * 01990000
*                                                                     * 02000000
*                    GBLC &ZPRINT                                     * 02010000
*            &ZPRINT SETC 'YES'          &ZPRINT SETC 'NO'            * 02020000
*                                                                     * 02030000
*                                                                     * 02040000
*01* CHANGE-ACTIVITY:                                                 * 02050000
*                                                                     * 02060000
*   Flag LineItem  FMID    Date   ID    Comment                       * 02070000
*                                                                     * 02080000
*    $D0=DXDA382  HBB7703 990817 PDQR: Initial release                * 02090000
*    $P0=PXD0662  HBB7703 991104 PDQR: Changed descriptive name       * 02100000
*    $P1=PXD0724  HBB7703 991116 PDQR: Made the macro re-entrant      * 02110000
*    $D1=DCRC625  HBB77A0 140410 PDKG: LPA mods - AMODE64             * 02111000
*                                                                     * 02120000
****** END OF SPECIFICATIONS *****************************************/ 02130000
*/********************************************************************* 02140000
         MACRO                                                          02150000
&XLABEL  BPXEKDA &KBUFPTR=,&KBUFLEN=,&RETCODE=,&KBUFALET=,&MF=          02160000
.*                                                                      02170000
*              MACDATE -08/17/99-<3>                                    02180000
.*                                                                      02190000
.*******************************************************************    02200000
.***AB.02  GLOBAL VARIABLES TO CONTROL PRINT AND CODE GENERATION        02210000
.*******************************************************************    02220000
              GBLC  &ZPRINT     YES=PRINT NO=NO PRINT                   02230000
              GBLC  &ZTEST      YES=TEST NO=NO TEST                     02240000
              GBLC  &ZSYSTEM    PCCODE10, MVS, SAK, VM, XAX             02250000
.*                                                                      02260000
              GBLC  &ZBPXEKDA   YES=MACRO USED AT LEAST ONCE            02270000
.*******************************************************************    02280000
.***AB.03  COMMONLY USED LOCAL MACRO VARIABLES                          02290000
.*******************************************************************    02300000
              LCLC  &ZMS        ERROR MESSAGE WORK AREA                 02310000
              LCLC  &ZCNDX      LAST THREE SYSNDX CHARACTERS            02320000
              LCLC  &ZCLNG      USED WHEN LENGTH IS NEEDED              02330000
              LCLC  &ZCGPR      USED WHEN VALUE IS IN A GPR             02340000
              LCLC  &ZCVAL      USED TO CONTAIN FIXED VALUE             02350000
              LCLA  &ZAWRK      USED AS A WORK AREA                     02360000
              LCLA  &ZASIZ      USED FOR SIZE OF VALUE                  02370000
              LCLA  &ZN         NUMERIC WORK VARIABLE                   02380000
              LCLC  &ZC         CHARACTER WORK VARIABLE                 02390000
              LCLC  &ZTLC       CHARACTER TOO LONG VARIABLE             02400000
              LCLA  &ZTLA       VALUE TOO LONG VARIABLE                 02410000
              LCLA  &ZMACRET    MACRO RETURN CODE                       02420000
&ZMACRET      SETA  0           ASSUME NO ERRORS                        02430000
.*                                                                      02440000
              LCLC  &ZCSYSLIST(255)             NONXKEY, POS ARRAY      02450000
              LCLA  &ZASYSLNDX  WORK INDEX FOR ZCSYSLIST()              02460000
              LCLA  &ZPLLEN     PARAMETER LIST LENGTH                   02470000
.********************************************************************   02480000
.***AB.05  INVOKE MVS MACROS TO CONTROL CODE GENERATION                 02490000
.********************************************************************   02500000
              GBLC  &SYSSPLV    SP LEVEL 1,2,3 -SPLEVEL                 02510000
              GBLC  &SYSASCE    SYSTEM STATE P ANY AR-SYSSTATE          02520000
.*                                                                      02530000
              AIF   (K'&SYSASCE GT 0).ZSYS4     SYS STATE DEFINED       02540000
              AIF   (K'&SYSSPLV GT 0).ZSYS2     SP LEVEL DEFINED        02550000
              SPLEVEL  TEST                                             02560000
.ZSYS2        ANOP  ,                                                   02570000
              AIF   ('&SYSSPLV' EQ '1').ZSYS3   PRE SP 3.1              02580000
              AIF   ('&SYSSPLV' EQ '2').ZSYS3   PRE SP 3.1              02590000
              SYSSTATE TEST                                             02600000
              AGO   .ZSYS4                                              02610000
.ZSYS3        ANOP  ,                                                   02620000
&SYSASCE      SETC  'P'         ASSUME SYSSTATE PRIMARY                 02630000
.ZSYS4        ANOP  ,                                                   02640000
.*******************************************************************    02650000
.***AB.07  DEFINE ALL MACRO VARIABLES                                   02660000
.*******************************************************************    02670000
              LCLC  &XKBUFPTR   ++ NAME                                 02680000
              LCLC  &XKBUFLEN   ++ VALUE                                02690000
              LCLC  &XKBUFALET  ++ VALUE                                02700000
              LCLC  &XRETCODE   ++ NAME                                 02710000
              LCLC  &XMF        ++ VALUE                                02720000
              LCLC  &XMFCTRL    ++ NAME                                 02730000
              LCLC  &XMFATTR    ++ VALUE                                02740000
              LCLC  &XMFSCK     ++ VALUE                                02750000
.*******************************************************************    02760000
.***AB.13  DEFINE MACRO VARIABLES FOR INPUT/OUTPUT PROCESSING           02770000
.*******************************************************************    02780000
              LCLC  &ZXKBUFPTR  ++ OUTPUT NAME                          02790000
              LCLC  &ZXKBUFLEN  ++ INPUT VALUE                          02800000
              LCLC  &ZXKBUFALET ++ INPUT VALUE                          02810000
              LCLC  &ZXRETCODE  ++ OUTPUT NAME                          02820000
              LCLC  &ZXMF       ++ INPUT VALUE                          02830000
              LCLC  &ZXMFCTRL   ++ INPUT NAME                           02840000
              LCLC  &ZXMFATTR   ++ INPUT VALUE                          02850000
              LCLC  &ZXMFSCK    ++ INPUT VALUE                          02860000
.********************************************************************   02870000
.***AG.MF01 PROCESS MF MACRO FORMS                                      02880000
.********************************************************************   02890000
              ACTR  10000                                               02900000
.*------------------------------------------------------------------    02910000
.***AG.KKCTL01 VALUE, OPT INPUT, ME KYWRDCTL -KEYWORD CONTROL           02920000
&XMF          SETC  ''          INITIALIZE XVARIABLE                    02930000
.*-------------------------------------------------------------------   02940000
.***AG.KKCTL02 VALUE, OPT INPUT, ME KYWRDCTL -KEYWORD CONTROL           02950000
.ZG9          ANOP  ,                                                   02960000
&ZTLC         SETC 'S'                                                  02970000
              AIF   ('&MF(1)' NE '&ZTLC').ZG10                          02980000
&XMF          SETC  'S'         SET KEYWORD                             02990000
              AIF   (N'&MF LE 1).ZG9A           CK NUM                  03000000
&ZMS          SETC  '"MF='      *KPOSA* MNOTE                           03010000
&ZMS          SETC  '&ZMS.&MF"'                                         03020000
&ZMS          SETC  '&ZMS "MF"'                                         03030000
              MNOTE 8,' &ZMS CAN HAVE ONLY 1 ARGUMENT.'                 03040000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             03050000
.ZG9A         ANOP  ,                                                   03060000
.*-------------------------------------------------------------------   03070000
.***AG.KKCTL02 VALUE, OPT INPUT, ME KYWRDCTL -KEYWORD CONTROL           03080000
.ZG10         ANOP  ,                                                   03090000
&ZTLC         SETC 'L'                                                  03100000
              AIF   ('&MF(1)' NE '&ZTLC').ZG17                          03110000
&XMF          SETC  'L'         SET KEYWORD                             03120000
              AIF   (N'&MF LE 3).ZG10A          CK NUM                  03130000
&ZMS          SETC  '"MF='      *KPOSA* MNOTE                           03140000
&ZMS          SETC  '&ZMS.&MF"'                                         03150000
&ZMS          SETC  '&ZMS "MF"'                                         03160000
              MNOTE 8,' &ZMS CAN HAVE ONLY 3 ARGUMENTS.'                03170000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             03180000
.ZG10A        ANOP  ,                                                   03190000
.*-------------------------------------------------------------------   03200000
.***AG.KKCTL08 -MF(L) SPECIAL CHECK                                     03210000
              AIF   (N'&SYSLIST NE 0).ZG10B     POSITIONALS?            03220000
              AIF   ('&KBUFPTR' NE '').ZG10B    KEYS?                   03230000
              AIF   ('&KBUFLEN' NE '').ZG10B    KEYS?                   03240000
              AIF   ('&RETCODE' NE '').ZG10B    KEYS?                   03250000
              AIF   ('&KBUFALET' NE '').ZG10B   KEYS?                   03260000
              AGO    .ZG10C     INVOCATION OKAY                         03270000
.ZG10B        ANOP  ,                                                   03280000
&ZMS          SETC  'THE "L" FORM OF "MF" CANNOT'  *MFLA* MNOTE         03290000
&ZMS          SETC  '&ZMS HAVE ANY OTHER KEYWORDS OR'                   03300000
&ZMS          SETC  '&ZMS POSITIONAL PARAMETERS SPECIFIED'              03310000
              MNOTE 8,' &ZMS ON THE INVOCATION.'                        03320000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             03330000
.ZG10C        ANOP  ,                                                   03340000
.*-------------------------------------------------------------------   03350000
.***AG.KXVAR06 NAME, OPT RQD INPUT, POS(2) -XVARIABLE                   03360000
&ZXMFCTRL     SETC  'INPUT'     SET IN/OUTPUT                           03370000
&XMFCTRL      SETC  '&MF(2,1)'  SET XVARIABLE                           03380000
              AIF   (N'&MF(2) GT 1).ZG12B       MULTI PARMS             03390000
&XMFCTRL      SETC  '&MF(2)'    SET XVARIABLE                           03400000
.ZG12B        AIF   (K'&MF(2) GT 0).ZG12C                               03410000
&ZXMFCTRL     SETC  ''          RESET IN/OUTPUT                         03420000
&ZMS          SETC  'WHEN "L" IS SPECIFIED'     *KRQDA*                 03430000
&ZMS          SETC  '&ZMS FOR THE "MF" KEY, POSITIONAL'                 03440000
              MNOTE 8,' &ZMS ARG 2 IS REQUIRED.'                        03450000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             03460000
.ZG12C        ANOP  ,                                                   03470000
.*-------------------------------------------------------------------   03480000
.***AG.KCK01 NAME, OPT RQD INPUT, POS(2) -GPR NOT ALLOWED               03490000
              AIF   (K'&ZXMFCTRL LE 0).ZG12P    NOT I/O                 03500000
              AIF   ('&XMFCTRL'(1,1) NE '(').ZG12P                      03510000
&ZXMFCTRL     SETC  ''          RESET IN/OUTPUT                         03520000
&ZMS          SETC  '"MF='      *KGPRA* MNOTE                           03530000
&ZMS          SETC  '&ZMS.&MF"'                                         03540000
&ZMS          SETC  '&ZMS CONTAINS GPR NOTATION WHICH IS NOT'           03550000
              MNOTE 8,' &ZMS ALLOWED FOR ARGUMENT 2.'                   03560000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             03570000
.ZG12P        ANOP  ,                                                   03580000
.*-------------------------------------------------------------------   03590000
.***AG.KXVAR13 VALUE, OPT INPUT, POS(3) -XVARIABLE                      03600000
&ZXMFATTR     SETC  'INPUT'     SET IN/OUTPUT                           03610000
&XMFATTR      SETC  '0D'                                                03620000
              AIF   (K'&MF(3) LE 0).ZG15B       PARM                    03630000
&XMFATTR      SETC  '&MF(3,1)'  SET XVARIABLE                           03640000
              AIF   (N'&MF(3) GT 1).ZG15B       MULTI PARMS             03650000
&XMFATTR      SETC  '&MF(3)'    SET XVARIABLE                           03660000
.ZG15B        ANOP  ,                                                   03670000
.*-------------------------------------------------------------------   03680000
.***AG.KCK01 VALUE, OPT INPUT, POS(3) -GPR NOT ALLOWED                  03690000
              AIF   (K'&ZXMFATTR LE 0).ZG15P    NOT I/O                 03700000
              AIF   ('&XMFATTR'(1,1) NE '(').ZG15P                      03710000
&ZXMFATTR     SETC  ''          RESET IN/OUTPUT                         03720000
&ZMS          SETC  '"MF='      *KGPRA* MNOTE                           03730000
&ZMS          SETC  '&ZMS.&MF"'                                         03740000
&ZMS          SETC  '&ZMS CONTAINS GPR NOTATION WHICH IS NOT'           03750000
              MNOTE 8,' &ZMS ALLOWED FOR ARGUMENT 3.'                   03760000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             03770000
.ZG15P        ANOP  ,                                                   03780000
.*-------------------------------------------------------------------   03790000
.***AG.KCK03 VALUE, OPT INPUT, POS(3) -CHARACTER LENGTH                 03800000
              AIF   (K'&ZXMFATTR LE 0).ZG15S    NOT I/O                 03810000
              AIF   (K'&XMFATTR LE 60).ZG15S    LNG OK                  03820000
&ZXMFATTR     SETC  ''          RESET IN/OUTPUT                         03830000
&ZMS          SETC  '"MF='      *KLNGA* MNOTE                           03840000
&ZMS          SETC  '&ZMS.&MF"'                                         03850000
&ZMS          SETC  '&ZMS ARGUMENT 3 EXCEEDS THE MAXIMUM'               03860000
              MNOTE 8,' &ZMS LENGTH OF 60 CHARACTERS.'                  03870000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             03880000
.ZG15S        ANOP  ,                                                   03890000
.*-------------------------------------------------------------------   03900000
.***AG.KKCTL02 VALUE, OPT INPUT, ME KYWRDCTL -KEYWORD CONTROL           03910000
.ZG17         ANOP  ,                                                   03920000
&ZTLC         SETC 'E'                                                  03930000
              AIF   ('&MF(1)' NE '&ZTLC').ZG25                          03940000
&XMF          SETC  'E'         SET KEYWORD                             03950000
              AIF   (N'&MF LE 2).ZG17A          CK NUM                  03960000
&ZMS          SETC  '"MF='      *KPOSA* MNOTE                           03970000
&ZMS          SETC  '&ZMS.&MF"'                                         03980000
&ZMS          SETC  '&ZMS "MF"'                                         03990000
              MNOTE 8,' &ZMS CAN HAVE ONLY 2 ARGUMENTS.'                04000000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             04010000
.ZG17A        ANOP  ,                                                   04020000
.*-------------------------------------------------------------------   04030000
.***AG.KXVAR06 NAME, OPT RQD INPUT, POS(2) -XVARIABLE                   04040000
&ZXMFCTRL     SETC  'INPUT'     SET IN/OUTPUT                           04050000
&XMFCTRL      SETC  '&MF(2,1)'  SET XVARIABLE                           04060000
              AIF   (N'&MF(2) GT 1).ZG19B       MULTI PARMS             04070000
&XMFCTRL      SETC  '&MF(2)'    SET XVARIABLE                           04080000
.ZG19B        AIF   (K'&MF(2) GT 0).ZG19C                               04090000
&ZXMFCTRL     SETC  ''          RESET IN/OUTPUT                         04100000
&ZMS          SETC  'WHEN "E" IS SPECIFIED'     *KRQDA*                 04110000
&ZMS          SETC  '&ZMS FOR THE "MF" KEY, POSITIONAL'                 04120000
              MNOTE 8,' &ZMS ARG 2 IS REQUIRED.'                        04130000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             04140000
.ZG19C        ANOP  ,                                                   04150000
.*-------------------------------------------------------------------   04160000
.***AG.KCK02 NAME, OPT RQD INPUT, POS(2) -GPR OUT OF RANGE              04170000
              AIF   (K'&ZXMFCTRL LE 0).ZG19R    NOT I/O                 04180000
              AIF   ('&XMFCTRL'(1,1) NE '(').ZG19R                      04190000
&ZCGPR        SETC  '&XMFCTRL'(2,K'&XMFCTRL-2)                          04200000
              AIF   ('&ZCGPR'(1,1) NE '0').ZG19P                        04210000
              AIF   (K'&ZCGPR GT 2).ZG19Q                               04220000
              AIF   ('&ZCGPR' EQ '0').ZG19Q                             04230000
&ZCGPR        SETC  '&ZCGPR'(2,1)                                       04240000
              AIF   (T'&ZCGPR NE 'N').ZG19Q     INVALID REG NAME        04250000
.ZG19P        ANOP  ,                                                   04260000
              AIF   (T'&ZCGPR NE 'N').ZG19R     NON NUMERIC             04270000
              AIF   ('&ZCGPR' LT '2').ZG19Q                             04280000
              AIF   ('&ZCGPR' LE '12').ZG19R                            04290000
.ZG19Q        ANOP  ,                                                   04300000
&ZMS          SETC  '"MF='      *KGPRA* MNOTE                           04310000
&ZMS          SETC  '&ZMS.&MF"'                                         04320000
&ZMS          SETC  '&ZMS ARGUMENT 2 MUST SPECIFY A REGISTER'           04330000
              MNOTE 8,' &ZMS IN THE RANGE (2)-(12).'                    04340000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             04350000
.ZG19R        ANOP  ,                                                   04360000
.*-------------------------------------------------------------------   04370000
.***AG.KKWRD02 VALUE, OPT INPUT, ME KEYWORD -SINGLE KEYWORD             04380000
&XMFSCK       SETC  'COMPLETE'  SET KEYWORD                             04390000
.*-------------------------------------------------------------------   04400000
.***AG.KKWRD03 VALUE, OPT INPUT, ME KEYWORD -SINGLE KEYWORD             04410000
&ZXMFSCK      SETC  'INPUT'     SET IN/OUTPUT                           04420000
.*------------------------------------------------------------------    04430000
.***AG.KKCTL04 VALUE, OPT INPUT, ME KYWRDCTL -KEYWORD CONTROL           04440000
.ZG25         ANOP  ,                                                   04450000
&ZXMF         SETC  'INPUT'     SET IN/OUTPUT                           04460000
              AIF   (K'&XMF GT 0).ZG25E         VALID ARG               04470000
              AIF   (T'&MF EQ 'O').ZG25D        OMITTED                 04480000
&ZASYSLNDX    SETA  0                                                   04490000
.ZG25A        ANOP  ,           POSITIONAL MACRO KEY                    04500000
&ZASYSLNDX    SETA  &ZASYSLNDX+1                                        04510000
              AIF   (&ZASYSLNDX GT N'&SYSLIST).ZG25C                    04520000
&ZTLC         SETC 'MF'                                                 04530000
              AIF   ('&SYSLIST(&ZASYSLNDX)' NE '&ZTLC').ZG25A           04540000
.ZG25B        ANOP  ,                                                   04550000
&ZXMF         SETC  ''          RESET IN/OUTPUT                         04560000
&ZMS          SETC  'THE "MF" KEY'              *KOPTA* MNOTE           04570000
&ZMS          SETC  '&ZMS MUST CONTAIN ONE'                             04580000
              MNOTE 8,' &ZMS (OR MORE) ARGUMENT(S).'                    04590000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             04600000
              AGO   .ZG25E                                              04610000
.ZG25C        ANOP  ,                                                   04620000
&ZXMF         SETC  ''          RESET IN/OUTPUT                         04630000
&ZMS          SETC  '"MF='      *KUKWA* MNOTE                           04640000
&ZMS          SETC  '&ZMS.&MF"'                                         04650000
&ZMS          SETC  '&ZMS ARGUMENT 1 IS AN UNKNOWN KEYWORD. '           04660000
&ZMS          SETC  '&ZMS VALID KEYWORD CHOICE(S) ARE:'                 04670000
&ZMS          SETC  '&ZMS "S",'                 VALID KEYWORD           04680000
&ZMS          SETC  '&ZMS "L",'                 VALID KEYWORD           04690000
              MNOTE 8,' &ZMS OR "E".'                                   04700000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             04710000
              AGO   .ZG25E                                              04720000
.ZG25D        ANOP  ,                                                   04730000
&XMF          SETC  'S'         SET DEFAULT KEYWORD                     04740000
&XMFSCK       SETC  'COMPLETE'  COMPLETE CHECKING                       04750000
.ZG25E        ANOP  ,                                                   04760000
.********************************************************************   04770000
.***AG.MF02  FULL MACRO SYNTAX CHECKING                                 04780000
.********************************************************************   04790000
              ACTR  10000                                               04800000
.*-------------------------------------------------------------------   04810000
.***AG.MF03 MF=(SLE)                                                    04820000
              AIF   ('&XMF' EQ 'L').ZGMFX                               04830000
.*-------------------------------------------------------------------   04840000
.***AG.KXVAR05 NAME, RQD OUTPUT, KEYS -XVARIABLE KEY                    04850000
              AIF   (N'&KBUFPTR LE 1).ZG2A      CK NUM                  04860000
&ZMS          SETC  '"KBUFPTR='                 *KPOSA* MNOTE           04870000
&ZMS          SETC  '&ZMS.&KBUFPTR"'                                    04880000
&ZMS          SETC  '&ZMS "KBUFPTR"'                                    04890000
              MNOTE 8,' &ZMS CAN HAVE ONLY 1 ARGUMENT.'                 04900000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             04910000
.ZG2A         ANOP  ,                                                   04920000
.*------------------------------------------------------------------    04930000
.***AG.KXVAR06 NAME, RQD OUTPUT, KEYS -XVARIABLE                        04940000
&ZXKBUFPTR    SETC  'OUTPUT'    SET IN/OUTPUT                           04950000
&XKBUFPTR     SETC  '&KBUFPTR(1)'               SET XVARIABLE           04960000
              AIF   (N'&KBUFPTR GT 1).ZG2B      MULTI PARMS             04970000
&XKBUFPTR     SETC  '&KBUFPTR'  SET XVARIABLE                           04980000
.ZG2B         AIF   (K'&KBUFPTR(1) GT 0).ZG2C                           04990000
&ZXKBUFPTR    SETC  ''          RESET IN/OUTPUT                         05000000
&ZMS          SETC  ' '         *KRQDA*                                 05010000
&ZMS          SETC  '&ZMS "KBUFPTR" KEY AND ITS ARGUMENT'               05020000
              MNOTE 8,' &ZMS ARE REQUIRED.'                             05030000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             05040000
.ZG2C         ANOP  ,                                                   05050000
.*-------------------------------------------------------------------   05060000
.***AG.KCK02 NAME, RQD OUTPUT, KEYS -GPR OUT OF RANGE                   05070000
              AIF   (K'&ZXKBUFPTR LE 0).ZG2R    NOT I/O                 05080000
              AIF   ('&XKBUFPTR'(1,1) NE '(').ZG2R                      05090000
&ZCGPR        SETC  '&XKBUFPTR'(2,K'&XKBUFPTR-2)                        05100000
              AIF   ('&ZCGPR'(1,1) NE '0').ZG2P                         05110000
              AIF   (K'&ZCGPR GT 2).ZG2Q                                05120000
              AIF   ('&ZCGPR' EQ '0').ZG2Q                              05130000
&ZCGPR        SETC  '&ZCGPR'(2,1)                                       05140000
              AIF   (T'&ZCGPR NE 'N').ZG2Q      INVALID REG NAME        05150000
.ZG2P         ANOP  ,                                                   05160000
              AIF   (T'&ZCGPR NE 'N').ZG2R      NON NUMERIC             05170000
              AIF   ('&ZCGPR' LT '2').ZG2Q                              05180000
              AIF   ('&ZCGPR' LE '12').ZG2R                             05190000
.ZG2Q         ANOP  ,                                                   05200000
&ZMS          SETC  '"KBUFPTR='                 *KGPRA* MNOTE           05210000
&ZMS          SETC  '&ZMS.&KBUFPTR"'                                    05220000
&ZMS          SETC  '&ZMS ARGUMENT 1 MUST SPECIFY A REGISTER'           05230000
              MNOTE 8,' &ZMS IN THE RANGE (2)-(12).'                    05240000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             05250000
.ZG2R         ANOP  ,                                                   05260000
.*-------------------------------------------------------------------   05270000
.*** * * * * * NAME, RQD INPUT, KEYS -XVARIABLE KEY                     05280000
              AIF   (N'&KBUFLEN LE 1).DC00A     CK NUM                  05290000
&ZMS          SETC  '"KBUFLEN='                 *KPOSA* MNOTE           05300000
&ZMS          SETC  '&ZMS.&KBUFLEN"'                                    05310000
&ZMS          SETC  '&ZMS "KBUFLEN"'                                    05320000
              MNOTE 8,' &ZMS CAN HAVE ONLY 1 ARGUMENT.'                 05330000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             05340000
.DC00A        ANOP  ,                                                   05350000
.*--------------------------------------------------------------------  05360000
.*** * * * * * NAME, RQD INPUT, KEYS -XVARIABLE                         05370000
&ZXKBUFLEN    SETC  'INPUT'                     SET IN/OUTPUT           05380000
&XKBUFLEN     SETC  '&KBUFLEN(1)'               SET XVARIABLE           05390000
              AIF   (N'&KBUFLEN GT 1).DC01B     MULTI PARMS             05400000
&XKBUFLEN     SETC  '&KBUFLEN'                  SET XVARIABLE           05410000
.DC01B        AIF   (K'&KBUFLEN(1) GT 0).DC01C                          05420000
&ZXKBUFLEN    SETC  ''                          RESET IN/OUTPUT         05430000
&ZMS          SETC  ' '                                                 05440000
&ZMS          SETC  '&ZMS "KBUFLEN" KEY AND ITS ARGUMENT'               05450000
              MNOTE 8,' &ZMS ARE REQUIRED.'                             05460000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             05470000
.DC01C        ANOP  ,                                                   05480000
.*--------------------------------------------------------------------  05490000
.*** * * * * NAME, RQD INPUT, KEYS -GPR OUT OF RANGE                    05500000
              AIF   (K'&ZXKBUFLEN LE 0).DC02R   NOT I/O                 05510000
              AIF   ('&XKBUFLEN' EQ '0').DC02R                          05520000
              AIF   ('&XKBUFLEN'(1,1) NE '(').DC02R                     05530000
&ZCGPR        SETC  '&XKBUFLEN'(2,K'&XKBUFLEN-2)                        05540000
              AIF   ('&ZCGPR'(1,1) NE '0').DC02P                        05550000
              AIF   (K'&ZCGPR GT 2).DC02Q                               05560000
              AIF   ('&ZCGPR' EQ '0').DC02Q                             05570000
&ZCGPR        SETC  '&ZCGPR'(2,1)                                       05580000
              AIF   (T'&ZCGPR NE 'N').DC02Q     INVALID REG NAME        05590000
.DC02P        ANOP  ,                                                   05600000
              AIF   (T'&ZCGPR NE 'N').DC02R     NON NUMERIC             05610000
              AIF   ('&ZCGPR' LT '2').DC02Q                             05620000
              AIF   ('&ZCGPR' LE '12').DC02R                            05630000
.DC02Q        ANOP  ,                                                   05640000
&ZMS          SETC  '"KBUFLEN='                 *KGPRA* MNOTE           05650000
&ZMS          SETC  '&ZMS.&KBUFLEN"'                                    05660000
&ZMS          SETC  '&ZMS ARGUMENT 1 MUST SPECIFY A REGISTER'           05670000
              MNOTE 8,' &ZMS IN THE RANGE (2)-(12).'                    05680000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             05690000
.DC02R        ANOP  ,                                                   05700000
.*-------------------------------------------------------------------   05710000
.*** * * * * * NAME, RQD INPUT, KEYS -XVARIABLE KEY                     05720000
              AIF   (N'&KBUFALET LE 1).DC10A    CK NUM                  05730000
&ZMS          SETC  '"KBUFALET='                *KPOSA* MNOTE           05740000
&ZMS          SETC  '&ZMS.&KBUFALET"'                                   05750000
&ZMS          SETC  '&ZMS "KBUFALET"'                                   05760000
              MNOTE 8,' &ZMS CAN HAVE ONLY 1 ARGUMENT.'                 05770000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             05780000
.DC10A        ANOP  ,                                                   05790000
.*--------------------------------------------------------------------  05800000
.*** * * * * * NAME, RQD INPUT, KEYS -XVARIABLE                         05810000
&ZXKBUFALET   SETC  'INPUT'                     SET IN/OUTPUT           05820000
&XKBUFALET    SETC  '&KBUFALET(1)'              SET XVARIABLE           05830000
              AIF   (N'&KBUFALET GT 1).DC11B    MULTI PARMS             05840000
&XKBUFALET    SETC  '&KBUFALET'                 SET XVARIABLE           05850000
.DC11B        AIF   (K'&KBUFALET(1) GT 0).DC11C                         05860000
&ZXKBUFALET   SETC  ''                          RESET IN/OUTPUT         05870000
&ZMS          SETC  ' '                                                 05880000
&ZMS          SETC  '&ZMS "KBUFALET" KEY AND ITS ARGUMENT'              05890000
              MNOTE 8,' &ZMS ARE REQUIRED.'                             05900000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             05910000
.DC11C        ANOP  ,                                                   05920000
.*--------------------------------------------------------------------  05930000
.*** * * * * NAME, RQD INPUT, KEYS -GPR OUT OF RANGE                    05940000
              AIF   (K'&ZXKBUFALET LE 0).DC12R  NOT I/O                 05950000
              AIF   ('&XKBUFALET' EQ '0').DC12R                         05960000
              AIF   ('&XKBUFALET'(1,1) NE '(').DC12R                    05970000
&ZCGPR        SETC  '&XKBUFALET'(2,K'&XKBUFALET-2)                      05980000
              AIF   ('&ZCGPR'(1,1) NE '0').DC12P                        05990000
              AIF   (K'&ZCGPR GT 2).DC12Q                               06000000
              AIF   ('&ZCGPR' EQ '0').DC12Q                             06010000
&ZCGPR        SETC  '&ZCGPR'(2,1)                                       06020000
              AIF   (T'&ZCGPR NE 'N').DC12Q     INVALID REG NAME        06030000
.DC12P        ANOP  ,                                                   06040000
              AIF   (T'&ZCGPR NE 'N').DC12R     NON NUMERIC             06050000
              AIF   ('&ZCGPR' LT '2').DC12Q                             06060000
              AIF   ('&ZCGPR' LE '12').DC12R                            06070000
.DC12Q        ANOP  ,                                                   06080000
&ZMS          SETC  '"KBUFALET='                *KGPRA* MNOTE           06090000
&ZMS          SETC  '&ZMS.&KBUFALET"'                                   06100000
&ZMS          SETC  '&ZMS ARGUMENT 1 MUST SPECIFY A REGISTER'           06110000
              MNOTE 8,' &ZMS IN THE RANGE (2)-(12).'                    06120000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             06130000
.DC12R        ANOP  ,                                                   06140000
.*-------------------------------------------------------------------   06150000
.***AG.KXVAR05 NAME, OPT OUTPUT, KEYS -XVARIABLE KEY                    06160000
              AIF   (N'&RETCODE LE 1).ZG5A      CK NUM                  06170000
&ZMS          SETC  '"RETCODE='                 *KPOSA* MNOTE           06180000
&ZMS          SETC  '&ZMS.&RETCODE"'                                    06190000
&ZMS          SETC  '&ZMS "RETCODE"'                                    06200000
              MNOTE 8,' &ZMS CAN HAVE ONLY 1 ARGUMENT.'                 06210000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             06220000
.ZG5A         ANOP  ,                                                   06230000
.*-------------------------------------------------------------------   06240000
.***AG.KXVAR14 NAME, OPT OUTPUT, KEYS -XVARIABLE                        06250000
              AIF   (K'&RETCODE(1) LE 0).ZG5C   NO PARM                 06260000
&ZXRETCODE    SETC  'OUTPUT'    SET OUTPUT                              06270000
&XRETCODE     SETC  '&RETCODE(1)'               SET XVARIABLE           06280000
              AIF   (N'&RETCODE GT 1).ZG5C                              06290000
&XRETCODE     SETC  '&RETCODE'  SET XVARIABLE                           06300000
.ZG5C         ANOP  ,                                                   06310000
.*-------------------------------------------------------------------   06320000
.***AG.KCK02 NAME, OPT OUTPUT, KEYS -GPR OUT OF RANGE                   06330000
              AIF   (K'&ZXRETCODE LE 0).ZG5R    NOT I/O                 06340000
              AIF   ('&XRETCODE'(1,1) NE '(').ZG5R                      06350000
&ZCGPR        SETC  '&XRETCODE'(2,K'&XRETCODE-2)                        06360000
              AIF   ('&ZCGPR'(1,1) NE '0').ZG5P                         06370000
              AIF   (K'&ZCGPR GT 2).ZG5Q                                06380000
              AIF   ('&ZCGPR' EQ '0').ZG5Q                              06390000
&ZCGPR        SETC  '&ZCGPR'(2,1)                                       06400000
              AIF   (T'&ZCGPR NE 'N').ZG5Q      INVALID REG NAME        06410000
.ZG5P         ANOP  ,                                                   06420000
              AIF   (T'&ZCGPR NE 'N').ZG5R      NON NUMERIC             06430000
              AIF   ('&ZCGPR' LT '2').ZG5Q                              06440000
              AIF   ('&ZCGPR' LE '12').ZG5R                             06450000
.ZG5Q         ANOP  ,                                                   06460000
&ZMS          SETC  '"RETCODE='                 *KGPRA* MNOTE           06470000
&ZMS          SETC  '&ZMS.&RETCODE"'                                    06480000
&ZMS          SETC  '&ZMS ARGUMENT 1 MUST SPECIFY A REGISTER'           06490000
              MNOTE 8,' &ZMS IN THE RANGE (2)-(12).'                    06500000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             06510000
.ZG5R         ANOP  ,                                                   06520000
.******************************************************************     06530000
.***AH.P00 CHECK STANDALONE POSITIONAL VARIABLES                        06540000
.******************************************************************     06550000
              ACTR  10000                                               06560000
.*-------------------------------------------------------------------   06570000
.***AH.P02 EXTRA POSITIONALS                                            06580000
              AIF   (N'&SYSLIST LE 0).ZGLISTX   NO EXTRAS               06590000
&ZCVAL        SETC  ''          ERROR FIELD                             06600000
&ZAWRK        SETA  0           POSITIONAL NUMBER                       06610000
.ZGLIST2      ANOP  ,                                                   06620000
&ZAWRK        SETA  &ZAWRK+1    NEXT POSITIONAL                         06630000
              AIF   (&ZAWRK GT N'&SYSLIST).ZGLIST3  DONE                06640000
&ZCVAL        SETC '&ZCVAL,&SYSLIST(&ZAWRK)'    EXTRA                   06650000
              AGO   .ZGLIST2                                            06660000
.*                                                                      06670000
.ZGLIST3      ANOP  ,                                                   06680000
&ZCVAL        SETC '&ZCVAL'(2,K'&ZCVAL-1)       STRIP COMMA             06690000
&ZMS          SETC  'POSITIONAL ARGUMENT(S),'   *PPOSA* MNOTE           06700000
&ZMS          SETC  '&ZMS "&ZCVAL"'                                     06710000
&ZMS          SETC  '&ZMS CANNOT BE USED.'                              06720000
&ZMS          SETC  '&ZMS NO POSITIONAL ARGUMENTS'                      06730000
              MNOTE 8,' &ZMS ARE ALLOWED.'                              06740000
&ZMACRET      SETA  8           SET MACRO ERROR RETURN CODE             06750000
.ZGLISTX      ANOP  ,                                                   06760000
&ZASYSLNDX    SETA  0                                                   06770000
.*-------------------------------------------------------------------   06780000
.***AG.MF04 MF=(SLE)                                                    06790000
.ZGMFX        ANOP  ,           END OF FULL SYNTAX CHECK                06800000
.*******************************************************************    06810000
.***AE.ZMR01 NO CODE GENERATED IF ERRORS DETECTED                       06820000
.*******************************************************************    06830000
              AIF   (&ZMACRET NE 0).ZLX2        ERROR DETECTED          06840000
.*******************************************************************    06850000
.***AE.01  START OF BPXEKDA MACRO CODE                                  06860000
.*******************************************************************    06870000
              LCLC  &M0M0001                 NAME                       06880000
&M0M0001      SETC  '&XLABEL'                SET NAME                   06890000
              AIF   (K'&XLABEL NE 0).XLAB2                              06900000
&M0M0001      SETC  'M00M&SYSNDX'            DEFAULT NAME               06910000
.*                                                                      06920000
.XLAB2        ANOP  ,                                                   06930000
              AIF   ('&XMF' NE 'L').XLAB3     NOT MF=L       /* @P1A*/  06940000
&M0M0001      DS    &XMFATTR                  BPXEKDA-0      /* @P1A*/  06950000
.XLAB3        ANOP  ,                                        /* @P1A*/  06960000
.*******************************************************************    06970000
.***AE.PR01 PRINT CONTROLS, DEFAULT IS YES                              06980000
.*******************************************************************    06990000
              PUSH  PRINT                                               07000000
              AIF   ('&ZPRINT' NE 'NO').ZPRINTX  TURN PRINT ON          07010000
              PRINT OFF         ++ PR01                                 07020000
              AGO   .ZPRNTXX                                            07030000
.ZPRINTX      PRINT ON                                                  07040000
.ZPRNTXX      ANOP  ,                                                   07050000
.*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*  07060000
.*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*  07070000
.********************************************************************   07080000
.***AL.A01  INTERNAL ARRAY TO PRODUCE FORMATTED CODE                    07090000
.********************************************************************   07100000
                      LCLA  &ZOPN          LIST INSTRUCTION INDEX       07110000
                      LCLA  &ZOPN1         INVOCATION INDEX             07120000
                      LCLC  &ZOPL(4095)    LABEL                        07130000
                      LCLC  &ZOPO(4095)    OPERATION                    07140000
                      LCLC  &ZOPV(4095)    VALUE                        07150000
                      LCLC  &ZOPD(4095)    DESCRIPTION                  07160000
.*                                                                      07170000
&ZOPN                 SETA  0              INITIAL INST INDEX VALUE     07180000
.*-------------------------------------------------------------------   07190000
.***AL.A10 SET ZPLLEN                                                   07200000
&ZPLLEN               SETA 8                                            07210000
.******************************************************************     07220000
.***AL.A05 BPXEKDA FMT=ARG MF=S PARAMETER AREA                          07230000
.******************************************************************     07240000
                      AIF   ('&XMF' NE 'S').ZLMFSX  NOT STANDARD MF     07250000
&XMFCTRL              SETC  '#Z'.'&SYSNDX'(2,3).'A'                     07260000
.*                                                                      07270000
&ZOPN                 SETA  &ZOPN+1                                     07280000
&ZOPL(&ZOPN)          SETC  ' '                                         07290000
&ZOPO(&ZOPN)          SETC  'B'                                         07300000
&ZOPV(&ZOPN)          SETC  '&XMFCTRL.S'                                07310000
&ZOPD(&ZOPN)          SETC  '++ BPXEKDA ARG PARMS'                      07320000
.*                                                                      07330000
&ZOPN                 SETA  &ZOPN+1                                     07340000
&ZOPL(&ZOPN)          SETC  '&XMFCTRL'                                  07350000
&ZOPO(&ZOPN)          SETC  'DS'                                        07360000
&ZOPV(&ZOPN)          SETC  'A'                                         07370000
&ZOPD(&ZOPN)          SETC  '++ START OF BPXEKDA ARG PARMS'  /* @P1C*/  07380000
.*                                                                      07390000
&ZOPN                 SETA  &ZOPN+1                                     07400000
&ZOPL(&ZOPN)          SETC  ' '                                         07410000
&ZOPO(&ZOPN)          SETC  'DS'                                        07420000
&ZOPV(&ZOPN)          SETC  'A'                                         07430000
&ZOPD(&ZOPN)          SETC  ' '                                         07440000
.*                                                                      07450000
&ZOPN                 SETA  &ZOPN+1                                     07460000
&ZOPL(&ZOPN)          SETC  ' '                                         07470000
&ZOPO(&ZOPN)          SETC  'DS'                                        07480000
&ZOPV(&ZOPN)          SETC  'A'                                         07490000
&ZOPD(&ZOPN)          SETC  ' '                                         07500000
.*                                                                      07510000
.*-------------------------------------------------------------------   07520000
.***AL.A07 BPXEKDA FMT=ARG MF=S PARAMETERS                              07530000
&ZOPN                 SETA  &ZOPN+1                                     07540000
&ZOPL(&ZOPN)          SETC  '&XMFCTRL.S'                                07550000
&ZOPO(&ZOPN)          SETC  'DC'                                        07560000
&ZOPV(&ZOPN)          SETC  '0H''0'''                                   07570000
&ZOPD(&ZOPN)          SETC  '++ END OF BPXEKDA ARG PARMS'    /* @P1C*/  07580000
.*                                                                      07590000
.ZLMFSX               ANOP  ,                                           07600000
.******************************************************************     07610000
.***AL.AL01 BPXEKDA FMT=ARG MF=L PARAMETER AREA                         07620000
.******************************************************************     07630000
                      AIF   ('&XMF' NE 'L').ZLMFLX  NOT MF=L            07640000
&ZOPN                 SETA  &ZOPN+1                                     07650000
&ZOPL(&ZOPN)          SETC  '&XMFCTRL'                                  07660000
&ZOPO(&ZOPN)          SETC  'DS'                                        07670000
&ZOPV(&ZOPN)          SETC  '&XMFATTR'                                  07680000
&ZOPD(&ZOPN)          SETC  '++ BPXEKDA ARG PARMS'                      07690000
.*                                                                      07700000
&ZOPN                 SETA  &ZOPN+1                                     07710000
&ZOPL(&ZOPN)          SETC  ' '                              /* @P1C*/  07720000
&ZOPO(&ZOPN)          SETC  'DS'                                        07730000
&ZOPV(&ZOPN)          SETC  'A'                                         07740000
&ZOPD(&ZOPN)          SETC  '++ BUFFER'                      /* @P1C*/  07750000
.*                                                                      07760000
&ZOPN                 SETA  &ZOPN+1                                     07770000
&ZOPL(&ZOPN)          SETC  ' '                              /* @P1C*/  07780000
&ZOPO(&ZOPN)          SETC  'DS'                                        07790000
&ZOPV(&ZOPN)          SETC  'A'                                         07800000
&ZOPD(&ZOPN)          SETC  '++ LENGTH'                      /* @P1C*/  07810000
.*                                                                      07820000
&ZOPN                 SETA  &ZOPN+1                                     07830000
&ZOPL(&ZOPN)          SETC  ' '                              /* @P1C*/  07840000
&ZOPO(&ZOPN)          SETC  'DS'                                        07850000
&ZOPV(&ZOPN)          SETC  'A'                                         07860000
&ZOPD(&ZOPN)          SETC  '++ ALET'                        /* @P1C*/  07870000
.*-------------------------------------------------------------------   07880000
.***AL.AL08 BPXEKDA FMT=ARG MF=L PARAMETER AREA DEFINED                 07890000
                      AGO   .ZMFLX         EXIT, MF=L DONE              07900000
.*                                                                      07910000
.ZLMFLX               ANOP  ,                                           07920000
.********************************************************************   07930000
.***AI.A01 BPXEKDA FMT=ARG FILL IN PARAMETER AREA                       07940000
.********************************************************************   07950000
                      ACTR  10000                                       07960000
&ZCVAL                SETC  'LA'           ASSUME XA MODE               07970000
                      AIF   ('&SYSASCE' EQ 'P').ZIMFXA  SYSTATE PRI     07980000
&ZCVAL                SETC  'LAE'          XAX MODE                     07990000
.ZIMFXA               ANOP ,                                            08000000
.*                                                                      08010000
                      AIF   ('&XMFCTRL'(1,1) NE '(').ZIMFN2  NOT GPR    08020000
&ZCGPR                SETC  '&XMFCTRL'(2,K'&XMFCTRL-2)  GET GPR         08030000
                      AIF   ('&ZCGPR' EQ 'GPR1').ZIMFNX                 08040000
                      AIF   ('&ZCGPR' EQ 'GPR01').ZIMFNX                08050000
                      AIF   ('&ZCGPR' EQ 'REG1').ZIMFNX                 08060000
                      AIF   ('&ZCGPR' EQ 'REG01').ZIMFNX                08070000
                      AIF   ('&ZCGPR' EQ 'R1').ZIMFNX                   08080000
                      AIF   ('&ZCGPR' EQ '1').ZIMFNX                    08090000
                      AIF   ('&ZCGPR' EQ '01').ZIMFNX                   08100000
&ZOPN                 SETA  &ZOPN+1                                     08110000
&ZOPL(&ZOPN)          SETC  ' '                                         08120000
&ZOPO(&ZOPN)          SETC  '&ZCVAL'                                    08130000
&ZOPV(&ZOPN)          SETC  '1,0(,&ZCGPR)'                              08140000
&ZOPD(&ZOPN)          SETC  '++ LOCATE ARG PARMS'                       08150000
                      AGO   .ZIMFNX                                     08160000
.*                                                                      08170000
.ZIMFN2               ANOP ,                                            08180000
&ZOPN                 SETA  &ZOPN+1                                     08190000
&ZOPL(&ZOPN)          SETC  ' '                                         08200000
&ZOPO(&ZOPN)          SETC  '&ZCVAL'                                    08210000
&ZOPV(&ZOPN)          SETC  '1,&XMFCTRL'                                08220000
&ZOPD(&ZOPN)          SETC  '++ LOCATE ARG PARMS'                       08230000
.ZIMFNX               ANOP ,                                            08240000
.*-------------------------------------------------------------------   08250000
.***AI.A06 BIND=NAME ADDR XKBUFPTR OUTPUT                               08260000
         AIF   ('&ZXKBUFPTR' EQ '').ZI2G   NOT USED                     08270000
&ZCGPR   SETC  '14'                                                     08280000
         AIF   ('&XKBUFPTR'(1,1) NE '(').ZI2A  NOT IN GPR               08290000
&ZCGPR                SETC  '&XKBUFPTR'(2,K'&XKBUFPTR-2)                08300000
.*                                                                      08310000
&ZOPN                 SETA  &ZOPN+1                                     08320000
&ZOPL(&ZOPN)          SETC  ' '                                         08330000
&ZOPO(&ZOPN)          SETC  'ST'                                        08340000
&ZOPV(&ZOPN)          SETC  '&ZCGPR,0(,1)'                   /* @P1C*/  08350000
&ZOPD(&ZOPN)          SETC  '++ STORE Address of Buffer Pointer' @P1C   08360000
.*                                                                      08370000
         AGO   .ZI2G                                                    08380000
.ZI2A                 ANOP  ,                                           08390000
.*                                                                      08400000
&ZOPN                 SETA  &ZOPN+1                                     08410000
&ZOPL(&ZOPN)          SETC  ' '                                         08420000
&ZOPO(&ZOPN)          SETC  '&ZCVAL'                                    08430000
&ZOPV(&ZOPN)          SETC  '&ZCGPR,&XKBUFPTR'               /* @P1C*/  08440000
&ZOPD(&ZOPN)          SETC  '++ LOAD BUFFER POINTER address'            08450000
.*                                                                      08460000
&ZOPN                 SETA  &ZOPN+1                                     08470000
&ZOPL(&ZOPN)          SETC  ' '                                         08480000
&ZOPO(&ZOPN)          SETC  'ST'                                        08490000
&ZOPV(&ZOPN)          SETC  '&ZCGPR,0(,1)'                              08500000
&ZOPD(&ZOPN)          SETC  '++ STORE Address of Buffer Pointer' @P1C   08510000
.ZI2G                 ANOP  ,                                           08520000
.*-------------------------------------------------------------------   08530000
.*** * * * BIND=NAME ADDR XKBUFLEN A INPUT                              08540000
         AIF   ('&ZXKBUFLEN' EQ '').DC05G  NOT USED                     08550000
&ZCGPR   SETC  '14'                                                     08560000
         AIF   ('&XKBUFLEN'(1,1) NE '(').DC05A NOT IN GPR               08570000
&ZCGPR                SETC  '&XKBUFLEN'(2,K'&XKBUFLEN-2)                08580000
.*                                                                      08590000
&ZOPN                 SETA  &ZOPN+1                                     08600000
&ZOPL(&ZOPN)          SETC  ' '                                         08610000
&ZOPO(&ZOPN)          SETC  'ST'                                        08620000
&ZOPV(&ZOPN)          SETC  '&ZCGPR,4(,1)'                              08630000
&ZOPD(&ZOPN)          SETC  '++ STORE Address of Buflen pointer'  @P1C  08640000
.*                                                                      08650000
         AGO   .DC05G                                        /* @P1A*/  08660000
.DC05A                ANOP  ,                                /* @P1A*/  08670000
.*                                                                      08680000
&ZOPN                 SETA  &ZOPN+1                          /* @P1A*/  08690000
&ZOPL(&ZOPN)          SETC  ' '                              /* @P1A*/  08700000
&ZOPO(&ZOPN)          SETC  '&ZCVAL'                         /* @P1A*/  08710000
&ZOPV(&ZOPN)          SETC  '&ZCGPR,&XKBUFLEN'               /* @P1A*/  08720000
&ZOPD(&ZOPN)          SETC  '++ LOAD Buflen pointer address' /* @P1A*/  08730000
.*                                                           /* @P1A*/  08740000
&ZOPN                 SETA  &ZOPN+1                          /* @P1A*/  08750000
&ZOPL(&ZOPN)          SETC  ' '                              /* @P1A*/  08760000
&ZOPO(&ZOPN)          SETC  'ST'                             /* @P1A*/  08770000
&ZOPV(&ZOPN)          SETC  '&ZCGPR,4(,1)'                   /* @P1A*/  08780000
&ZOPD(&ZOPN)          SETC  '++ STORE Address of Buflen pointer' @P1A   08790000
.DC05G                ANOP  ,                                           08800000
.*-------------------------------------------------------------------   08810000
.***AI.A06 BIND=NAME ADDR XKBUFALET A INPUT                             08820000
                     AIF   ('&ZXKBUFALET' EQ '').ZI2J                   08830000
&ZCGPR               SETC  '14'                                         08840000
                     AIF   ('&XKBUFALET'(1,1) NE '(').ZI2H  NOT IN GPR  08850000
&ZCGPR               SETC  '&XKBUFALET'(2,K'&XKBUFALET-2)               08860000
.*                                                                      08870000
&ZOPN                 SETA  &ZOPN+1                                     08880000
&ZOPL(&ZOPN)          SETC  ' '                                         08890000
&ZOPO(&ZOPN)          SETC  'ST'                                        08900000
&ZOPV(&ZOPN)          SETC  '&ZCGPR,8(,1)'                              08910000
&ZOPD(&ZOPN)          SETC  '++ STORE Address of BufAlet pointer' @P1C  08920000
.*                                                                      08930000
                     AGO   .ZI2J                             /* @P1A*/  08940000
.ZI2H                ANOP  ,                                 /* @P1A*/  08950000
.*                                                                      08960000
&ZOPN                SETA  &ZOPN+1                           /* @P1A*/  08970000
&ZOPL(&ZOPN)         SETC  ' '                               /* @P1A*/  08980000
&ZOPO(&ZOPN)         SETC  '&ZCVAL'                          /* @P1A*/  08990000
&ZOPV(&ZOPN)         SETC  '&ZCGPR,&XKBUFALET'               /* @P1A*/  09000000
&ZOPD(&ZOPN)         SETC  '++ LOAD BufAlet Pointer address' /* @P1A*/  09010000
.*                                                                      09020000
&ZOPN                SETA  &ZOPN+1                           /* @P1A*/  09030000
&ZOPL(&ZOPN)         SETC  ' '                               /* @P1A*/  09040000
&ZOPO(&ZOPN)         SETC  'ST'                              /* @P1A*/  09050000
&ZOPV(&ZOPN)         SETC  '&ZCGPR,8(,1)'                    /* @P1A*/  09060000
&ZOPD(&ZOPN)         SETC  '++ STORE Address of BufAlet pointer' @P1A   09070000
.ZI2J                ANOP  ,                                            09080000
.*-------------------------------------------------------------------   09090000
&ZOPN1               SETA &ZOPN                                         09100000
.*******************************************************************    09110000
.***AO.X02  RETURN CODE PROCESSING                                      09120000
.*******************************************************************    09130000
                      AIF   (N'&RETCODE LE 0).ZMRETX                    09140000
                      AIF   ('&XRETCODE'(1,1) EQ '(').ZMRET2            09150000
                      AIF   ('&XRETCODE' EQ 'GPR15').ZMRETX             09160000
                      AIF   ('&XRETCODE' EQ 'REG15').ZMRETX             09170000
                      AIF   ('&XRETCODE' EQ 'R15').ZMRETX               09180000
                      AIF   ('&XRETCODE' EQ '15').ZMRETX                09190000
&ZOPN                 SETA  &ZOPN+1                                     09200000
&ZOPL(&ZOPN)          SETC  ' '                                         09210000
&ZOPO(&ZOPN)          SETC  'ST'                                        09220000
&ZOPV(&ZOPN)          SETC  '15,&XRETCODE'                              09230000
&ZOPD(&ZOPN)          SETC  '++ SET RETURN CODE'                        09240000
                      AGO   .ZMRETX                                     09250000
.*                                                                      09260000
.ZMRET2               ANOP  ,                                           09270000
&ZCGPR                SETC  '&XRETCODE'(2,K'&XRETCODE-2)                09280000
                      AIF   ('&ZCGPR' EQ 'GPR15').ZMRETX                09290000
                      AIF   ('&ZCGPR' EQ 'REG15').ZMRETX                09300000
                      AIF   ('&ZCGPR' EQ 'R15').ZMRETX                  09310000
                      AIF   ('&ZCGPR' EQ '15').ZMRETX                   09320000
&ZOPN                 SETA  &ZOPN+1                                     09330000
&ZOPL(&ZOPN)          SETC  ' '                                         09340000
&ZOPO(&ZOPN)          SETC  'LR'                                        09350000
&ZOPV(&ZOPN)          SETC  '&ZCGPR,15'                                 09360000
&ZOPD(&ZOPN)          SETC  '++ SET RETURN CODE'                        09370000
.ZMRETX               ANOP  ,                                           09380000
.*******************************************************************    09390000
.***AO.X04  LABEL FOR MF=L PROCESSING                                   09400000
.*******************************************************************    09410000
.ZMFLX                ANOP  ,              MF=L PROCESSING              09420000
.*******************************************************************    09430000
.***AO.X05  FORMAT GENERATED INSTRUCTIONS                               09440000
.*******************************************************************    09450000
                      ACTR  10000                                       09460000
.*                                                                      09470000
                      LCLA  &ZLC           COLUMN POSITION              09480000
                      LCLA  &ZOPX          LIST TABLE INDEX             09490000
                      LCLC  &ZLL           LABEL                        09500000
                      LCLC  &ZLOP          OPERATION                    09510000
                      LCLC  &ZLV           VALUE                        09520000
                      LCLC  &ZLD           DESCRIPTION                  09530000
.*                                                                      09540000
&ZOPX                 SETA  1                                           09550000
.ZL2                  AIF   (&ZOPX GT &ZOPN1).ZLX  B IF DONE            09560000
&ZLL                  SETC  '&ZOPL(&ZOPX)'                              09570000
&ZLOP                 SETC  '&ZOPO(&ZOPX)'                              09580000
&ZLV                  SETC  '&ZOPV(&ZOPX)'                              09590000
&ZLD                  SETC  '&ZOPD(&ZOPX)'                              09600000
                      AIF   (K'&ZLD LE 0).ZL5                           09610000
&ZLC                  SETA  35             COMMENT COLUMN               09620000
                      AIF   ('&ZLD'(1,1) NE '*').ZL3                    09630000
&ZLC                  SETA  33             COMMMENT COLUMN              09640000
.ZL3                  AIF   (K'&ZLV GE &ZLC-16-1).ZL4                   09650000
&ZLV                  SETC  '&ZLV'.' '                                  09660000
                      AGO   .ZL3                                        09670000
.*                                                                      09680000
.ZL4                  ANOP  ,                                           09690000
&ZLV                  SETC  '&ZLV'.' '                                  09700000
.ZL5                  ANOP  ,                                           09710000
&ZLV                  SETC  '&ZLV'.'&ZLD'                               09720000
.*                                                                      09730000
&ZLL     &ZLOP &ZLV                                                     09740000
.*                                                                      09750000
&ZOPX                 SETA  &ZOPX+1        NEXT STRUCTURE               09760000
                      AGO   .ZL2           CONTINUE LOOPING             09770000
.*                                                                      09780000
.ZLX                  ANOP  ,                                           09790000
                      AIF   ('&XMF' EQ 'L').ZLINKX  MF=L                09800000
.*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*  09810000
         L     15,16(0,0)      GET CVT ADDRESS                          09820000
         L     14,140(0,15)    GET ECVT ADDRESS                         09830000
         L     15,240(0,14)    GET OCVT ADDRESS                         09840000
         N     15,=A(X'7FFFFFFF')  Clear high bit for AM64 calls  @D1A  09841000
         L     14,8(0,15)      Get OCVE Address                         09842000
         L     15,240(0,14)    Get BPXAMRMF routine address             09843000
         BALR  14,15           BRANCH TO ROUTINE                        09844000
.*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*  09845000
.ZLINKX               ANOP  ,                                           09846000
.*******************************************************************    09847000
.***AP.X01  FORMAT GENERATED CODE                                       09848000
.ZL21                 AIF   (&ZOPX GT &ZOPN).ZLX1  B IF DONE            09849000
&ZLL                  SETC  '&ZOPL(&ZOPX)'                              09850000
&ZLOP                 SETC  '&ZOPO(&ZOPX)'                              09860000
&ZLV                  SETC  '&ZOPV(&ZOPX)'                              09870000
&ZLD                  SETC  '&ZOPD(&ZOPX)'                              09880000
                      AIF   (K'&ZLD LE 0).ZL51                          09890000
&ZLC                  SETA  35             COMMENT COLUMN               09900000
                      AIF   ('&ZLD'(1,1) NE '*').ZL31                   09910000
&ZLC                  SETA  33             COMMENT COLUMN               09920000
.ZL31                 AIF   (K'&ZLV GE &ZLC-16-1).ZL41                  09930000
&ZLV                  SETC  '&ZLV'.' '                                  09940000
                      AGO   .ZL31                                       09950000
.*                                                                      09960000
.ZL41                 ANOP  ,                                           09970000
&ZLV                  SETC  '&ZLV'.' '                                  09980000
.ZL51                 ANOP  ,                                           09990000
&ZLV                  SETC  '&ZLV'.'&ZLD'                               10000000
.*                                                                      10010000
&ZLL     &ZLOP &ZLV                                                     10020000
.*                                                                      10030000
&ZOPX                 SETA  &ZOPX+1        NEXT STRUCTURE               10040000
                      AGO   .ZL21          CONTINUE LOOPING             10050000
.*                                                                      10060000
.ZLX1                 ANOP  ,                                           10070000
.*******************************************************************    10080000
.***AP.X02  END OF BPXEKDA MACRO                                        10090000
&ZBPXEKDA             SETC  'YES'          SET BPXEKDA USED             10100000
         POP   PRINT                                                    10110000
*                                            BPXEKDA-0                  10120000
         SPACE 1                                                        10130000
.ZLX2                 ANOP  ,                                           10140000
         MEND                                                           10150000
**********************************************************************/ 10160000
*/*PB.OC01 INVOKE MACRO---------------------------------------------*/  10170000
*%BPXEKDA: MACRO KEYS(KBUFPTR,KBUFLEN,KBUFALET,RETCODE,MF);             10180000
*  ANS('?'!!MACLABEL!!' '!!'BPXEKDA '!!MACLIST!!                        10190000
*         ' '!!MACKEYS!!';') COL(MACLMAR);                              10200000
*%END BPXEKDA;                                                          10210000
